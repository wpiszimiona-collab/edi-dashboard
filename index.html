<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
    (function() {
        const HASH = 'bba1dc9846ddd9a44c3d3b736faa5bdb6673b8d0fe1b0dd445c9f9adfda2ff72'; // sha256 of PIN
        const KEY = 'ediDashAuth';
        if (localStorage.getItem(KEY) === HASH) return;
        async function sha256(text) {
            const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(text));
            return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
        }
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;inset:0;z-index:99999;background:#0D0D12;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px;font-family:system-ui;';
        overlay.innerHTML = '<div style="font-size:24px">ğŸ¯</div><div style="color:#a78bfa;font-size:14px;font-weight:700">1ts</div><input id="pinInput" type="password" inputmode="numeric" placeholder="PIN" maxlength="20" style="padding:12px 20px;background:#1a1a2e;border:1px solid #2a2a3e;border-radius:8px;color:white;font-size:18px;text-align:center;width:200px;outline:none;" autofocus><button id="pinBtn" style="margin-top:8px;padding:10px 40px;background:#7C3AED;border:none;border-radius:8px;color:white;font-size:14px;font-weight:700;cursor:pointer;">Enter</button><div id="pinError" style="color:#ef4444;font-size:12px;height:16px;"></div>';
        document.documentElement.appendChild(overlay);
        setTimeout(() => {
            const input = document.getElementById('pinInput');
            input.focus();
            async function tryPin() {
                const hash = await sha256(input.value);
                if (hash === HASH) {
                    localStorage.setItem(KEY, HASH);
                    overlay.remove();
                } else {
                    document.getElementById('pinError').textContent = 'BÅ‚Ä™dny PIN';
                    input.value = '';
                }
            }
            input.addEventListener('keypress', function(e) { if (e.key === 'Enter') tryPin(); });
            document.getElementById('pinBtn').addEventListener('click', tryPin);
        }, 100);
    })();
    </script>
    <title>COMMAND CENTER</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-body: #0F0E1A;
            --bg-card: #1A1925;
            --bg-card-hover: #222131;
            --bg-input: #14131F;
            --border: rgba(124,58,237,0.12);
            --border-hover: rgba(124,58,237,0.4);
            --text-primary: #ffffff;
            --text-secondary: #8B8A9E;
            --text-muted: #5C5B6F;
            --purple-500: #7C3AED;
            --purple-400: #8B5CF6;
            --purple-300: #A78BFA;
            --purple-glow: rgba(124,58,237,0.25);
            --green: #10b981;
            --yellow: #f59e0b;
            --red: #ef4444;
            --blue: #3b82f6;
            --gray: #6b7280;
            --pink: #EC4899;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0c;
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.4;
            font-size: 11px;
            -webkit-font-smoothing: antialiased;
        }

        /* Liquid Glass */
        .glass {
            position: relative;
            background: linear-gradient(145deg, rgba(255,255,255,0.10) 0%, rgba(255,255,255,0.04) 50%, rgba(255,255,255,0.07) 100%);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4), inset 0 1px 1px rgba(255,255,255,0.08);
            overflow: hidden;
        }
        .glass::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(from 180deg at 50% 50%, transparent 0deg, rgba(255,100,200,0.04) 60deg, rgba(100,200,255,0.06) 120deg, rgba(200,255,100,0.03) 180deg, rgba(255,200,100,0.03) 240deg, rgba(200,100,255,0.06) 300deg, transparent 360deg);
            pointer-events: none;
        }
        .glass::after {
            content: '';
            position: absolute;
            top: 0; left: 10%; right: 10%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3) 30%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.3) 70%, transparent);
            pointer-events: none;
        }
        @keyframes shimmer { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        ::-webkit-scrollbar { width: 3px; height: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BENTO GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bento-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 6px;
            padding: 8px;
            min-height: 100vh;
        }

        .tile {
            position: relative;
            background: linear-gradient(145deg, rgba(255,255,255,0.10) 0%, rgba(255,255,255,0.04) 50%, rgba(255,255,255,0.07) 100%);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 14px;
            padding: 14px 16px;
            overflow: hidden;
            box-shadow: 0 4px 24px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.06);
            transition: all 0.3s;
        }
        .tile::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(from 180deg at 50% 50%, transparent 0deg, rgba(255,100,200,0.03) 60deg, rgba(100,200,255,0.05) 120deg, rgba(200,255,100,0.02) 180deg, rgba(255,200,100,0.02) 240deg, rgba(200,100,255,0.05) 300deg, transparent 360deg);
            pointer-events: none;
        }
        .tile::after {
            content: '';
            position: absolute;
            top: 0; left: 10%; right: 10%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25) 30%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.25) 70%, transparent);
            pointer-events: none;
        }
        .tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4), inset 0 1px 1px rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.18);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ROW 1: HEADER TILES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile > * { position: relative; z-index: 1; }
        .tile-logo { grid-column: span 4; display: flex; align-items: center; gap: 8px; justify-content: center; }
        .tile-statsbar { grid-column: span 8; display: flex; align-items: center; justify-content: space-around; gap: 0; padding: 8px 16px; }
        .statsbar-item { display: flex; align-items: center; gap: 6px; }
        .statsbar-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .statsbar-dot.red { background: var(--red); box-shadow: 0 0 6px rgba(239,68,68,0.5); }
        .statsbar-dot.purple { background: var(--purple-500); box-shadow: 0 0 6px rgba(124,58,237,0.5); }
        .statsbar-dot.yellow { background: var(--yellow); box-shadow: 0 0 6px rgba(245,158,11,0.5); }
        .statsbar-dot.green { background: var(--green); box-shadow: 0 0 6px rgba(16,185,129,0.5); }
        .statsbar-num { font-size: 1.3rem; font-weight: 800; color: #fff; }
        .statsbar-label { font-size: 0.75rem; color: var(--text-secondary); }
        .statsbar-sep { width: 1px; height: 20px; background: rgba(255,255,255,0.1); margin: 0 8px; }
        .logo-text { font-size: 12px; font-weight: 800; letter-spacing: 0.04em; background: linear-gradient(135deg, var(--purple-300), var(--purple-500)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .online-badge { font-size: 8px; padding: 2px 6px; border-radius: 8px; background: rgba(16,185,129,0.15); color: var(--green); font-weight: 600; display: flex; align-items: center; gap: 3px; }
        .online-dot { width: 5px; height: 5px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; box-shadow: 0 0 6px rgba(16,185,129,0.6); }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

        .tile-stat { grid-column: span 2; display: flex; flex-direction: column; justify-content: center; gap: 2px; position: relative; overflow: hidden; }
        .tile-stat-wide { grid-column: span 3; }
        .stat-accent { position: absolute; top: 0; left: 0; right: 0; height: 2px; }
        .stat-accent.red { background: var(--red); }
        .stat-accent.purple { background: var(--purple-500); }
        .stat-accent.yellow { background: var(--yellow); }
        .stat-accent.green { background: var(--green); }
        .stat-top { display: flex; align-items: center; gap: 6px; }
        .stat-icon { font-size: 12px; }
        .stat-number { font-size: 1.8rem; font-weight: 800; line-height: 1; color: #fff; }
        .stat-label { font-size: 9px; color: var(--text-secondary); font-weight: 500; margin-top: 1px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• KANBAN TILES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-kanban { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; }
        .tile-kanban-sm { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; }
        .kanban-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; padding-bottom: 5px; border-bottom: 2px solid var(--border); }
        .kanban-header.urgent { border-bottom-color: var(--red); }
        .kanban-header.todo { border-bottom-color: var(--purple-500); }
        .kanban-header.waiting { border-bottom-color: var(--yellow); }
        .kanban-header.done { border-bottom-color: var(--green); }
        .kanban-header.onhold { border-bottom-color: #6b7280; }
        .kanban-count.onhold { background: rgba(107,114,128,0.15); color: #9ca3af; }
        .kanban-title { font-weight: 700; font-size: 9px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-primary); display: flex; align-items: center; gap: 5px; }
        .kanban-subtitle { font-size: 8px; color: var(--purple-400); font-weight: 400; }
        .kanban-count { font-size: 9px; font-weight: 700; padding: 1px 5px; border-radius: 6px; }
        .kanban-count.urgent { background: rgba(239,68,68,0.15); color: var(--red); }
        .kanban-count.todo { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .kanban-count.waiting { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .kanban-count.done { background: rgba(16,185,129,0.15); color: var(--green); }

        .add-task-btn {
            background: rgba(124,58,237,0.12); border: none; color: var(--purple-400);
            width: 18px; height: 18px; border-radius: 4px; cursor: pointer;
            font-size: 11px; display: flex; align-items: center; justify-content: center;
        }
        .add-task-btn:hover { background: var(--purple-500); color: white; }

        .task-list { display: flex; flex-direction: column; gap: 3px; flex: 1; overflow-y: auto; }

        .task-card {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            border-radius: 6px; padding: 6px 8px; cursor: pointer; transition: all 0.15s;
            display: flex; align-items: center; gap: 6px;
        }
        .task-card:hover { border-color: var(--border-hover); background: rgba(124,58,237,0.05); }
        .task-card[draggable="true"] { cursor: grab; }
        .task-card[draggable="true"]:active { cursor: grabbing; }

        .task-num { font-size: 9px; font-weight: 700; color: var(--text-muted); min-width: 16px; }
        .task-card-content { flex: 1; min-width: 0; }
        .task-status-circle { width: 10px; height: 10px; border-radius: 50%; border: 2px solid; flex-shrink: 0; }
        .task-status-circle.urgent { border-color: var(--red); }
        .task-status-circle.todo { border-color: var(--purple-500); }
        .task-status-circle.waiting { border-color: var(--yellow); }
        .task-status-circle.done { border-color: var(--green); background: var(--green); }
        .task-status-circle.onhold { border-color: #6b7280; }

        .task-row { display: flex; justify-content: space-between; align-items: center; gap: 4px; }
        .task-title { font-weight: 500; font-size: 10px; line-height: 1.3; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .task-project { font-size: 7px; padding: 1px 5px; border-radius: 4px; font-weight: 600; white-space: nowrap; flex-shrink: 0; }
        .task-project.dom { background: rgba(16,185,129,0.15); color: var(--green); }
        .task-project.onethree { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .task-project.kubus { background: rgba(239,68,68,0.15); color: var(--red); }
        .task-project.system { background: rgba(107,114,128,0.15); color: var(--gray); }
        .task-project.especto { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .task-time { font-size: 7px; color: var(--text-muted); white-space: nowrap; }

        .task-attachments { margin-top: 3px; padding-top: 3px; border-top: 1px solid var(--border); }
        .task-attachment-link { display: inline-flex; align-items: center; gap: 2px; font-size: 8px; color: var(--purple-300); text-decoration: none; margin-right: 4px; }
        .task-attachment-link:hover { text-decoration: underline; }

        .kanban-drop-zone { min-height: 40px; }
        .kanban-drop-zone.drag-over { background: rgba(124,58,237,0.08); border-radius: 6px; }

        .empty-state { text-align: center; padding: 10px 6px; color: var(--text-muted); font-size: 9px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CALENDAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-calendar { grid-column: span 3; grid-row: span 2; }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .cal-title { font-size: 11px; font-weight: 700; color: var(--text-primary); }
        .cal-nav { display: flex; gap: 4px; }
        .cal-nav button { background: rgba(124,58,237,0.12); border: none; color: var(--purple-400); width: 20px; height: 20px; border-radius: 4px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; }
        .cal-nav button:hover { background: var(--purple-500); color: white; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center; }
        .cal-day-name { font-size: 8px; font-weight: 600; color: var(--text-muted); padding: 4px 0; text-transform: uppercase; }
        .cal-day { font-size: 9px; padding: 4px 2px; border-radius: 4px; color: var(--text-secondary); cursor: pointer; transition: all 0.15s; }
        .cal-day:hover { background: rgba(124,58,237,0.1); }
        .cal-day.today { background: var(--purple-500); color: white; font-weight: 700; border-radius: 50%; }
        .cal-day.other-month { color: var(--text-muted); opacity: 0.3; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PROGRESS RING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-progress { grid-column: span 3; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; }
        .progress-ring-wrap { position: relative; width: 100px; height: 100px; }
        .progress-ring-wrap svg { transform: rotate(-90deg); }
        .progress-ring-bg { fill: none; stroke: rgba(124,58,237,0.1); stroke-width: 6; }
        .progress-ring-fg { fill: none; stroke: url(#progressGradient); stroke-width: 6; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
        .progress-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 22px; font-weight: 800; color: var(--text-primary); }
        .progress-ring-label { font-size: 9px; color: var(--purple-400); font-weight: 500; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUICK NOTES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-notes { grid-column: span 4; display: flex; flex-direction: column; }
        .notes-title { font-size: 10px; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; display: flex; align-items: center; gap: 5px; }
        .notes-textarea { flex: 1; width: 100%; padding: 8px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 10px; resize: none; font-family: inherit; line-height: 1.5; }
        .notes-textarea:focus { outline: none; border-color: var(--purple-500); }
        .notes-saved { font-size: 8px; color: var(--green); margin-top: 4px; opacity: 0; transition: opacity 0.3s; }
        .notes-saved.show { opacity: 1; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PROJECT TILES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-project { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; overflow: visible; }
        .project-tile-title { font-size: 11px; font-weight: 700; margin-bottom: 3px; display: flex; align-items: center; gap: 5px; color: var(--text-primary); }
        .project-tile-subtitle { font-size: 8px; color: var(--purple-400); margin-bottom: 8px; }

        .project-item { display: flex; align-items: center; gap: 6px; padding: 4px 0; cursor: pointer; }
        .project-item:hover .project-name { color: var(--purple-300); }
        .project-status { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
        .project-status.active { background: var(--green); box-shadow: 0 0 4px rgba(16,185,129,0.5); }
        .project-status.warning { background: var(--yellow); }
        .project-status.urgent { background: var(--red); }
        .project-status.inactive { background: var(--gray); }
        .project-name { font-size: 10px; font-weight: 600; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .project-progress-wrap { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }
        .progress-bar { width: 50px; height: 3px; background: rgba(255,255,255,0.06); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--purple-500), var(--purple-300)); border-radius: 2px; transition: width 0.5s; }
        .progress-pct { font-size: 8px; color: var(--text-muted); width: 24px; text-align: right; }

        /* Project expand */
        .project-card { cursor: pointer; padding: 4px 0; border-bottom: 1px solid var(--border); position: relative; }
        .project-card:last-child { border-bottom: none; }
        .expand-icon { font-size: 7px; color: var(--text-muted); transition: transform 0.2s; margin-left: 4px; }
        .project-card.expanded .expand-icon { transform: rotate(180deg); }
        .project-details { display: none; padding: 6px 0 4px 12px; }
        .project-card.expanded .project-details {
            display: block;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        .project-card.expanded .project-details::before {
            content: 'âœ• Zamknij';
            display: block;
            text-align: right;
            color: var(--purple-300);
            font-size: 12px;
            font-weight: 700;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 10px;
            cursor: pointer;
        }
        .project-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9998; }
        .project-overlay.active { display: block; }
        @media (max-width: 600px) {
            .project-card.expanded .project-details {
                width: 95%;
                max-height: 85vh;
            }
        }
        .project-tasks-title { font-size: 9px; color: var(--text-secondary); margin-bottom: 3px; }
        .project-task-item { display: flex; align-items: center; gap: 4px; padding: 2px 0; font-size: 10px; }
        .project-task-item input[type="checkbox"] { width: 12px; height: 12px; accent-color: var(--purple-500); }
        .project-task-item.done { text-decoration: line-through; color: var(--text-muted); }
        .project-notes { margin-top: 4px; }
        .project-notes-label { font-size: 9px; color: var(--text-secondary); margin-bottom: 2px; }
        .project-notes textarea { width: 100%; min-height: 30px; padding: 4px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 10px; resize: vertical; font-family: inherit; }
        .project-notes textarea:focus { outline: none; border-color: var(--purple-500); }
        .add-project-task { display: flex; gap: 4px; margin-top: 4px; }
        .add-project-task input { flex: 1; padding: 3px 6px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 10px; font-family: inherit; }
        .add-project-task input:focus { outline: none; border-color: var(--purple-500); }
        .add-project-task button { padding: 3px 8px; background: var(--purple-500); border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 10px; font-weight: 600; }
        .drive-link-btn { display: block; margin: 4px 0; padding: 4px 8px; background: linear-gradient(135deg, #4285f4, #34a853); color: white; text-decoration: none; border-radius: 6px; font-weight: 600; text-align: center; font-size: 9px; }
        .drive-link-btn:hover { opacity: 0.9; }
        .project-docs { margin-top: 4px; padding-top: 4px; border-top: 1px solid var(--border); }
        .project-docs-label { font-size: 9px; color: var(--text-secondary); margin-bottom: 3px; }
        .project-doc-link { display: flex; align-items: center; gap: 4px; padding: 2px 6px; background: rgba(255,255,255,0.03); border-radius: 4px; color: var(--purple-300); text-decoration: none; font-size: 9px; margin-bottom: 2px; }
        .project-doc-link:hover { background: rgba(124,58,237,0.1); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• APPS + DOCS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-apps { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; }
        .tile-docs { grid-column: span 5; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TILE HIDE/STASH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-close-btn {
            position: absolute; top: 6px; right: 24px; z-index: 10;
            width: 16px; height: 16px; border-radius: 50%;
            background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.25); font-size: 9px; cursor: pointer;
            display: none; align-items: center; justify-content: center; line-height: 1;
        }
        .stash-mode .tile:hover .tile-close-btn { display: flex; }
        .tile-close-btn:hover { background: rgba(239,68,68,0.2); color: var(--red); border-color: rgba(239,68,68,0.3); }
        .tile.hidden-tile { display: none !important; }
        .tile-stash { grid-column: span 6; display: flex; flex-direction: column; }
        .stash-chips { display: flex; gap: 6px; flex-wrap: wrap; padding: 4px 0; }
        .stash-chip {
            font-size: 9px; padding: 3px 8px; border-radius: 6px; cursor: pointer;
            background: rgba(124,58,237,0.15); color: var(--purple-300); border: 1px solid rgba(124,58,237,0.2);
            transition: all 0.2s;
        }
        .stash-chip:hover { background: rgba(124,58,237,0.3); color: #fff; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EDI LOG TILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-edilog { grid-column: span 6; grid-row: span 3; display: flex; flex-direction: column; max-height: 400px; }
        .edilog-scroll { flex: 1; overflow-y: auto; padding-right: 4px; }
        .edilog-scroll::-webkit-scrollbar { width: 4px; }
        .edilog-scroll::-webkit-scrollbar-thumb { background: rgba(124,58,237,0.3); border-radius: 2px; }
        .edilog-day { margin-bottom: 8px; }
        .edilog-day-header { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--purple-300); padding: 4px 0; border-bottom: 1px solid rgba(124,58,237,0.2); margin-bottom: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .edilog-day-header:hover { color: var(--purple-400); }
        .edilog-day-header .arrow { font-size: 8px; transition: transform 0.2s; }
        .edilog-day-header .arrow.collapsed { transform: rotate(-90deg); }
        .edilog-day-summary { font-size: 8px; color: var(--text-secondary); font-weight: 400; margin-left: 8px; }
        .edilog-entry { display: flex; gap: 8px; padding: 3px 0; align-items: flex-start; font-size: 10px; }
        .edilog-time { color: var(--text-secondary); font-size: 9px; min-width: 36px; font-family: monospace; }
        .edilog-icon { font-size: 10px; min-width: 14px; }
        .edilog-text { color: var(--text-primary); flex: 1; }
        .edilog-text .detail { color: var(--text-secondary); font-size: 9px; }
        .edilog-tag { font-size: 7px; padding: 1px 4px; border-radius: 3px; font-weight: 600; background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .edilog-entries.collapsed { display: none; }

        .apps-inline { display: flex; flex-wrap: wrap; gap: 4px; }
        .app-pill { display: flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; font-size: 9px; cursor: pointer; transition: all 0.15s; }
        .app-pill:hover { border-color: var(--border-hover); }
        .app-pill.high { border-left: 2px solid var(--red); }
        .app-pill.medium { border-left: 2px solid var(--yellow); }
        .app-pill.low { border-left: 2px solid var(--green); }
        .app-stage { font-size: 7px; padding: 1px 4px; border-radius: 3px; font-weight: 600; }
        .app-stage.idea { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .app-stage.planned { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .app-stage.progress { background: rgba(59,130,246,0.15); color: var(--blue); }
        .app-stage.done { background: rgba(16,185,129,0.15); color: var(--green); }

        .add-app-inline { padding: 4px 8px; background: rgba(124,58,237,0.06); border: 1px dashed rgba(124,58,237,0.2); border-radius: 6px; color: var(--purple-400); font-size: 9px; cursor: pointer; }
        .add-app-inline:hover { border-color: var(--purple-500); }

        .docs-pills { display: flex; flex-wrap: wrap; gap: 4px; }
        .doc-pill { display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; color: var(--purple-300); text-decoration: none; font-size: 9px; transition: all 0.15s; }
        .doc-pill:hover { border-color: var(--border-hover); }
        .doc-type { font-size: 7px; padding: 1px 4px; border-radius: 3px; font-weight: 600; }
        .doc-type.research { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .doc-type.raport { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .doc-type.plan { background: rgba(16,185,129,0.15); color: var(--green); }

        .tile-section-title { font-size: 10px; font-weight: 700; margin-bottom: 2px; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.04em; }
        .tile-section-subtitle { font-size: 8px; color: var(--purple-400); margin-bottom: 6px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10,8,20,0.8); backdrop-filter: blur(8px); z-index: 1000; justify-content: center; align-items: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: rgba(26,26,36,0.95); backdrop-filter: blur(24px); border: 1px solid rgba(124,58,237,0.15); border-radius: 10px; padding: 16px; width: 90%; max-width: 420px; box-shadow: 0 32px 80px rgba(0,0,0,0.6); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .modal-title { font-size: 13px; font-weight: 700; }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 16px; cursor: pointer; }
        .modal-close:hover { color: var(--red); }
        .form-group { margin-bottom: 8px; }
        .form-group label { display: block; margin-bottom: 3px; font-size: 10px; color: var(--text-secondary); font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 6px 8px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 10px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--purple-500); }
        .form-group textarea { resize: vertical; min-height: 50px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .modal-actions { display: flex; gap: 8px; margin-top: 12px; }
        .btn { flex: 1; padding: 7px 10px; border: none; border-radius: 6px; font-size: 10px; font-weight: 600; cursor: pointer; font-family: inherit; }
        .btn-primary { background: linear-gradient(135deg, var(--purple-500), var(--purple-400)); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-secondary { background: var(--bg-input); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-danger { background: var(--red); color: white; }
        .btn-small { padding: 4px 8px; font-size: 10px; }
        .attachment-input { display: flex; gap: 4px; margin-top: 4px; }
        .attachment-input input { flex: 1; padding: 4px 6px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-input); color: var(--text-primary); font-size: 10px; font-family: inherit; }
        .attachment-input input:focus { outline: none; border-color: var(--purple-500); }
        .attachment-item { display: flex; align-items: center; gap: 4px; padding: 4px 6px; background: rgba(255,255,255,0.03); border-radius: 6px; margin-bottom: 3px; }
        .attachment-item a { color: var(--purple-300); text-decoration: none; flex: 1; font-size: 10px; }
        .attachment-item a:hover { text-decoration: underline; }
        .attachment-remove { color: var(--red); cursor: pointer; padding: 1px 4px; font-size: 10px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 900px) {
            .bento-grid { grid-template-columns: repeat(6, 1fr); }
            .tile-logo { grid-column: span 6; }
            .tile-stat { grid-column: span 3; }
            .tile-stat-wide { grid-column: span 3; }
            .tile-kanban, .tile-kanban-sm { grid-column: span 3; grid-row: span 2; }
            .tile-calendar { grid-column: span 6; }
            .tile-progress { grid-column: span 3; }
            .tile-notes { grid-column: span 3; }
            .tile-project { grid-column: span 6; grid-row: span 1; }
            .tile-apps, .tile-docs { grid-column: span 6; }
        }
        @media (max-width: 600px) {
            .bento-grid { 
                grid-template-columns: 1fr !important; 
                gap: 6px; 
                padding: 6px; 
                display: grid !important;
                position: relative !important;
            }
            .bento-grid > .tile {
                grid-column: span 1 !important;
                grid-row: span 1 !important;
                position: relative !important;
                top: auto !important;
                left: auto !important;
                width: auto !important;
                height: auto !important;
                min-height: auto;
            }
            .tile-logo { order: -10; }
            .tile-stat, .tile-stat-wide { min-height: 50px; }
            .tile-kanban, .tile-kanban-sm { min-height: 80px; }
            .tile-calendar { min-height: 200px; }
            .tile-progress { min-height: 120px; }
            .tile-notes { min-height: 80px; }
            .tile-project { min-height: 60px; }
            .tile-apps, .tile-docs { min-height: 60px; }
            .tile-settings { min-height: 60px; }
            .tile-edilog { min-height: 100px; }
            .tile { padding: 10px 12px !important; }
            .bento-grid.free-layout { display: grid !important; }
            .bento-grid.free-layout > .tile { position: relative !important; }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ANIMATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @keyframes ringAnim {
            from { stroke-dashoffset: 282.7; }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TILE DRAG & DROP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-grip {
            position: absolute; top: 6px; left: 6px; z-index: 10;
            font-size: 12px; color: rgba(255,255,255,0.2); cursor: grab;
            opacity: 0; transition: opacity 0.2s; user-select: none;
            line-height: 1; padding: 2px;
        }
        .tile:hover .tile-grip { opacity: 1; }
        .tile-grip:active { cursor: grabbing; }
        /* tile-drag-over and tile-dragging handled by enhanced CSS below */

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TILE COLOR PICKER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-color-btn {
            position: absolute; bottom: 6px; right: 6px; z-index: 10;
            font-size: 11px; cursor: pointer; opacity: 0; transition: opacity 0.2s;
            background: none; border: none; padding: 2px; line-height: 1;
        }
        .tile:hover .tile-color-btn { opacity: 1; }
        .tile-color-picker {
            position: absolute; bottom: 24px; right: 6px; z-index: 100;
            background: rgba(20,19,31,0.95); border: 1px solid rgba(124,58,237,0.3);
            border-radius: 8px; padding: 6px; display: grid; grid-template-columns: repeat(4,1fr);
            gap: 4px; box-shadow: 0 8px 24px rgba(0,0,0,0.6);
        }
        .tile-color-swatch {
            width: 22px; height: 22px; border-radius: 50%; cursor: pointer;
            border: 2px solid transparent; transition: all 0.15s;
        }
        .tile-color-swatch:hover { border-color: var(--purple-400); transform: scale(1.15); }
        .tile-color-swatch.active { border-color: white; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS TILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-settings { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; justify-content: center; gap: 6px; padding: 8px 10px; }
        .tile-settings .settings-title { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-secondary); margin-bottom: 2px; }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 2px 0; }
        .toggle-label { font-size: 10px; font-weight: 500; color: var(--text-primary); }
        .toggle-switch { position: relative; display: inline-block; width: 36px; height: 20px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #4a4a5a; border-radius: 10px; transition: background 0.3s; cursor: pointer; }
        .toggle-slider::before { content: ''; position: absolute; width: 16px; height: 16px; left: 2px; top: 2px; background: white; border-radius: 50%; transition: transform 0.3s; }
        .toggle-switch input:checked + .toggle-slider { background: var(--purple-500); }
        .toggle-switch input:checked + .toggle-slider::before { transform: translateX(16px); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DRAG & DROP ENHANCED â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile { transition: all 0.3s ease; }
        .tile.tile-dragging { opacity: 0.5 !important; }
        .tile.tile-drag-over { animation: dragPulse 0.8s ease infinite; }
        @keyframes dragPulse {
            0%, 100% { border-color: var(--purple-500); box-shadow: 0 0 8px rgba(124,58,237,0.3); }
            50% { border-color: var(--purple-300); box-shadow: 0 0 16px rgba(124,58,237,0.5); }
        }
        .tile.tile-drop-anim { animation: dropBounce 0.3s ease; }
        @keyframes dropBounce {
            0% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* Hide grip/color by default (controlled by toggles) */
        .tile-grip.hidden, .tile-color-btn.hidden { display: none !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TILE RESIZE HANDLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tile-resize-handle {
            position: absolute;
            bottom: 0; right: 0;
            width: 20px; height: 20px;
            cursor: nwse-resize;
            z-index: 3;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px;
            color: var(--text-muted);
            opacity: 0;
            transition: opacity 0.2s;
            background: linear-gradient(135deg, transparent 50%, rgba(124,58,237,0.3) 50%);
            border-radius: 0 0 14px 0;
        }
        .tile:hover .tile-resize-handle { opacity: 1; }
        .tile-resize-handle.hidden { display: none !important; }
        .tile.tile-resizing { transition: none !important; z-index: 50; }
        .tile.tile-resize-settle { transition: all 0.3s ease !important; }
        body.resize-dragging { user-select: none !important; cursor: nwse-resize !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FREE LAYOUT MODE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bento-grid.free-layout {
            display: block !important;
            position: relative;
            min-height: 900px;
        }
        .bento-grid.free-layout.free-editing {
            background-image: radial-gradient(circle, rgba(255,255,255,0.06) 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .bento-grid.free-layout > .tile {
            position: absolute;
        }
        .bento-grid.free-layout.free-editing > .tile {
            cursor: move;
        }
        .bento-grid.free-layout > .tile:hover {
            transform: none;
        }
        .bento-grid.free-layout > .tile.free-dragging {
            z-index: 1000 !important;
            box-shadow: 0 16px 48px rgba(0,0,0,0.6), inset 0 1px 1px rgba(255,255,255,0.08);
            transition: none !important;
        }
    </style>
</head>
<body>
    <!-- SVG Defs for gradient -->
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#7C3AED"/>
                <stop offset="100%" stop-color="#EC4899"/>
            </linearGradient>
        </defs>
    </svg>

    <div class="bento-grid">
        <!-- ROW 1: Stats + Logo -->
        <div class="tile tile-statsbar" id="tile-statsbar">
            <div class="statsbar-item"><span class="statsbar-dot red"></span><span class="statsbar-num" id="statUrgent">0</span><span class="statsbar-label">Pilne</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot purple"></span><span class="statsbar-num" id="statTodo">0</span><span class="statsbar-label">Do zrobienia</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot yellow"></span><span class="statsbar-num" id="statWaiting">0</span><span class="statsbar-label">Czekam</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot green"></span><span class="statsbar-num" id="statDone">0</span><span class="statsbar-label">Zrobione</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot" style="background:#6b7280;"></span><span class="statsbar-num" id="statOnhold">0</span><span class="statsbar-label">On Hold</span></div>
        </div>
        <div class="tile tile-logo" id="tile-logo">
            <span style="font-size:16px">ğŸ¯</span>
            <span class="logo-text">COMMAND CENTER</span>
            <span class="online-badge"><span class="online-dot"></span> Online</span>
            <span id="syncStatus" style="font-size:10px;margin-left:6px;opacity:0.6;cursor:pointer;" onclick="loadFromCloud().then(()=>location.reload())" title="Kliknij by pobraÄ‡ z chmury">â˜ï¸</span>
        </div>

        <!-- ROW 2-3: 4 Kanban columns -->
        <div class="tile tile-kanban" id="tile-kanban-urgent" data-column="urgent" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'urgent')">
            <div class="kanban-header urgent">
                <div><span class="kanban-title">ğŸ”´ PILNE <span class="kanban-count urgent" id="countUrgent">0</span></span><div class="kanban-subtitle">WymagajÄ… uwagi</div></div>
                <button class="add-task-btn" onclick="openModal('urgent')">+</button>
            </div>
            <div class="task-list" id="urgentTasks"></div>
        </div>
        <div class="tile tile-kanban" id="tile-kanban-todo" data-column="todo" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'todo')">
            <div class="kanban-header todo">
                <div><span class="kanban-title">ğŸ“‹ TODO <span class="kanban-count todo" id="countTodo">0</span></span><div class="kanban-subtitle">Zadania do wykonania</div></div>
                <button class="add-task-btn" onclick="openModal('todo')">+</button>
            </div>
            <div class="task-list" id="todoTasks"></div>
        </div>
        <div class="tile tile-kanban" id="tile-kanban-waiting" data-column="waiting" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'waiting')">
            <div class="kanban-header waiting">
                <div><span class="kanban-title">â³ CZEKAM <span class="kanban-count waiting" id="countWaiting">0</span></span><div class="kanban-subtitle">OczekujÄ…ce</div></div>
                <button class="add-task-btn" onclick="openModal('waiting')">+</button>
            </div>
            <div class="task-list" id="waitingTasks"></div>
        </div>
        <div class="tile tile-kanban" id="tile-kanban-done" data-column="done" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'done')">
            <div class="kanban-header done">
                <div><span class="kanban-title">âœ… DONE <span class="kanban-count done" id="countDone">0</span></span><div class="kanban-subtitle">UkoÅ„czone</div></div>
                <button class="add-task-btn" onclick="openModal('done')">+</button>
            </div>
            <div class="task-list" id="doneTasks"></div>
        </div>

        <!-- ROW 4-5: Projects (4 columns) -->
        <div class="tile tile-project" id="tile-proj-1three">
            <div class="project-tile-title" style="display:flex;justify-content:space-between;align-items:center;">ğŸ¬ 1three.studio <button class="add-task-btn" onclick="openAddProjectModal('onethree')" title="Dodaj projekt">+</button></div>
            <div class="project-tile-subtitle">Produkcja & szkolenia</div>
            <div id="projectsOnethree"></div>
        </div>
        <div class="tile tile-project" id="tile-proj-firmy">
            <div class="project-tile-title" style="display:flex;justify-content:space-between;align-items:center;">ğŸ¢ Firmy <button class="add-task-btn" onclick="openAddProjectModal('firmy')" title="Dodaj projekt">+</button></div>
            <div class="project-tile-subtitle">WÅ‚asne biznesy</div>
            <div id="projectsFirmy"></div>
        </div>
        <div class="tile tile-apps" id="tile-apps">
            <div class="tile-section-title">ğŸš€ Aplikacje</div>
            <div class="tile-section-subtitle">PomysÅ‚y & projekty dev</div>
            <div class="apps-inline" id="appsInline"></div>
        </div>
        <div class="tile tile-project" id="tile-proj-own">
            <div class="project-tile-title" style="display:flex;justify-content:space-between;align-items:center;">ğŸ  WÅ‚asne <button class="add-task-btn" onclick="openAddProjectModal('own')" title="Dodaj projekt">+</button></div>
            <div class="project-tile-subtitle">Projekty prywatne</div>
            <div id="projectsOwn"></div>
        </div>

        <!-- ROW 6-7: ON HOLD + Settings + Calendar -->
        <div class="tile tile-kanban" id="tile-kanban-onhold" data-column="onhold" style="grid-column: span 6;" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'onhold')">
            <div class="kanban-header onhold">
                <div><span class="kanban-title">â¸ï¸ ON HOLD <span class="kanban-count onhold" id="countOnhold">0</span></span><div class="kanban-subtitle">Wstrzymane</div></div>
                <button class="add-task-btn" onclick="openModal('onhold')">+</button>
            </div>
            <div class="task-list" id="onholdTasks"></div>
        </div>
        <div class="tile tile-settings" id="tile-settings">
            <div class="settings-title">âš™ï¸ Ustawienia</div>
            <label class="toggle-row">
                <span class="toggle-label">ğŸ”€ Przesuwanie</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleDrag">
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <label class="toggle-row">
                <span class="toggle-label">ğŸ¨ Kolory</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleColors">
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <label class="toggle-row">
                <span class="toggle-label">ğŸ“ Rozmiar</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleResize">
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <label class="toggle-row">
                <span class="toggle-label">ğŸ”“ Wolny ukÅ‚ad</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleFreeLayout">
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <label class="toggle-row">
                <span class="toggle-label">ğŸ—‚ï¸ Schowaj elementy</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleStash">
                    <span class="toggle-slider"></span>
                </div>
            </label>
        </div>
        <div class="tile tile-calendar" id="tile-calendar">
            <div class="cal-header">
                <div class="cal-nav"><button onclick="changeMonth(-1)">&lt;</button></div>
                <div class="cal-title" id="calTitle">Luty 2026</div>
                <div class="cal-nav"><button onclick="changeMonth(1)">&gt;</button></div>
            </div>
            <div class="cal-grid" id="calGrid"></div>
        </div>

        <!-- ROW 8: Docs + Progress + Notes -->
        <div class="tile tile-docs" id="tile-docs">
            <div class="tile-section-title">ğŸ“„ Dokumenty</div>
            <div class="tile-section-subtitle">Raporty & research</div>
            <div class="docs-pills" id="ediDocs"></div>
        </div>
        <div class="tile tile-progress" id="tile-progress">
            <div class="progress-ring-wrap">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <circle class="progress-ring-bg" cx="50" cy="50" r="45"/>
                    <circle class="progress-ring-fg" id="progressRing" cx="50" cy="50" r="45" stroke-dasharray="282.7" stroke-dashoffset="282.7"/>
                </svg>
                <div class="progress-ring-text" id="progressPct">0%</div>
            </div>
            <div class="progress-ring-label">UkoÅ„czone taski</div>
        </div>
        <div class="tile tile-notes" id="tile-notes">
            <div class="notes-title">ğŸ“ Quick Notes</div>
            <textarea class="notes-textarea" id="quickNotes" placeholder="Szybkie notatki..." oninput="saveQuickNotes()"></textarea>
            <div class="notes-saved" id="notesSaved">âœ“ Zapisano</div>
        </div>

        <!-- EDI LOG TILE -->
        <div class="tile tile-edilog" id="tile-edilog">
            <div class="tile-section-title">ğŸ“‹ Edi Log</div>
            <div class="tile-section-subtitle">Co robiÅ‚em i kiedy</div>
            <div class="edilog-scroll" id="edilogContent"></div>
        </div>

        <!-- STASH TILE (always visible) -->
        <div class="tile tile-stash" id="tile-stash">
            <div class="tile-section-title">ğŸ“¦ Schowek</div>
            <div class="tile-section-subtitle">Schowane kafelki</div>
            <div class="stash-chips" id="stashChips">
                <div class="empty-state">Pusto â€” schowaj kafelki przeÅ‚Ä…cznikiem ğŸ—‚ï¸</div>
            </div>
        </div>
    </div>

    <!-- Edi Log data (legacy hidden) -->
    <div style="display:none" id="ediLog"></div>

    <!-- App Modal -->
    <div class="modal-overlay" id="appModalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="appModalTitle">Nowa aplikacja</h3>
                <button class="modal-close" onclick="closeAppModal()">&times;</button>
            </div>
            <form id="appForm">
                <input type="hidden" id="appId">
                <div class="form-group"><label for="appName">Nazwa aplikacji *</label><input type="text" id="appName" required placeholder="np. SafeSenior Monitor"></div>
                <div class="form-group"><label for="appDesc">Opis</label><textarea id="appDesc" placeholder="Co ta aplikacja ma robiÄ‡?"></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label for="appStage">Etap</label><select id="appStage"><option value="idea">ğŸ’¡ PomysÅ‚</option><option value="planned">ğŸ“‹ W planach</option><option value="progress">ğŸ”¨ W realizacji</option><option value="done">âœ… Zrobione</option></select></div>
                    <div class="form-group"><label for="appPriority">Priorytet</label><select id="appPriority"><option value="high">ğŸ”´ Wysoki</option><option value="medium">ğŸŸ¡ Åšredni</option><option value="low">ğŸŸ¢ Niski</option></select></div>
                </div>
                <div class="form-group"><label for="appNotes">Notatki</label><textarea id="appNotes" placeholder="Kroki, technologie..."></textarea></div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAppModal()">Anuluj</button>
                    <button type="button" class="btn btn-danger" id="deleteAppBtn" onclick="deleteApp()" style="display:none;">UsuÅ„</button>
                    <button type="submit" class="btn btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Nowy task</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <input type="hidden" id="taskColumn">
                <div class="form-group"><label for="taskTitle">TytuÅ‚ *</label><input type="text" id="taskTitle" required placeholder="Co trzeba zrobiÄ‡?"></div>
                <div class="form-row">
                    <div class="form-group"><label for="taskProject">Projekt</label><select id="taskProject"><option value="dom">ğŸ  DOM</option><option value="onethree">ğŸ¬ 1THREE</option><option value="kubus">ğŸ§¸ KUBUÅš</option><option value="especto">ğŸª ESPECTO</option><option value="system">âš™ï¸ SYSTEM</option></select></div>
                    <div class="form-group"><label for="taskDeadline">Deadline</label><select id="taskDeadline"><option value="now">Teraz!</option><option value="today">DziÅ›</option><option value="week">Ten tydzieÅ„</option><option value="later">PÃ³Åºniej</option></select></div>
                </div>
                <div class="form-group"><label for="taskNotes">Notatki</label><textarea id="taskNotes" placeholder="Dodatkowe informacje..."></textarea></div>
                <div class="form-group">
                    <label for="taskAttachments">ğŸ“ ZaÅ‚Ä…czniki / Rezultaty</label>
                    <div id="attachmentsList"></div>
                    <div class="attachment-input">
                        <input type="text" id="newAttachmentName" placeholder="Nazwa">
                        <input type="text" id="newAttachmentPath" placeholder="ÅšcieÅ¼ka pliku">
                        <button type="button" class="btn btn-small" onclick="addAttachment()">+</button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Anuluj</button>
                    <button type="button" class="btn btn-danger" id="deleteBtn" onclick="deleteTask()" style="display:none;">UsuÅ„</button>
                    <button type="submit" class="btn btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CLOUD SYNC (GitHub Gist) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const GIST_ID = '5ea142fdafd9f73cafd36ecd69cec9d2';
        const GIST_FILE = 'dashboard-data.json';
        const ENC_TOKEN = {"iv":"733B6NLzzJmFZcOp","data":"eLbt3qyPpEiTc+a1n286Oeul4/3SQ3N0CIoE0BFpWOAVUVim3WpEwA==","tag":"SiRwLGUWYvSURm16hgR5Rw=="};
        let _syncTimer = null;
        let _cloudLoaded = false;
        let _ghToken = null;

        async function getToken() {
            if (_ghToken) return _ghToken;
            const pin = localStorage.getItem('ediDashAuth') ? '2452' : null;
            if (!pin) return null;
            try {
                const keyData = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(pin));
                const key = await crypto.subtle.importKey('raw', keyData, 'AES-GCM', false, ['decrypt']);
                const iv = Uint8Array.from(atob(ENC_TOKEN.iv), c => c.charCodeAt(0));
                const data = Uint8Array.from(atob(ENC_TOKEN.data), c => c.charCodeAt(0));
                const tag = Uint8Array.from(atob(ENC_TOKEN.tag), c => c.charCodeAt(0));
                const combined = new Uint8Array(data.length + tag.length);
                combined.set(data); combined.set(tag, data.length);
                const dec = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, combined);
                _ghToken = new TextDecoder().decode(dec);
                return _ghToken;
            } catch(e) { console.warn('Token decrypt failed:', e); return null; }
        }

        function saveToCloud() {
            if (_syncTimer) clearTimeout(_syncTimer);
            _syncTimer = setTimeout(async () => {
                const token = await getToken();
                if (!token) { console.warn('No token'); return; }
                const data = {
                    version: 2,
                    lastSync: new Date().toISOString(),
                    tasks: JSON.parse(localStorage.getItem('ediTasks') || '[]'),
                    projectsOnethree: JSON.parse(localStorage.getItem('ediProjectsOnethree') || '[]'),
                    projectsFirmy: JSON.parse(localStorage.getItem('ediProjectsFirmy') || '[]'),
                    projectsOwn: JSON.parse(localStorage.getItem('ediProjectsOwn') || '[]'),
                    apps: JSON.parse(localStorage.getItem('ediApps') || '[]'),
                    docs: JSON.parse(localStorage.getItem('ediDocs') || '[]'),
                    quickNotes: localStorage.getItem('ediQuickNotes') || '',
                    hiddenTiles: JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]'),
                    tileColors: JSON.parse(localStorage.getItem('dashboardTileColors') || '{}'),
                    tileOrder: JSON.parse(localStorage.getItem('dashboardTileOrder') || '[]'),
                    editMode: JSON.parse(localStorage.getItem('dashboardEditMode') || '{}'),
                };
                fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: 'PATCH',
                    headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ files: { [GIST_FILE]: { content: JSON.stringify(data) } } })
                }).then(r => { if (!r.ok) throw new Error('HTTP ' + r.status); return r; }).then(() => {
                    const indicator = document.getElementById('syncStatus');
                    if (indicator) { indicator.textContent = 'â˜ï¸ Zapisano'; indicator.style.color = 'var(--green)'; setTimeout(() => { indicator.textContent = 'â˜ï¸'; indicator.style.color = ''; }, 2000); }
                }).catch(err => {
                    console.warn('Cloud save failed:', err);
                    const indicator = document.getElementById('syncStatus');
                    if (indicator) { indicator.textContent = 'âš ï¸ Offline'; indicator.style.color = 'var(--red)'; }
                });
            }, 1500);
        }

        // Auto-refresh from cloud every 30s
        setInterval(() => {
            if (document.hidden) return;
            loadFromCloud().then(loaded => {
                if (!loaded) return;
                tasks = JSON.parse(localStorage.getItem('ediTasks') || '[]');
                const s1 = localStorage.getItem('ediProjectsOnethree'); if (s1) projectsOnethree = JSON.parse(s1);
                const s2 = localStorage.getItem('ediProjectsFirmy'); if (s2) projectsFirmy = JSON.parse(s2);
                const s3 = localStorage.getItem('ediProjectsOwn'); if (s3) projectsOwn = JSON.parse(s3);
                const sa = localStorage.getItem('ediApps'); if (sa) apps = JSON.parse(sa);
                renderTasks(); renderProjects(); renderApps();
            });
        }, 30000);

        function loadFromCloud() {
            return fetch(`https://api.github.com/gists/${GIST_ID}`, { headers: { 'Accept': 'application/vnd.github+json' } })
                .then(r => r.json())
                .then(gist => {
                    const content = gist.files && gist.files[GIST_FILE] && gist.files[GIST_FILE].content;
                    if (!content) return false;
                    const data = JSON.parse(content);
                    if (!data || !data.version) return false;
                    // Merge: only overwrite if cloud has data (non-empty arrays)
                    function setIfHasData(key, val) {
                        if (val === undefined || val === null) return;
                        const str = typeof val === 'string' ? val : JSON.stringify(val);
                        // Don't overwrite local with empty cloud data
                        const local = localStorage.getItem(key);
                        if (Array.isArray(val) && val.length === 0 && local && JSON.parse(local).length > 0) return;
                        localStorage.setItem(key, str);
                    }
                    setIfHasData('ediTasks', data.tasks);
                    setIfHasData('ediProjectsOnethree', data.projectsOnethree);
                    setIfHasData('ediProjectsFirmy', data.projectsFirmy);
                    setIfHasData('ediProjectsOwn', data.projectsOwn);
                    setIfHasData('ediApps', data.apps);
                    setIfHasData('ediDocs', data.docs);
                    if (data.quickNotes) localStorage.setItem('ediQuickNotes', data.quickNotes);
                    setIfHasData('dashboardHiddenTiles', data.hiddenTiles);
                    if (data.tileColors && Object.keys(data.tileColors).length > 0) localStorage.setItem('dashboardTileColors', JSON.stringify(data.tileColors));
                    if (data.tileOrder && data.tileOrder.length > 0) localStorage.setItem('dashboardTileOrder', JSON.stringify(data.tileOrder));
                    _cloudLoaded = true;
                    const indicator = document.getElementById('syncStatus');
                    if (indicator) { indicator.textContent = 'â˜ï¸'; indicator.style.color = 'var(--green)'; setTimeout(() => { indicator.style.color = ''; }, 2000); }
                    return true;
                })
                .catch(err => { console.warn('Cloud load failed, using localStorage:', err); return false; });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA STORAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let tasks = JSON.parse(localStorage.getItem('ediTasks')) || [];
        let projectsOnethree = [
            { id: 'onethree', driveLink: 'https://drive.google.com/open?id=1xejwSec3QdJ84kqj7uRHW2eDvLQdEsXF', docs: [{name:'1three-studio-kalendarz-luty-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/1three-studio-kalendarz-luty-2026.md'},{name:'1three-studio-programy-szkoleniowe.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/1three-studio-programy-szkoleniowe.md'},{name:'RESEARCH-1THREE-02-02.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-1THREE-02-02.md'},{name:'RESEARCH-DOFINANSOWANIA-1THREE.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-DOFINANSOWANIA-1THREE.md'},{name:'RESEARCH-SZKOLENIA-AI-POLSKA-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-SZKOLENIA-AI-POLSKA-2026.md'},{name:'RESEARCH-ZAROBKI-1THREE-2026-02.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-ZAROBKI-1THREE-2026-02.md'}], name: 'ğŸ¬ 1three.studio', desc: 'Produkcja, szkolenia, klienci', progress: 65, status: 'active',
              tasks: [{text: 'HubSpot email sync fix', done: false}, {text: 'Szkolenia BUR - nowe programy', done: false}], notes: '' },
            { id: 'kubus', driveLink: 'https://drive.google.com/open?id=1TBMMNr8d8ykIQ-vmQWF7Fu7myPr-6P8n', docs: [{name:'maspex-kubus-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/KUBUS/maspex-kubus-2026.md'},{name:'maspex-kubus-harmonogram.md',path:'/Users/t8/.openclaw/workspace/projekty/KUBUS/maspex-kubus-harmonogram.md'}], name: 'ğŸ§¸ KubuÅ› (Maspex)', desc: 'Spot reklamowy', progress: 40, status: 'urgent',
              tasks: [{text: 'Prawa ElevenLabs - mail wysÅ‚any', done: true}, {text: 'Finalny render', done: false}], notes: '' },
            { id: 'especto', driveLink: 'https://drive.google.com/open?id=1yr_og1wvrhg8J050nAfuT10KZxjic4mY', docs: [{name:'BIBLIOTEKA-PROMPTOW-GOOGLE-AI-ESPECTO.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/BIBLIOTEKA-PROMPTOW-GOOGLE-AI-ESPECTO.md'},{name:'PROCEDURY-OPERACYJNE-AI-ESPECTO.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/PROCEDURY-OPERACYJNE-AI-ESPECTO.md'},{name:'RAPORT-ESPECTO-DRAFT.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-DRAFT.md'},{name:'RAPORT-ESPECTO-FINAL.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-FINAL.md'},{name:'RAPORT-ESPECTO-v2.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-v2.md'},{name:'RAPORT_ESPECTO_GOOGLE_AI.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT_ESPECTO_GOOGLE_AI.md'},{name:'RESEARCH-GOOGLE-AI-STACK-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RESEARCH-GOOGLE-AI-STACK-2026.md'},{name:'WORKFLOW-AI-ESPECTO-MAIN.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/WORKFLOW-AI-ESPECTO-MAIN.md'},{name:'WORKFLOW-AI-GOOGLE-ESPECTO.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/WORKFLOW-AI-GOOGLE-ESPECTO.md'}], name: 'ğŸª Especto', desc: 'Audyt AI dla firmy eventowej', progress: 95, status: 'active',
              tasks: [{text: 'Dokumenty na Drive', done: true}, {text: 'ProtokÃ³Å‚ odbioru', done: false}], notes: 'Deadline: 04.02.2026' },
        ];
        let projectsFirmy = [
            { id: 'virface', docs: [], name: 'ğŸ‘¤ Virface.com', desc: 'AI avatary', progress: 80, status: 'warning', tasks: [], notes: '' },
            { id: 'aiartists', docs: [], name: 'ğŸ¨ AI Artists Agency', desc: 'Agencja artystÃ³w AI', progress: 30, status: 'warning', tasks: [{text: 'Strona www - prompt', done: false}], notes: '' },
            { id: 'safesenior', docs: [], name: 'ğŸ‘´ SafeSenior.ai', desc: 'AI dla seniorÃ³w', progress: 20, status: 'active', tasks: [], notes: '' },
        ];
        let projectsOwn = [
            { id: 'dom', driveLink: 'https://drive.google.com/open?id=1ehGwMnZhpFzLY3mY3DLaWGWpwhxA--ZQ', docs: [{name:'MPZP-INFO.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/MPZP-INFO.md'},{name:'PODSUMOWANIE-RESEARCH-03-02.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/PODSUMOWANIE-RESEARCH-03-02.md'},{name:'README.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/README.md'},{name:'RESEARCH-CENY-DZIALEK.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-CENY-DZIALEK.md'},{name:'RESEARCH-GEODECI.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-GEODECI.md'}], name: 'ğŸ  DOM Czarnochowice', desc: 'Darowizna dziaÅ‚ki od Taty', progress: 15, status: 'active',
              tasks: [{text: 'Research geodetÃ³w', done: true}, {text: 'Research cen dziaÅ‚ek', done: true}, {text: 'Dane od Taty (KW, PESEL)', done: false}], notes: 'Czekam na spotkanie z TatÄ…' },
        ];
        let apps = JSON.parse(localStorage.getItem('ediApps')) || [
            { id: 1, name: 'ğŸ¬ Operator Kamery', desc: 'Aplikacja do pisania promptÃ³w z integracjÄ… Nano Banana', stage: 'idea', priority: 'medium', notes: 'PomysÅ‚ z 03.02.2026' },
            { id: 2, name: 'ğŸ‘´ SafeSenior Monitor', desc: 'Panel zdalnego monitorowania zdrowia seniorÃ³w - integracja Apple Health', stage: 'idea', priority: 'high', notes: 'Integracja z VITRO, Apple Health Sharing, alerty' },
            { id: 3, name: 'ğŸ¯ Edi Dashboard', desc: 'Panel zarzÄ…dzania taskami i projektami', stage: 'progress', priority: 'high', notes: 'Aktualnie rozwijany!' },
        ];
        let ediLog = [
            { time: '20:38', icon: 'ğŸ“', title: 'Dokumenty Especto wrzucone na Google Drive', detail: '4 pliki w gdrive:1three/ESPECTO-AI-WORKFLOW/', tag: 'ESPECTO' },
            { time: '20:25', icon: 'ğŸ”§', title: 'ZainstalowaÅ‚em yt-dlp + stworzyÅ‚ skill', detail: 'Teraz mogÄ™ pobieraÄ‡ transkrypcje z YouTube', tag: 'SYSTEM' },
            { time: '20:19', icon: 'ğŸ“º', title: 'PobraÅ‚em transkrypcjÄ™ z YouTube', detail: 'Research Google AI tools - zaktualizowaÅ‚em dokumenty', tag: 'ESPECTO' },
            { time: '19:07', icon: 'ğŸ“', title: 'Research Google AI Stack', detail: 'Imagen 4, Veo 3.1, Gemini 3, NotebookLM - peÅ‚ny research', tag: 'ESPECTO' },
            { time: '19:00', icon: 'ğŸ“„', title: 'StworzyÅ‚ dokumenty dla Especto', detail: 'Workflow, Biblioteka promptÃ³w, Procedury operacyjne', tag: 'ESPECTO' },
            { time: '18:40', icon: 'ğŸ”', title: 'Research geodetÃ³w Wieliczka', detail: 'Lista firm z cenami i opiniami', tag: 'DOM' },
            { time: '13:52', icon: 'ğŸ¨', title: 'Dashboard v2', detail: 'Edi Command Center - pierwsza wersja', tag: 'SYSTEM' },
        ];
        let ediDocs = JSON.parse(localStorage.getItem('ediDocs')) || [
            { id: 1, name: 'RAPORT-ESPECTO-FINAL.md', type: 'raport', date: '02.02.2026', preview: 'Raport AI Video dla Especto', path: '/Users/t8/.openclaw/workspace/RAPORT-ESPECTO-FINAL.md' },
            { id: 2, name: 'RESEARCH-SZKOLENIA-AI-POLSKA-2026.md', type: 'research', date: '02.02.2026', preview: 'Analiza rynku szkoleÅ„ AI w Polsce', path: '/Users/t8/.openclaw/workspace/RESEARCH-SZKOLENIA-AI-POLSKA-2026.md' },
            { id: 3, name: 'PLAN-LUTY-2026.md', type: 'plan', date: '02.02.2026', preview: 'Plan dziaÅ‚aÅ„ na luty', path: '/Users/t8/.openclaw/workspace/PLAN-LUTY-2026.md' },
            { id: 4, name: 'RESEARCH-DOFINANSOWANIA-1THREE.md', type: 'research', date: '02.02.2026', preview: 'MoÅ¼liwoÅ›ci dofinansowania EU', path: '/Users/t8/.openclaw/workspace/RESEARCH-DOFINANSOWANIA-1THREE.md' },
            { id: 5, name: 'RESEARCH-MEMORY-UPGRADE.md', type: 'research', date: '04.02.2026', preview: 'RozwiÄ…zania dla pamiÄ™ci agenta', path: '/Users/t8/.openclaw/workspace/RESEARCH-MEMORY-UPGRADE.md' },
        ];

        if (tasks.length === 0) {
            tasks = [
                { id: 1, title: 'Research geodetÃ³w Wieliczka', project: 'dom', column: 'done', deadline: 'today', notes: '', createdAt: Date.now() },
                { id: 2, title: 'Dokumenty Especto na Drive', project: 'especto', column: 'done', deadline: 'today', notes: '', createdAt: Date.now() },
                { id: 3, title: 'HubSpot email sync fix', project: 'onethree', column: 'todo', deadline: 'week', notes: 'Emaile nie synchronizujÄ… siÄ™ od 04.12', createdAt: Date.now() },
                { id: 4, title: 'Dane od Taty (KW, PESEL)', project: 'dom', column: 'waiting', deadline: 'week', notes: 'Po spotkaniu z TatÄ…', createdAt: Date.now() },
                { id: 5, title: 'ğŸ¬ OPERATOR KAMERY - aplikacja do promptÃ³w + Nano Banana', project: 'onethree', column: 'todo', deadline: 'later', notes: 'Nowy pomysÅ‚ na aplikacjÄ™!', createdAt: Date.now() },
            ];
            saveTasks();
        }

        function renderTasks() {
            const columns = ['urgent', 'todo', 'waiting', 'done', 'onhold'];
            const stats = { urgent: 0, todo: 0, waiting: 0, done: 0, onhold: 0 };
            columns.forEach(col => {
                const container = document.getElementById(col + 'Tasks');
                const columnTasks = tasks.filter(t => t.column === col);
                stats[col] = columnTasks.length;
                if (columnTasks.length === 0) {
                    container.innerHTML = '<div class="empty-state">Brak taskÃ³w</div>';
                } else {
                    container.innerHTML = columnTasks.map((task, idx) => `
                        <div class="task-card" draggable="true" ondragstart="dragStart(event, ${task.id})" onclick="openModal('${col}', ${task.id})">
                            <span class="task-num">${String(idx + 1).padStart(2, '0')}</span>
                            <div class="task-card-content">
                                <div class="task-row">
                                    <span class="task-title">${task.title}</span>
                                    <span class="task-project ${task.project}">${getProjectLabel(task.project)}</span>
                                </div>
                                ${task.attachments && task.attachments.length > 0 ? `<div class="task-attachments">${task.attachments.map(att => `<a class="task-attachment-link" href="file://${att.path}" target="_blank" onclick="event.stopPropagation()">ğŸ“ ${att.name}</a>`).join('')}</div>` : ''}
                            </div>
                            <span class="task-status-circle ${col}"></span>
                        </div>
                    `).join('');
                }
            });
            document.getElementById('statUrgent').textContent = stats.urgent;
            document.getElementById('statTodo').textContent = stats.todo;
            document.getElementById('statWaiting').textContent = stats.waiting;
            document.getElementById('statDone').textContent = stats.done;
            document.getElementById('countUrgent').textContent = stats.urgent;
            document.getElementById('countTodo').textContent = stats.todo;
            document.getElementById('countWaiting').textContent = stats.waiting;
            document.getElementById('countDone').textContent = stats.done;
            document.getElementById('countOnhold').textContent = stats.onhold;
            document.getElementById('statOnhold').textContent = stats.onhold;
            renderProgressRing();
        }

        let draggedTaskId = null;
        function dragStart(event, taskId) { draggedTaskId = taskId; event.dataTransfer.effectAllowed = 'move'; event.target.style.opacity = '0.5'; }
        function dragOver(event) { event.preventDefault(); event.dataTransfer.dropEffect = 'move'; event.currentTarget.classList.add('drag-over'); }
        function dragLeave(event) { event.currentTarget.classList.remove('drag-over'); }
        function drop(event, newColumn) {
            event.preventDefault(); event.currentTarget.classList.remove('drag-over');
            if (draggedTaskId !== null) { const task = tasks.find(t => t.id === draggedTaskId); if (task) { task.column = newColumn; saveTasks(); renderTasks(); } draggedTaskId = null; }
        }
        document.addEventListener('dragend', function(e) { if (e.target.classList.contains('task-card')) e.target.style.opacity = '1'; document.querySelectorAll('[data-column]').forEach(col => col.classList.remove('drag-over')); });

        function renderProjects() {
            const renderCards = (projects, category) => projects.map(p => `
                <div class="project-card" data-project="${p.id}" data-category="${category}" onclick="toggleProject(this)">
                    <div class="project-item">
                        <span class="project-status ${p.status}"></span>
                        <span class="project-name" ondblclick="editProjectName('${p.id}', '${category}', event)" title="Dwuklik = edycja nazwy">${p.name}</span>
                        <div class="project-progress-wrap">
                            <div class="progress-bar"><div class="progress-fill" style="width:${p.progress}%"></div></div>
                            <span class="progress-pct">${p.progress}%</span>
                        </div>
                        <span onclick="deleteProject('${p.id}', '${category}', event)" style="cursor:pointer;opacity:0.3;font-size:9px;margin-left:2px;" title="UsuÅ„ projekt">âœ•</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="project-details">
                        <div class="project-tasks-title">ğŸ“‹ Zadania:</div>
                        <div class="project-tasks-list" id="tasks-${p.id}">
                            ${p.tasks.map((t, i) => `<div class="project-task-item ${t.done ? 'done' : ''}" style="display:flex;align-items:center;gap:4px;"><input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleProjectTask('${p.id}', ${i}, '${category}', event)"><span onclick="editProjectTask('${p.id}', ${i}, '${category}', event)" style="cursor:pointer;flex:1;" title="Kliknij by edytowaÄ‡">${t.text}</span><span onclick="deleteProjectTask('${p.id}', ${i}, '${category}', event)" style="cursor:pointer;opacity:0.4;font-size:9px;flex-shrink:0;" title="UsuÅ„">âœ•</span></div>`).join('') || '<div style="color:var(--text-secondary);font-size:9px">Brak zadaÅ„</div>'}
                        </div>
                        <div class="add-project-task">
                            <input type="text" placeholder="Nowe zadanie..." id="newTask-${p.id}" onkeypress="if(event.key==='Enter') addProjectTask('${p.id}', '${category}', event)">
                            <button onclick="addProjectTask('${p.id}', '${category}', event)">+</button>
                        </div>
                        <div class="project-notes"><div class="project-notes-label">ğŸ“ Notatki:</div><textarea placeholder="Dodaj notatki..." onchange="updateProjectNotes('${p.id}', '${category}', this.value)" onclick="event.stopPropagation()">${p.notes || ''}</textarea></div>
                        ${p.driveLink ? `<a class="drive-link-btn" href="${p.driveLink}" target="_blank" onclick="event.stopPropagation()">ğŸ“ OtwÃ³rz folder na Drive</a>` : ''}
                        <div class="project-docs"><div class="project-docs-label">ğŸ“„ Dokumenty:</div><div class="project-docs-list">${(p.docs && p.docs.length > 0) ? p.docs.map(d => `<a class="project-doc-link" href="file://${d.path}" target="_blank" onclick="event.stopPropagation()">ğŸ“„ ${d.name}</a>`).join('') : '<div style="color:var(--text-secondary);font-size:9px">Brak dokumentÃ³w</div>'}</div></div>
                    </div>
                </div>
            `).join('');
            document.getElementById('projectsOnethree').innerHTML = renderCards(projectsOnethree, 'onethree');
            document.getElementById('projectsFirmy').innerHTML = renderCards(projectsFirmy, 'firmy');
            document.getElementById('projectsOwn').innerHTML = renderCards(projectsOwn, 'own');
        }

        function toggleProject(card) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.tagName === 'BUTTON') return;
            const wasExpanded = card.classList.contains('expanded');
            // Close any other expanded cards
            document.querySelectorAll('.project-card.expanded').forEach(c => c.classList.remove('expanded'));
            let overlay = document.getElementById('projectOverlay');
            if (!overlay) { overlay = document.createElement('div'); overlay.id = 'projectOverlay'; overlay.className = 'project-overlay'; overlay.onclick = () => { document.querySelectorAll('.project-card.expanded').forEach(c => c.classList.remove('expanded')); overlay.classList.remove('active'); }; document.body.appendChild(overlay); }
            if (!wasExpanded) { card.classList.add('expanded'); overlay.classList.add('active'); } else { overlay.classList.remove('active'); }
        }
        function getProjectArray(category) { if (category === 'onethree') return projectsOnethree; if (category === 'firmy') return projectsFirmy; if (category === 'own') return projectsOwn; }

        function toggleProjectTask(projectId, taskIndex, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (project && project.tasks[taskIndex]) { project.tasks[taskIndex].done = !project.tasks[taskIndex].done; saveProjectData(); renderProjects(); setTimeout(() => { document.querySelector(`[data-project="${projectId}"]`).classList.add('expanded'); }, 10); }
        }

        function addProjectTask(projectId, category, event) {
            event.stopPropagation();
            const input = document.getElementById(`newTask-${projectId}`);
            const text = input.value.trim(); if (!text) return;
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (project) { project.tasks.push({ text, done: false }); saveProjectData(); renderProjects(); setTimeout(() => { document.querySelector(`[data-project="${projectId}"]`).classList.add('expanded'); }, 10); }
        }

        function updateProjectNotes(projectId, category, notes) { const projects = getProjectArray(category); const project = projects.find(p => p.id === projectId); if (project) { project.notes = notes; saveProjectData(); } }

        function editProjectTask(projectId, taskIndex, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (!project || !project.tasks[taskIndex]) return;
            const newText = prompt('Edytuj zadanie:', project.tasks[taskIndex].text);
            if (newText === null) return;
            if (newText.trim() === '') { deleteProjectTask(projectId, taskIndex, category, event); return; }
            project.tasks[taskIndex].text = newText.trim();
            saveProjectData(); renderProjects();
            setTimeout(() => { const card = document.querySelector(`[data-project="${projectId}"]`); if (card) card.classList.add('expanded'); }, 10);
        }

        function deleteProjectTask(projectId, taskIndex, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            project.tasks.splice(taskIndex, 1);
            saveProjectData(); renderProjects();
            setTimeout(() => { const card = document.querySelector(`[data-project="${projectId}"]`); if (card) card.classList.add('expanded'); }, 10);
        }

        function openAddProjectModal(category) {
            const name = prompt('Nazwa projektu:');
            if (!name || !name.trim()) return;
            const desc = prompt('Opis (opcjonalnie):') || '';
            const projects = getProjectArray(category);
            const id = name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now();
            projects.push({ id, name: name.trim(), desc: desc.trim(), progress: 0, status: 'active', tasks: [], notes: '', docs: [] });
            saveProjectData();
            renderProjects();
        }

        function deleteProject(projectId, category, event) {
            event.stopPropagation();
            if (!confirm('UsunÄ…Ä‡ ten projekt?')) return;
            const projects = getProjectArray(category);
            const idx = projects.findIndex(p => p.id === projectId);
            if (idx > -1) { projects.splice(idx, 1); saveProjectData(); renderProjects(); }
        }

        function editProjectName(projectId, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            const newName = prompt('Nazwa projektu:', project.name);
            if (newName === null || !newName.trim()) return;
            project.name = newName.trim();
            const newDesc = prompt('Opis (obecny: ' + (project.desc || 'brak') + '):', project.desc || '');
            if (newDesc !== null) project.desc = newDesc.trim();
            saveProjectData(); renderProjects();
        }
        function saveProjectData() { localStorage.setItem('ediProjectsOnethree', JSON.stringify(projectsOnethree)); localStorage.setItem('ediProjectsFirmy', JSON.stringify(projectsFirmy)); localStorage.setItem('ediProjectsOwn', JSON.stringify(projectsOwn)); saveToCloud(); }

        const defaultDocs = {
            onethree: { driveLink: 'https://drive.google.com/open?id=1xejwSec3QdJ84kqj7uRHW2eDvLQdEsXF', docs: [{name:'1three-studio-kalendarz-luty-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/1three-studio-kalendarz-luty-2026.md'},{name:'RESEARCH-SZKOLENIA-AI-POLSKA-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-SZKOLENIA-AI-POLSKA-2026.md'}] },
            kubus: { driveLink: 'https://drive.google.com/open?id=1TBMMNr8d8ykIQ-vmQWF7Fu7myPr-6P8n', docs: [{name:'maspex-kubus-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/KUBUS/maspex-kubus-2026.md'}] },
            especto: { driveLink: 'https://drive.google.com/open?id=1yr_og1wvrhg8J050nAfuT10KZxjic4mY', docs: [{name:'ğŸ“Š Raport AI Video',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-FINAL.md'},{name:'âš™ï¸ Workflow Google AI',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/WORKFLOW-AI-GOOGLE-ESPECTO.md'},{name:'ğŸ“ Biblioteka promptÃ³w',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/BIBLIOTEKA-PROMPTOW-GOOGLE-AI-ESPECTO.md'},{name:'ğŸ“‹ Procedury operacyjne',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/PROCEDURY-OPERACYJNE-AI-ESPECTO.md'},{name:'ğŸ” Research Google AI',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RESEARCH-GOOGLE-AI-STACK-2026.md'}] },
            dom: { driveLink: 'https://drive.google.com/open?id=1ehGwMnZhpFzLY3mY3DLaWGWpwhxA--ZQ', docs: [{name:'RESEARCH-GEODECI.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-GEODECI.md'},{name:'RESEARCH-CENY-DZIALEK.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-CENY-DZIALEK.md'}] },
            virface: { driveLink: '', docs: [] }, aiartists: { driveLink: '', docs: [] }, safesenior: { driveLink: '', docs: [] },
        };

        function loadProjectData() {
            const saved1 = localStorage.getItem('ediProjectsOnethree');
            const saved2 = localStorage.getItem('ediProjectsFirmy');
            const saved3 = localStorage.getItem('ediProjectsOwn');
            if (saved1) projectsOnethree = JSON.parse(saved1);
            if (saved2) projectsFirmy = JSON.parse(saved2);
            if (saved3) projectsOwn = JSON.parse(saved3);
            [projectsOnethree, projectsFirmy, projectsOwn].flat().forEach(p => { if (defaultDocs[p.id]) { p.docs = defaultDocs[p.id].docs; p.driveLink = defaultDocs[p.id].driveLink; } });
            saveProjectData();
        }

        function getProjectLabel(project) { const labels = { dom: 'DOM', onethree: '1THREE', kubus: 'KUBUÅš', especto: 'ESPECTO', system: 'SYSTEM' }; return labels[project] || project.toUpperCase(); }
        function getDeadlineLabel(deadline) { const labels = { now: 'ğŸ”¥ Teraz!', today: 'DziÅ›', week: 'Ten tydzieÅ„', later: 'PÃ³Åºniej' }; return labels[deadline] || deadline; }

        let currentAttachments = [];
        function renderAttachments() {
            const container = document.getElementById('attachmentsList');
            if (currentAttachments.length === 0) { container.innerHTML = '<div style="color:var(--text-secondary);font-size:9px;padding:4px 0">Brak zaÅ‚Ä…cznikÃ³w</div>'; return; }
            container.innerHTML = currentAttachments.map((att, idx) => `<div class="attachment-item"><span>ğŸ“</span><a href="file://${att.path}" target="_blank">${att.name}</a><span class="attachment-remove" onclick="removeAttachment(${idx})">âœ•</span></div>`).join('');
        }
        function addAttachment() { const name = document.getElementById('newAttachmentName').value.trim(); const path = document.getElementById('newAttachmentPath').value.trim(); if (!name || !path) return; currentAttachments.push({ name, path }); document.getElementById('newAttachmentName').value = ''; document.getElementById('newAttachmentPath').value = ''; renderAttachments(); }
        function removeAttachment(idx) { currentAttachments.splice(idx, 1); renderAttachments(); }

        function openModal(column, taskId = null) {
            const modal = document.getElementById('modalOverlay'); const form = document.getElementById('taskForm'); const title = document.getElementById('modalTitle'); const deleteBtn = document.getElementById('deleteBtn');
            form.reset(); document.getElementById('taskColumn').value = column;
            if (taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (task) { title.textContent = 'Edytuj task'; document.getElementById('taskId').value = task.id; document.getElementById('taskTitle').value = task.title; document.getElementById('taskProject').value = task.project; document.getElementById('taskDeadline').value = task.deadline; document.getElementById('taskNotes').value = task.notes || ''; document.getElementById('taskColumn').value = task.column; currentAttachments = task.attachments || []; renderAttachments(); deleteBtn.style.display = 'block'; }
            } else { title.textContent = 'Nowy task'; document.getElementById('taskId').value = ''; currentAttachments = []; renderAttachments(); deleteBtn.style.display = 'none'; }
            modal.classList.add('active'); document.getElementById('taskTitle').focus();
        }
        function closeModal() { document.getElementById('modalOverlay').classList.remove('active'); }

        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('taskId').value;
            const taskData = { title: document.getElementById('taskTitle').value, project: document.getElementById('taskProject').value, column: document.getElementById('taskColumn').value, deadline: document.getElementById('taskDeadline').value, notes: document.getElementById('taskNotes').value, attachments: currentAttachments };
            if (id) { const index = tasks.findIndex(t => t.id === parseInt(id)); if (index !== -1) tasks[index] = { ...tasks[index], ...taskData }; }
            else { taskData.id = Date.now(); taskData.createdAt = Date.now(); tasks.push(taskData); }
            saveTasks(); renderTasks(); closeModal();
        });

        function deleteTask() { const id = document.getElementById('taskId').value; if (id && confirm('Na pewno usunÄ…Ä‡ ten task?')) { tasks = tasks.filter(t => t.id !== parseInt(id)); saveTasks(); renderTasks(); closeModal(); } }
        function saveTasks() { localStorage.setItem('ediTasks', JSON.stringify(tasks)); saveToCloud(); }
        document.getElementById('modalOverlay').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { closeModal(); closeAppModal(); } });

        async function loadEdiLog() { try { const response = await fetch('edi-log.json'); if (response.ok) { const data = await response.json(); ediLog = data.log || ediLog; } } catch (e) {} }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EDI LOG TILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let edilogData = null;
        async function loadEdiLogTile() {
            try {
                const resp = await fetch('edilog-data.json');
                if (resp.ok) edilogData = await resp.json();
            } catch(e) {}
            renderEdiLogTile();
        }
        function renderEdiLogTile() {
            const container = document.getElementById('edilogContent');
            if (!edilogData || !edilogData.days || edilogData.days.length === 0) {
                container.innerHTML = '<div class="empty-state">Brak logÃ³w</div>';
                return;
            }
            const today = new Date().toISOString().slice(0,10);
            container.innerHTML = edilogData.days.map((day, i) => {
                const isToday = day.date === today;
                const collapsed = !isToday;
                const label = isToday ? 'ğŸ“ Dzisiaj' : day.date === getYesterday() ? 'ğŸ• Wczoraj' : day.date;
                return `<div class="edilog-day">
                    <div class="edilog-day-header" onclick="toggleLogDay(${i})">
                        <span>${label}${day.summary && !isToday ? '<span class=edilog-day-summary>' + day.summary + '</span>' : ''}</span>
                        <span class="arrow ${collapsed ? 'collapsed' : ''}" id="logArrow${i}">â–¼</span>
                    </div>
                    <div class="edilog-entries ${collapsed ? 'collapsed' : ''}" id="logEntries${i}">
                        ${day.entries.map(e => `<div class="edilog-entry">
                            <span class="edilog-time">${e.time}</span>
                            <span class="edilog-icon">${e.icon || 'ğŸ“Œ'}</span>
                            <span class="edilog-text">${e.title}${e.detail ? '<br><span class=detail>' + e.detail + '</span>' : ''}</span>
                            ${e.tag ? '<span class=edilog-tag>' + e.tag + '</span>' : ''}
                        </div>`).join('')}
                    </div>
                </div>`;
            }).join('');
        }
        function toggleLogDay(i) {
            const entries = document.getElementById('logEntries' + i);
            const arrow = document.getElementById('logArrow' + i);
            entries.classList.toggle('collapsed');
            arrow.classList.toggle('collapsed');
        }
        function getYesterday() {
            const d = new Date(); d.setDate(d.getDate() - 1);
            return d.toISOString().slice(0,10);
        }

        function renderDocuments() {
            const container = document.getElementById('ediDocs');
            if (ediDocs.length === 0) { container.innerHTML = '<div class="empty-state">Brak dokumentÃ³w</div>'; return; }
            container.innerHTML = ediDocs.map(doc => `<a class="doc-pill" href="file://${doc.path}" target="_blank">ğŸ“„ ${doc.name} <span class="doc-type ${doc.type}">${doc.type.toUpperCase()}</span></a>`).join('');
        }
        function addDocument(name, type, preview, path) { ediDocs.unshift({ id: Date.now(), name, type, date: new Date().toLocaleDateString('pl-PL'), preview, path }); localStorage.setItem('ediDocs', JSON.stringify(ediDocs)); renderDocuments(); saveToCloud(); }

        function renderApps() {
            const container = document.getElementById('appsInline');
            const stageLabels = { idea: 'POMYSÅ', planned: 'PLAN', progress: 'WIP', done: 'DONE' };
            container.innerHTML = apps.map(app => `<div class="app-pill ${app.priority}" onclick="openAppModal(${app.id})"><span style="font-size:10px;font-weight:600">${app.name}</span><span class="app-stage ${app.stage}">${stageLabels[app.stage]}</span></div>`).join('') + `<div class="add-app-inline" onclick="openAppModal()">+ Dodaj</div>`;
        }

        function openAppModal(appId = null) {
            const modal = document.getElementById('appModalOverlay'); const form = document.getElementById('appForm'); const title = document.getElementById('appModalTitle'); const deleteBtn = document.getElementById('deleteAppBtn');
            form.reset();
            if (appId) { const app = apps.find(a => a.id === appId); if (app) { title.textContent = 'Edytuj aplikacjÄ™'; document.getElementById('appId').value = app.id; document.getElementById('appName').value = app.name; document.getElementById('appDesc').value = app.desc; document.getElementById('appStage').value = app.stage; document.getElementById('appPriority').value = app.priority; document.getElementById('appNotes').value = app.notes || ''; deleteBtn.style.display = 'block'; } }
            else { title.textContent = 'Nowa aplikacja'; document.getElementById('appId').value = ''; deleteBtn.style.display = 'none'; }
            modal.classList.add('active'); document.getElementById('appName').focus();
        }
        function closeAppModal() { document.getElementById('appModalOverlay').classList.remove('active'); }

        document.getElementById('appForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('appId').value;
            const appData = { name: document.getElementById('appName').value, desc: document.getElementById('appDesc').value, stage: document.getElementById('appStage').value, priority: document.getElementById('appPriority').value, notes: document.getElementById('appNotes').value };
            if (id) { const index = apps.findIndex(a => a.id === parseInt(id)); if (index !== -1) apps[index] = { ...apps[index], ...appData }; }
            else { appData.id = Date.now(); apps.push(appData); }
            saveApps(); renderApps(); closeAppModal();
        });
        function deleteApp() { const id = document.getElementById('appId').value; if (id && confirm('Na pewno usunÄ…Ä‡ tÄ™ aplikacjÄ™?')) { apps = apps.filter(a => a.id !== parseInt(id)); saveApps(); renderApps(); closeAppModal(); } }
        function saveApps() { localStorage.setItem('ediApps', JSON.stringify(apps)); saveToCloud(); }
        document.getElementById('appModalOverlay').addEventListener('click', function(e) { if (e.target === this) closeAppModal(); });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CALENDAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let calYear = 2026, calMonth = 1; // 0-indexed: 1 = February
        const monthNames = ['StyczeÅ„','Luty','Marzec','KwiecieÅ„','Maj','Czerwiec','Lipiec','SierpieÅ„','WrzesieÅ„','PaÅºdziernik','Listopad','GrudzieÅ„'];
        const dayNames = ['Pn','Wt','Åšr','Cz','Pt','So','Nd'];

        function renderCalendar() {
            document.getElementById('calTitle').textContent = `${monthNames[calMonth]} ${calYear}`;
            const grid = document.getElementById('calGrid');
            const today = new Date();
            const firstDay = new Date(calYear, calMonth, 1);
            const lastDay = new Date(calYear, calMonth + 1, 0);
            let startDay = firstDay.getDay(); // 0=Sun
            startDay = startDay === 0 ? 6 : startDay - 1; // Convert to Mon=0

            let html = dayNames.map(d => `<div class="cal-day-name">${d}</div>`).join('');

            // Previous month days
            const prevLastDay = new Date(calYear, calMonth, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="cal-day other-month">${prevLastDay - i}</div>`;
            }

            // Current month days
            for (let d = 1; d <= lastDay.getDate(); d++) {
                const isToday = today.getFullYear() === calYear && today.getMonth() === calMonth && today.getDate() === d;
                html += `<div class="cal-day${isToday ? ' today' : ''}">${d}</div>`;
            }

            // Next month days
            const totalCells = startDay + lastDay.getDate();
            const remaining = (7 - (totalCells % 7)) % 7;
            for (let i = 1; i <= remaining; i++) {
                html += `<div class="cal-day other-month">${i}</div>`;
            }

            grid.innerHTML = html;
        }

        function changeMonth(delta) {
            calMonth += delta;
            if (calMonth > 11) { calMonth = 0; calYear++; }
            if (calMonth < 0) { calMonth = 11; calYear--; }
            renderCalendar();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PROGRESS RING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderProgressRing() {
            const total = tasks.length;
            const done = tasks.filter(t => t.column === 'done').length;
            const pct = total > 0 ? Math.round((done / total) * 100) : 0;
            const circumference = 2 * Math.PI * 45; // ~282.7
            const offset = circumference - (pct / 100) * circumference;

            const ring = document.getElementById('progressRing');
            ring.style.strokeDashoffset = offset;

            document.getElementById('progressPct').textContent = pct + '%';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUICK NOTES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let notesSaveTimeout;
        function saveQuickNotes() {
            clearTimeout(notesSaveTimeout);
            notesSaveTimeout = setTimeout(() => {
                localStorage.setItem('ediQuickNotes', document.getElementById('quickNotes').value);
                saveToCloud();
                const saved = document.getElementById('notesSaved');
                saved.classList.add('show');
                setTimeout(() => saved.classList.remove('show'), 1500);
            }, 500);
        }
        function loadQuickNotes() {
            const saved = localStorage.getItem('ediQuickNotes');
            if (saved) document.getElementById('quickNotes').value = saved;
        }

        // Load from cloud first, then render
        (async function initDashboard() {
            try {
                await loadFromCloud();
                // Reload variables from localStorage (which cloud just updated)
                tasks = JSON.parse(localStorage.getItem('ediTasks') || '[]');
                const s1 = localStorage.getItem('ediProjectsOnethree'); if (s1) projectsOnethree = JSON.parse(s1);
                const s2 = localStorage.getItem('ediProjectsFirmy'); if (s2) projectsFirmy = JSON.parse(s2);
                const s3 = localStorage.getItem('ediProjectsOwn'); if (s3) projectsOwn = JSON.parse(s3);
                const sa = localStorage.getItem('ediApps'); if (sa) apps = JSON.parse(sa);
                const sd = localStorage.getItem('ediDocs'); if (sd) ediDocs = JSON.parse(sd);
            } catch(e) { console.warn('Cloud init failed, using local:', e); }

            loadProjectData();
            renderTasks();
            renderProjects();
            renderApps();
            loadEdiLog();
            loadEdiLogTile();
            initTileStash();
            renderDocuments();
            renderCalendar();
            loadQuickNotes();
        })();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TILE STASH (HIDE/SHOW) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function initTileStash() {
            const tiles = document.querySelectorAll('.bento-grid > .tile');
            const hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');

            // Add close button to each tile
            tiles.forEach(tile => {
                if (tile.id === 'tile-settings' || tile.id === 'tile-stash') return; // don't hide settings or stash
                const btn = document.createElement('div');
                btn.className = 'tile-close-btn';
                btn.innerHTML = 'âœ•';
                btn.title = 'Schowaj';
                btn.onclick = (e) => { e.stopPropagation(); hideTile(tile.id); };
                tile.appendChild(btn);
            });

            // Restore hidden state
            hidden.forEach(id => {
                const tile = document.getElementById(id);
                if (tile) tile.classList.add('hidden-tile');
            });
            renderStash();
        }

        function hideTile(id) {
            const tile = document.getElementById(id);
            if (!tile) return;
            tile.classList.add('hidden-tile');
            const hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');
            if (!hidden.includes(id)) hidden.push(id);
            localStorage.setItem('dashboardHiddenTiles', JSON.stringify(hidden));
            renderStash();
        }

        function showTile(id) {
            const tile = document.getElementById(id);
            if (!tile) return;
            tile.classList.remove('hidden-tile');
            let hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');
            hidden = hidden.filter(h => h !== id);
            localStorage.setItem('dashboardHiddenTiles', JSON.stringify(hidden));
            renderStash();
        }

        function getTileName(id) {
            const names = {
                'tile-logo': 'ğŸ¯ Command Center',
                'tile-statsbar': 'ğŸ“Š Stats',
                'tile-kanban-urgent': 'ğŸ”´ Pilne',
                'tile-kanban-todo': 'ğŸ“‹ TODO',
                'tile-kanban-waiting': 'â³ Czekam',
                'tile-kanban-done': 'âœ… Done',
                'tile-kanban-onhold': 'â¸ï¸ On Hold',
                'tile-proj-1three': 'ğŸ¬ 1three',
                'tile-proj-firmy': 'ğŸ¢ Firmy',
                'tile-proj-own': 'ğŸ  WÅ‚asne',
                'tile-apps': 'ğŸš€ Aplikacje',
                'tile-docs': 'ğŸ“„ Dokumenty',
                'tile-calendar': 'ğŸ“… Kalendarz',
                'tile-progress': 'ğŸ“ˆ Progress',
                'tile-notes': 'ğŸ“ Notes',
                'tile-edilog': 'ğŸ“‹ Edi Log',
            };
            return names[id] || id;
        }

        const toggleStashEl = document.getElementById('toggleStash');
        toggleStashEl.addEventListener('change', () => {
            document.body.classList.toggle('stash-mode', toggleStashEl.checked);
        });

        function renderStash() {
            const container = document.getElementById('stashChips');
            const hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');
            if (hidden.length === 0) {
                container.innerHTML = '<div class="empty-state">Pusto â€” schowaj kafelki przeÅ‚Ä…cznikiem ğŸ—‚ï¸</div>';
                return;
            }
            container.innerHTML = hidden.map(id => `<span class="stash-chip" onclick="showTile('${id}')">${getTileName(id)}</span>`).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS TOGGLES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const toggleDragEl = document.getElementById('toggleDrag');
        const toggleColorsEl = document.getElementById('toggleColors');
        const toggleResizeEl = document.getElementById('toggleResize');

        function loadEditMode() {
            const saved = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
            toggleDragEl.checked = !!saved.drag;
            toggleColorsEl.checked = !!saved.colors;
            toggleResizeEl.checked = !!saved.resize;
        }
        function saveEditMode() {
            const freeLayoutEl = document.getElementById('toggleFreeLayout');
            localStorage.setItem('dashboardEditMode', JSON.stringify({ drag: toggleDragEl.checked, colors: toggleColorsEl.checked, resize: toggleResizeEl.checked, freeLayout: freeLayoutEl ? freeLayoutEl.checked : false }));
        }
        function applyToggleStates() {
            const dragOn = toggleDragEl.checked;
            const colorsOn = toggleColorsEl.checked;
            const resizeOn = toggleResizeEl.checked;
            document.querySelectorAll('.tile-grip').forEach(g => { g.classList.toggle('hidden', !dragOn); g.draggable = dragOn; });
            document.querySelectorAll('.tile-color-btn').forEach(b => b.classList.toggle('hidden', !colorsOn));
            document.querySelectorAll('.tile-resize-handle').forEach(c => c.classList.toggle('hidden', !resizeOn));
        }
        toggleDragEl.addEventListener('change', () => { saveEditMode(); applyToggleStates(); });
        toggleColorsEl.addEventListener('change', () => { saveEditMode(); applyToggleStates(); });
        toggleResizeEl.addEventListener('change', () => { saveEditMode(); applyToggleStates(); });
        loadEditMode();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TILE DRAG & DROP + COLOR PICKER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        (function() {
            const grid = document.querySelector('.bento-grid');
            const tileColorPresets = [
                { name: 'Default', value: '' },
                { name: 'Fioletowy', value: 'rgba(124,58,237,0.15)' },
                { name: 'Zielony', value: 'rgba(16,185,129,0.15)' },
                { name: 'Niebieski', value: 'rgba(59,130,246,0.15)' },
                { name: 'Czerwony', value: 'rgba(239,68,68,0.15)' },
                { name: 'Å»Ã³Å‚ty', value: 'rgba(245,158,11,0.15)' },
                { name: 'RÃ³Å¼owy', value: 'rgba(236,72,153,0.15)' },
                { name: 'Ciemny', value: 'rgba(0,0,0,0.3)' },
            ];
            const swatchColors = ['rgba(255,255,255,0.08)','#7C3AED','#10b981','#3b82f6','#ef4444','#f59e0b','#EC4899','#1a1a2e'];

            let tileDragId = null;
            let activeColorPicker = null;
            let freeLayoutOn = false;

            function getAllTiles() { return Array.from(grid.querySelectorAll(':scope > .tile')); }

            // Add grip + color btn to each tile
            function initTileUI() {
                getAllTiles().forEach(tile => {
                    if (tile.querySelector('.tile-grip')) return;
                    // Grip handle
                    const grip = document.createElement('span');
                    grip.className = 'tile-grip';
                    grip.textContent = 'â ¿';
                    grip.draggable = true;
                    grip.addEventListener('dragstart', onTileDragStart);
                    tile.prepend(grip);

                    // Color button
                    const colorBtn = document.createElement('span');
                    colorBtn.className = 'tile-color-btn';
                    colorBtn.textContent = 'ğŸ¨';
                    colorBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        if (!toggleColorsEl.checked) return;
                        toggleColorPicker(tile);
                    });
                    tile.appendChild(colorBtn);

                    // Tile drag events (on the tile itself for dragover/drop)
                    tile.addEventListener('dragover', onTileDragOver);
                    tile.addEventListener('dragleave', onTileDragLeave);
                    tile.addEventListener('drop', onTileDrop);
                });
            }

            function onTileDragStart(e) {
                if (!toggleDragEl.checked || freeLayoutOn) { e.preventDefault(); return; }
                const tile = e.target.closest('.tile');
                tileDragId = tile.id;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/tile-id', tile.id);
                requestAnimationFrame(() => tile.classList.add('tile-dragging'));
            }

            function onTileDragOver(e) {
                if (!tileDragId) return;
                // Don't interfere with task card drag (check if dataTransfer has tile-id)
                const tile = e.currentTarget.closest('.tile');
                if (!tile || tile.id === tileDragId) return;
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                tile.classList.add('tile-drag-over');
            }

            function onTileDragLeave(e) {
                const tile = e.currentTarget.closest('.tile');
                if (tile) tile.classList.remove('tile-drag-over');
            }

            function onTileDrop(e) {
                const targetTile = e.currentTarget.closest('.tile');
                if (!targetTile || !tileDragId || targetTile.id === tileDragId) return;
                // Only handle tile drops (not task card drops)
                const droppedTileId = e.dataTransfer.getData('text/tile-id');
                if (!droppedTileId) return;
                e.preventDefault();
                e.stopPropagation();
                targetTile.classList.remove('tile-drag-over');

                const sourceTile = document.getElementById(droppedTileId);
                if (!sourceTile) return;

                // Swap in DOM
                const sourceNext = sourceTile.nextElementSibling;
                const targetNext = targetTile.nextElementSibling;
                const parent = grid;

                if (sourceNext === targetTile) {
                    parent.insertBefore(targetTile, sourceTile);
                } else if (targetNext === sourceTile) {
                    parent.insertBefore(sourceTile, targetTile);
                } else {
                    const placeholder = document.createComment('swap');
                    parent.insertBefore(placeholder, sourceTile);
                    parent.insertBefore(sourceTile, targetNext);
                    parent.insertBefore(targetTile, placeholder);
                    placeholder.remove();
                }

                // Bounce animation
                [sourceTile, targetTile].forEach(t => {
                    t.classList.add('tile-drop-anim');
                    t.addEventListener('animationend', () => t.classList.remove('tile-drop-anim'), { once: true });
                });

                saveTileOrder();
            }

            document.addEventListener('dragend', function(e) {
                if (tileDragId) {
                    const tile = document.getElementById(tileDragId);
                    if (tile) tile.classList.remove('tile-dragging');
                    tileDragId = null;
                    getAllTiles().forEach(t => t.classList.remove('tile-drag-over'));
                }
            });

            function saveTileOrder() {
                const order = getAllTiles().map(t => t.id);
                localStorage.setItem('dashboardTileOrder', JSON.stringify(order));
            }

            function restoreTileOrder() {
                const saved = localStorage.getItem('dashboardTileOrder');
                if (!saved) return;
                try {
                    const order = JSON.parse(saved);
                    order.forEach(id => {
                        const tile = document.getElementById(id);
                        if (tile) grid.appendChild(tile);
                    });
                } catch(e) {}
            }

            // Color picker
            function toggleColorPicker(tile) {
                closeColorPicker();
                const picker = document.createElement('div');
                picker.className = 'tile-color-picker';
                const savedColors = JSON.parse(localStorage.getItem('dashboardTileColors') || '{}');
                const currentColor = savedColors[tile.id] || '';

                tileColorPresets.forEach((preset, i) => {
                    const swatch = document.createElement('div');
                    swatch.className = 'tile-color-swatch' + (currentColor === preset.value ? ' active' : '');
                    swatch.style.background = swatchColors[i];
                    swatch.title = preset.name;
                    swatch.addEventListener('click', function(e) {
                        e.stopPropagation();
                        applyTileColor(tile, preset.value);
                        closeColorPicker();
                    });
                    picker.appendChild(swatch);
                });

                tile.appendChild(picker);
                activeColorPicker = picker;
            }

            function closeColorPicker() {
                if (activeColorPicker) {
                    activeColorPicker.remove();
                    activeColorPicker = null;
                }
            }

            function colorToRgba(hex, alpha) {
                // Convert hex or color name to rgba
                const ctx = document.createElement('canvas').getContext('2d');
                ctx.fillStyle = hex;
                const computed = ctx.fillStyle; // always returns hex
                const r = parseInt(computed.slice(1,3),16);
                const g = parseInt(computed.slice(3,5),16);
                const b = parseInt(computed.slice(5,7),16);
                return `rgba(${r},${g},${b},${alpha})`;
            }

            function applyTileColor(tile, colorValue) {
                const savedColors = JSON.parse(localStorage.getItem('dashboardTileColors') || '{}');
                if (colorValue) {
                    tile.style.background = `linear-gradient(145deg, ${colorValue}, rgba(255,255,255,0.04) 50%, ${colorValue})`;
                    savedColors[tile.id] = colorValue;
                } else {
                    tile.style.background = '';
                    delete savedColors[tile.id];
                }
                localStorage.setItem('dashboardTileColors', JSON.stringify(savedColors));
            }

            function restoreTileColors() {
                const saved = JSON.parse(localStorage.getItem('dashboardTileColors') || '{}');
                Object.entries(saved).forEach(([id, color]) => {
                    const tile = document.getElementById(id);
                    if (tile && color) {
                        tile.style.background = `linear-gradient(145deg, ${color}, rgba(255,255,255,0.04) 50%, ${color})`;
                    }
                });
            }

            // Close color picker on outside click
            document.addEventListener('click', function(e) {
                if (activeColorPicker && !e.target.closest('.tile-color-picker') && !e.target.closest('.tile-color-btn')) {
                    closeColorPicker();
                }
            });

            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TILE RESIZE (DRAG) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            function getTileSizes() {
                return JSON.parse(localStorage.getItem('dashboardTileSizes') || '{}');
            }
            function saveTileSizes(sizes) {
                localStorage.setItem('dashboardTileSizes', JSON.stringify(sizes));
            }

            function getDefaultSpan(tile) {
                const cs = window.getComputedStyle(tile);
                const colMatch = cs.gridColumnEnd.match(/span\s+(\d+)/);
                const rowMatch = cs.gridRowEnd.match(/span\s+(\d+)/);
                let cols = colMatch ? parseInt(colMatch[1]) : 2;
                let rows = rowMatch ? parseInt(rowMatch[1]) : 1;
                const inlineCol = tile.style.gridColumn.match(/span\s+(\d+)/);
                const inlineRow = tile.style.gridRow.match(/span\s+(\d+)/);
                if (inlineCol) cols = parseInt(inlineCol[1]);
                if (inlineRow) rows = parseInt(inlineRow[1]);
                return { cols, rows };
            }

            function applyTileSize(tile, cols, rows) {
                tile.style.gridColumn = 'span ' + cols;
                tile.style.gridRow = 'span ' + rows;
            }

            function initResizeControls() {
                const sizes = getTileSizes();
                getAllTiles().forEach(tile => {
                    if (tile.querySelector('.tile-resize-handle')) return;
                    const saved = sizes[tile.id];
                    const def = getDefaultSpan(tile);
                    const cols = saved ? saved.cols : def.cols;
                    const rows = saved ? saved.rows : def.rows;
                    if (saved) applyTileSize(tile, cols, rows);

                    const handle = document.createElement('div');
                    handle.className = 'tile-resize-handle';
                    tile.appendChild(handle);

                    handle.addEventListener('mousedown', function(e) {
                        if (!toggleResizeEl.checked) return;
                        e.preventDefault();
                        e.stopPropagation();

                        const gridRect = grid.getBoundingClientRect();
                        const colWidth = gridRect.width / 12;
                        const gap = 6;
                        // Compute row height from tile's current rendered height per row
                        const curSpan = getDefaultSpan(tile);
                        const tileRect = tile.getBoundingClientRect();
                        const rowHeight = tileRect.height / curSpan.rows;

                        const startX = e.clientX;
                        const startY = e.clientY;
                        const startCols = curSpan.cols;
                        const startRows = curSpan.rows;

                        tile.classList.add('tile-resizing');
                        document.body.classList.add('resize-dragging');

                        function onMouseMove(ev) {
                            const deltaX = ev.clientX - startX;
                            const deltaY = ev.clientY - startY;
                            let newCols = startCols + Math.round(deltaX / colWidth);
                            let newRows = startRows + Math.round(deltaY / rowHeight);
                            newCols = Math.max(1, Math.min(12, newCols));
                            newRows = Math.max(1, Math.min(6, newRows));
                            applyTileSize(tile, newCols, newRows);
                        }

                        function onMouseUp(ev) {
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                            tile.classList.remove('tile-resizing');
                            document.body.classList.remove('resize-dragging');

                            // Read final size and save
                            const finalSpan = getDefaultSpan(tile);
                            const allSizes = getTileSizes();
                            allSizes[tile.id] = { cols: finalSpan.cols, rows: finalSpan.rows };
                            saveTileSizes(allSizes);

                            // Settle animation
                            tile.classList.add('tile-resize-settle');
                            setTimeout(() => tile.classList.remove('tile-resize-settle'), 300);
                        }

                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                    });
                });
            }

            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FREE LAYOUT MODE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            const toggleFreeLayoutEl = document.getElementById('toggleFreeLayout');
            let freeDragTile = null, freeDragOffsetX = 0, freeDragOffsetY = 0;

            function loadFreeLayoutState() {
                const saved = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
                toggleFreeLayoutEl.checked = !!saved.freeLayout;
                const savedPos = JSON.parse(localStorage.getItem('dashboardFreePositions') || '{}');
                if (Object.keys(savedPos).length > 0) {
                    enableFreeLayout(false);
                    if (!saved.freeLayout) {
                        freeLayoutOn = false;
                        grid.classList.remove('free-editing');
                    }
                }
            }

            function saveFreePositions() {
                const positions = {};
                getAllTiles().forEach(tile => {
                    positions[tile.id] = {
                        top: tile.style.top,
                        left: tile.style.left,
                        width: tile.style.width,
                        height: tile.style.height
                    };
                });
                localStorage.setItem('dashboardFreePositions', JSON.stringify(positions));
            }

            function enableFreeLayout(animate) {
                const tiles = getAllTiles();
                // Capture current positions BEFORE switching to absolute
                const rects = new Map();
                tiles.forEach(t => {
                    const r = t.getBoundingClientRect();
                    // Only capture if tile is visible and has dimensions
                    if (r.width > 0 && r.height > 0) {
                        rects.set(t.id, r);
                    }
                });
                const gridRect = grid.getBoundingClientRect();

                // Load saved positions
                const savedPositions = JSON.parse(localStorage.getItem('dashboardFreePositions') || '{}');

                // Switch to free layout
                grid.classList.add('free-layout');
                // Set grid height to encompass all tiles
                let maxBottom = 900;
                let fallbackY = 20;

                tiles.forEach(tile => {
                    // Skip hidden tiles
                    if (tile.style.display === 'none') return;

                    const saved = savedPositions[tile.id];
                    const rect = rects.get(tile.id);
                    if (saved && saved.top) {
                        tile.style.top = saved.top;
                        tile.style.left = saved.left;
                        tile.style.width = saved.width;
                        tile.style.height = saved.height;
                    } else if (rect) {
                        tile.style.top = (rect.top - gridRect.top) + 'px';
                        tile.style.left = (rect.left - gridRect.left) + 'px';
                        tile.style.width = rect.width + 'px';
                        tile.style.height = rect.height + 'px';
                    } else {
                        // Fallback for tiles with no captured rect â€” stack them vertically
                        tile.style.top = fallbackY + 'px';
                        tile.style.left = '20px';
                        tile.style.width = '300px';
                        tile.style.height = '200px';
                        fallbackY += 220;
                    }
                    const bottom = parseFloat(tile.style.top) + parseFloat(tile.style.height);
                    if (bottom > maxBottom) maxBottom = bottom;
                });

                grid.style.minHeight = (maxBottom + 40) + 'px';
                grid.classList.add('free-editing');
                freeLayoutOn = true;
            }

            function disableFreeLayout() {
                freeLayoutOn = false;
                // Pozycje i free-layout zostajÄ… â€” tylko wyÅ‚Ä…czamy edycjÄ™ (drag + dot grid)
                grid.classList.remove('free-editing');
            }

            function resetToGrid() {
                // Hard reset â€” wrÃ³Ä‡ do CSS grid
                freeLayoutOn = false;
                grid.classList.remove('free-layout', 'free-editing');
                grid.style.minHeight = '';
                getAllTiles().forEach(tile => {
                    tile.style.top = '';
                    tile.style.left = '';
                    tile.style.width = '';
                    tile.style.height = '';
                });
                localStorage.removeItem('dashboardFreePositions');
            }

            toggleFreeLayoutEl.addEventListener('change', () => {
                const mode = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
                mode.freeLayout = toggleFreeLayoutEl.checked;
                localStorage.setItem('dashboardEditMode', JSON.stringify(mode));

                if (toggleFreeLayoutEl.checked) {
                    enableFreeLayout(true);
                } else {
                    disableFreeLayout();
                }
            });

            // Free layout drag
            document.addEventListener('mousedown', function(e) {
                if (!freeLayoutOn) return;
                const tile = e.target.closest('.bento-grid > .tile');
                if (!tile) return;
                if (['INPUT','TEXTAREA','BUTTON','SELECT','A'].includes(e.target.tagName)) return;
                // Don't interfere with resize handle
                if (e.target.closest('.tile-resize-handle')) return;

                e.preventDefault();
                freeDragTile = tile;
                freeDragOffsetX = e.clientX - tile.offsetLeft;
                freeDragOffsetY = e.clientY - tile.offsetTop;
                tile.classList.add('free-dragging');
                tile.style.transition = 'none';
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', function(e) {
                if (!freeDragTile) return;
                freeDragTile.style.left = (e.clientX - freeDragOffsetX) + 'px';
                freeDragTile.style.top = (e.clientY - freeDragOffsetY) + 'px';
            });

            document.addEventListener('mouseup', function() {
                if (!freeDragTile) return;
                freeDragTile.classList.remove('free-dragging');
                freeDragTile.style.transition = '';
                saveFreePositions();
                // Update grid min-height
                let maxBottom = 900;
                getAllTiles().forEach(t => {
                    const bottom = parseFloat(t.style.top || 0) + parseFloat(t.style.height || 0);
                    if (bottom > maxBottom) maxBottom = bottom;
                });
                grid.style.minHeight = (maxBottom + 40) + 'px';
                freeDragTile = null;
                document.body.style.userSelect = '';
            });

            // Free layout resize (override default resize in free mode)
            function initFreeResizeOverride() {
                getAllTiles().forEach(tile => {
                    const handle = tile.querySelector('.tile-resize-handle');
                    if (!handle || handle.dataset.freeResizeBound) return;
                    handle.dataset.freeResizeBound = '1';

                    handle.addEventListener('mousedown', function(e) {
                        if (!freeLayoutOn || !toggleResizeEl.checked) return;
                        e.preventDefault();
                        e.stopPropagation();

                        const startX = e.clientX;
                        const startY = e.clientY;
                        const startW = tile.offsetWidth;
                        const startH = tile.offsetHeight;

                        tile.classList.add('tile-resizing');
                        document.body.classList.add('resize-dragging');

                        function onMove(ev) {
                            tile.style.width = Math.max(80, startW + (ev.clientX - startX)) + 'px';
                            tile.style.height = Math.max(40, startH + (ev.clientY - startY)) + 'px';
                        }
                        function onUp() {
                            document.removeEventListener('mousemove', onMove);
                            document.removeEventListener('mouseup', onUp);
                            tile.classList.remove('tile-resizing');
                            document.body.classList.remove('resize-dragging');
                            saveFreePositions();
                        }
                        document.addEventListener('mousemove', onMove);
                        document.addEventListener('mouseup', onUp);
                    }, true); // capture phase to override grid resize
                });
            }

            // Initialize
            restoreTileOrder();
            initTileUI();
            initResizeControls();
            // One-time reset v2: clear broken free layout positions
            if (!localStorage.getItem('dashboardResetV2')) {
                localStorage.removeItem('dashboardFreePositions');
                const mode = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
                mode.freeLayout = false;
                localStorage.setItem('dashboardEditMode', JSON.stringify(mode));
                localStorage.setItem('dashboardResetV2', '1');
            }
            restoreTileColors();
            applyToggleStates();
            loadFreeLayoutState();
            initFreeResizeOverride();
        })();
    </script>
</body>
</html>
