<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
    (function() {
        const HASH = 'bba1dc9846ddd9a44c3d3b736faa5bdb6673b8d0fe1b0dd445c9f9adfda2ff72'; // sha256 of PIN
        const KEY = 'ediDashAuth';
        if (localStorage.getItem(KEY) === HASH) return;
        async function sha256(text) {
            const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(text));
            return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
        }
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;inset:0;z-index:99999;background:#0D0D12;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px;font-family:system-ui;';
        overlay.innerHTML = '<div style="font-size:24px">üéØ</div><div style="color:#a78bfa;font-size:14px;font-weight:700">1ts</div><input id="pinInput" type="password" inputmode="numeric" placeholder="PIN" maxlength="20" style="padding:12px 20px;background:#1a1a2e;border:1px solid #2a2a3e;border-radius:8px;color:white;font-size:18px;text-align:center;width:200px;outline:none;" autofocus><button id="pinBtn" style="margin-top:8px;padding:10px 40px;background:#7C3AED;border:none;border-radius:8px;color:white;font-size:14px;font-weight:700;cursor:pointer;">Enter</button><div id="pinError" style="color:#ef4444;font-size:12px;height:16px;"></div>';
        document.documentElement.appendChild(overlay);
        setTimeout(() => {
            const input = document.getElementById('pinInput');
            input.focus();
            async function tryPin() {
                const hash = await sha256(input.value);
                if (hash === HASH) {
                    localStorage.setItem(KEY, HASH);
                    overlay.remove();
                } else {
                    document.getElementById('pinError').textContent = 'B≈Çƒôdny PIN';
                    input.value = '';
                }
            }
            input.addEventListener('keypress', function(e) { if (e.key === 'Enter') tryPin(); });
            document.getElementById('pinBtn').addEventListener('click', tryPin);
        }, 100);
    })();
    </script>
    <title>COMMAND CENTER</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-body: #0F0E1A;
            --bg-card: #1A1925;
            --bg-card-hover: #222131;
            --bg-input: #14131F;
            --border: rgba(124,58,237,0.12);
            --border-hover: rgba(124,58,237,0.4);
            --text-primary: #ffffff;
            --text-secondary: #8B8A9E;
            --text-muted: #5C5B6F;
            --purple-500: #7C3AED;
            --purple-400: #8B5CF6;
            --purple-300: #A78BFA;
            --purple-glow: rgba(124,58,237,0.25);
            --green: #10b981;
            --yellow: #f59e0b;
            --red: #ef4444;
            --blue: #3b82f6;
            --gray: #6b7280;
            --pink: #EC4899;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0c;
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.4;
            font-size: 11px;
            -webkit-font-smoothing: antialiased;
        }

        /* Liquid Glass */
        .glass {
            position: relative;
            background: linear-gradient(145deg, rgba(255,255,255,0.10) 0%, rgba(255,255,255,0.04) 50%, rgba(255,255,255,0.07) 100%);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4), inset 0 1px 1px rgba(255,255,255,0.08);
            overflow: hidden;
        }
        .glass::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(from 180deg at 50% 50%, transparent 0deg, rgba(255,100,200,0.04) 60deg, rgba(100,200,255,0.06) 120deg, rgba(200,255,100,0.03) 180deg, rgba(255,200,100,0.03) 240deg, rgba(200,100,255,0.06) 300deg, transparent 360deg);
            pointer-events: none;
        }
        .glass::after {
            content: '';
            position: absolute;
            top: 0; left: 10%; right: 10%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3) 30%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.3) 70%, transparent);
            pointer-events: none;
        }
        @keyframes shimmer { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        ::-webkit-scrollbar { width: 3px; height: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BENTO GRID ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .bento-grid {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 16px;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 6px;
            padding: 8px;
            min-height: 100vh;
            overflow: hidden;
        }

        .tile {
            position: relative;
            background: linear-gradient(145deg, rgba(255,255,255,0.10) 0%, rgba(255,255,255,0.04) 50%, rgba(255,255,255,0.07) 100%);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 14px;
            padding: 14px 16px;
            overflow: hidden;
            box-shadow: 0 4px 24px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.06);
            transition: all 0.3s;
        }
        .tile::before {
            content: none; /* disabled - was causing visible gradient squares */
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(from 180deg at 50% 50%, transparent 0deg, rgba(255,100,200,0.03) 60deg, rgba(100,200,255,0.05) 120deg, rgba(200,255,100,0.02) 180deg, rgba(255,200,100,0.02) 240deg, rgba(200,100,255,0.05) 300deg, transparent 360deg);
            pointer-events: none;
        }
        .tile::after {
            content: '';
            position: absolute;
            top: 0; left: 10%; right: 10%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25) 30%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.25) 70%, transparent);
            pointer-events: none;
        }
        .tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4), inset 0 1px 1px rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.18);
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROW 1: HEADER TILES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile > * { position: relative; z-index: 1; }
        .tile-logo { grid-column: span 4; display: flex; align-items: center; gap: 8px; justify-content: center; }
        .tile-statsbar { grid-column: span 8; display: flex; align-items: center; justify-content: space-around; gap: 0; padding: 8px 16px; }
        .statsbar-item { display: flex; align-items: center; gap: 6px; }
        .statsbar-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .statsbar-dot.red { background: var(--red); box-shadow: 0 0 6px rgba(239,68,68,0.5); }
        .statsbar-dot.purple { background: var(--purple-500); box-shadow: 0 0 6px rgba(124,58,237,0.5); }
        .statsbar-dot.yellow { background: var(--yellow); box-shadow: 0 0 6px rgba(245,158,11,0.5); }
        .statsbar-dot.green { background: var(--green); box-shadow: 0 0 6px rgba(16,185,129,0.5); }
        .statsbar-num { font-size: 1.3rem; font-weight: 800; color: #fff; }
        .statsbar-label { font-size: 0.75rem; color: var(--text-secondary); }
        .statsbar-sep { width: 1px; height: 20px; background: rgba(255,255,255,0.1); margin: 0 8px; }
        .logo-text { font-size: 12px; font-weight: 800; letter-spacing: 0.04em; background: linear-gradient(135deg, var(--purple-300), var(--purple-500)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .online-badge { font-size: 8px; padding: 2px 6px; border-radius: 8px; background: rgba(16,185,129,0.15); color: var(--green); font-weight: 600; display: flex; align-items: center; gap: 3px; }
        .online-dot { width: 5px; height: 5px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; box-shadow: 0 0 6px rgba(16,185,129,0.6); }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

        .tile-stat { grid-column: span 2; display: flex; flex-direction: column; justify-content: center; gap: 2px; position: relative; overflow: hidden; }
        .tile-stat-wide { grid-column: span 3; }
        .stat-accent { position: absolute; top: 0; left: 0; right: 0; height: 2px; }
        .stat-accent.red { background: var(--red); }
        .stat-accent.purple { background: var(--purple-500); }
        .stat-accent.yellow { background: var(--yellow); }
        .stat-accent.green { background: var(--green); }
        .stat-top { display: flex; align-items: center; gap: 6px; }
        .stat-icon { font-size: 12px; }
        .stat-number { font-size: 1.8rem; font-weight: 800; line-height: 1; color: #fff; }
        .stat-label { font-size: 9px; color: var(--text-secondary); font-weight: 500; margin-top: 1px; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KANBAN TILES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-kanban { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; }
        .tile-kanban-sm { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; }
        .kanban-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; padding-bottom: 5px; border-bottom: 2px solid var(--border); }
        .kanban-header.urgent { border-bottom-color: var(--red); }
        .kanban-header.todo { border-bottom-color: var(--purple-500); }
        .kanban-header.waiting { border-bottom-color: var(--yellow); }
        .kanban-header.done { border-bottom-color: var(--green); }
        .kanban-header.onhold { border-bottom-color: #6b7280; }
        .kanban-count.onhold { background: rgba(107,114,128,0.15); color: #9ca3af; }
        .kanban-title { font-weight: 700; font-size: 9px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-primary); display: flex; align-items: center; gap: 5px; }
        .kanban-subtitle { font-size: 8px; color: var(--purple-400); font-weight: 400; }
        .kanban-count { font-size: 9px; font-weight: 700; padding: 1px 5px; border-radius: 6px; }
        .kanban-count.urgent { background: rgba(239,68,68,0.15); color: var(--red); }
        .kanban-count.todo { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .kanban-count.waiting { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .kanban-count.done { background: rgba(16,185,129,0.15); color: var(--green); }

        .add-task-btn {
            background: rgba(124,58,237,0.12); border: none; color: var(--purple-400);
            width: 18px; height: 18px; border-radius: 4px; cursor: pointer;
            font-size: 11px; display: flex; align-items: center; justify-content: center;
        }
        .add-task-btn:hover { background: var(--purple-500); color: white; }

        .task-list { display: flex; flex-direction: column; gap: 3px; flex: 1; overflow-y: auto; }

        .task-card {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            border-radius: 6px; padding: 6px 8px; cursor: pointer; transition: all 0.15s;
            display: flex; align-items: center; gap: 6px;
        }
        .task-card:hover { border-color: var(--border-hover); background: rgba(124,58,237,0.05); }
        .task-card[draggable="true"] { cursor: grab; }
        .task-card[draggable="true"]:active { cursor: grabbing; }

        .task-num { font-size: 9px; font-weight: 700; color: var(--text-muted); min-width: 16px; }
        .task-card-content { flex: 1; min-width: 0; }
        .task-status-circle { width: 10px; height: 10px; border-radius: 50%; border: 2px solid; flex-shrink: 0; }
        .task-status-circle.urgent { border-color: var(--red); }
        .task-status-circle.todo { border-color: var(--purple-500); }
        .task-status-circle.waiting { border-color: var(--yellow); }
        .task-status-circle.done { border-color: var(--green); background: var(--green); }
        .task-status-circle.onhold { border-color: #6b7280; }

        .task-row { display: flex; justify-content: space-between; align-items: center; gap: 4px; }
        .task-title { font-weight: 500; font-size: 10px; line-height: 1.3; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .task-project { font-size: 7px; padding: 1px 5px; border-radius: 4px; font-weight: 600; white-space: nowrap; flex-shrink: 0; }
        .task-project.onethree { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .task-project.system { background: rgba(107,114,128,0.15); color: var(--gray); }
        .task-project.dom { background: rgba(16,185,129,0.15); color: var(--green); }
        .task-project.osobiste { background: rgba(239,68,68,0.15); color: var(--red); }
        .task-project.pomysl { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .task-project.research { background: rgba(59,130,246,0.15); color: #3B82F6; }
        .task-time { font-size: 7px; color: var(--text-muted); white-space: nowrap; }

        .task-attachments { margin-top: 3px; padding-top: 3px; border-top: 1px solid var(--border); }
        .task-attachment-link { display: inline-flex; align-items: center; gap: 2px; font-size: 8px; color: var(--purple-300); text-decoration: none; margin-right: 4px; }
        .task-attachment-link:hover { text-decoration: underline; }

        .kanban-drop-zone { min-height: 40px; }
        .kanban-drop-zone.drag-over { background: rgba(124,58,237,0.08); border-radius: 6px; }

        .empty-state { text-align: center; padding: 10px 6px; color: var(--text-muted); font-size: 9px; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CALENDAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-calendar { grid-column: span 3; grid-row: span 2; }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .cal-title { font-size: 11px; font-weight: 700; color: var(--text-primary); }
        .cal-nav { display: flex; gap: 4px; }
        .cal-nav button { background: rgba(124,58,237,0.12); border: none; color: var(--purple-400); width: 20px; height: 20px; border-radius: 4px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; }
        .cal-nav button:hover { background: var(--purple-500); color: white; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center; }
        .cal-day-name { font-size: 8px; font-weight: 600; color: var(--text-muted); padding: 4px 0; text-transform: uppercase; }
        .cal-day { font-size: 9px; padding: 4px 2px; border-radius: 4px; color: var(--text-secondary); cursor: pointer; transition: all 0.15s; }
        .cal-day:hover { background: rgba(124,58,237,0.1); }
        .cal-day.today { background: var(--purple-500); color: white; font-weight: 700; border-radius: 50%; }
        .cal-day.other-month { color: var(--text-muted); opacity: 0.3; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRESS RING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-progress { grid-column: span 3; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; }
        .progress-ring-wrap { position: relative; width: 100px; height: 100px; }
        .progress-ring-wrap svg { transform: rotate(-90deg); }
        .progress-ring-bg { fill: none; stroke: rgba(124,58,237,0.1); stroke-width: 6; }
        .progress-ring-fg { fill: none; stroke: url(#progressGradient); stroke-width: 6; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
        .progress-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 22px; font-weight: 800; color: var(--text-primary); }
        .progress-ring-label { font-size: 9px; color: var(--purple-400); font-weight: 500; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUICK NOTES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-notes { grid-column: span 4; display: flex; flex-direction: column; }
        .notes-title { font-size: 10px; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; display: flex; align-items: center; gap: 5px; }
        .notes-textarea { flex: 1; width: 100%; padding: 8px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 10px; resize: none; font-family: inherit; line-height: 1.5; }
        .notes-textarea:focus { outline: none; border-color: var(--purple-500); }
        .notes-saved { font-size: 8px; color: var(--green); margin-top: 4px; opacity: 0; transition: opacity 0.3s; }
        .notes-saved.show { opacity: 1; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROJECT TILES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-project { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; }
        .project-tile-title { font-size: 11px; font-weight: 700; margin-bottom: 3px; display: flex; align-items: center; gap: 5px; color: var(--text-primary); }
        .project-tile-subtitle { font-size: 8px; color: var(--purple-400); margin-bottom: 8px; }

        .project-item { display: flex; align-items: center; gap: 6px; padding: 4px 0; cursor: pointer; }
        .project-item:hover .project-name { color: var(--purple-300); }
        .project-status { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
        .project-status.active { background: var(--green); box-shadow: 0 0 4px rgba(16,185,129,0.5); }
        .project-status.done { background: var(--purple-300); box-shadow: 0 0 4px rgba(124,58,237,0.5); }
        .project-status.hold { background: var(--yellow); }
        .project-status.idea { background: var(--gray); }
        .project-status.warning { background: var(--yellow); }
        .project-status.urgent { background: var(--red); }
        .project-status.inactive { background: var(--gray); }
        .project-name { font-size: 10px; font-weight: 600; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .project-progress-wrap { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }
        .progress-bar { width: 50px; height: 3px; background: rgba(255,255,255,0.06); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--purple-500), var(--purple-300)); border-radius: 2px; transition: width 0.5s; }
        .progress-pct { font-size: 8px; color: var(--text-muted); width: 24px; text-align: right; }

        /* Project expand */
        .project-card { cursor: pointer; padding: 4px 0; border-bottom: 1px solid var(--border); position: relative; }
        .project-card:last-child { border-bottom: none; }
        .expand-icon { font-size: 7px; color: var(--text-muted); transition: transform 0.2s; margin-left: 4px; }
        .project-card.expanded .expand-icon { transform: rotate(180deg); }
        .project-details { display: none; padding: 6px 0 4px 12px; }
        .project-card.expanded .project-details {
            display: block;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 99999;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        .project-close-btn {
            display: none;
            text-align: right;
            color: var(--purple-300);
            font-size: 12px;
            font-weight: 700;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 10px;
            cursor: pointer;
            background: none;
            border: none;
            width: 100%;
        }
        .project-card.expanded .project-close-btn { display: block; }
        .project-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 99998; }
        .project-overlay.active { display: block; }
        @media (max-width: 600px) {
            .project-card.expanded .project-details {
                width: 95%;
                max-height: 85vh;
            }
        }
        .project-tasks-title { font-size: 10px; color: var(--purple-400); margin-bottom: 8px; margin-top: 12px; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }
        .project-task-item { display: flex; align-items: center; gap: 4px; padding: 2px 0; font-size: 10px; }
        .project-task-item input[type="checkbox"] { width: 12px; height: 12px; accent-color: var(--purple-500); }
        .project-task-item.done { text-decoration: line-through; color: var(--text-muted); }
        .project-notes { margin-top: 4px; }
        .project-notes-label { font-size: 10px; color: var(--purple-400); margin-bottom: 6px; margin-top: 14px; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }
        .project-notes textarea { width: 100%; min-height: 80px; padding: 8px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 11px; resize: vertical; font-family: inherit; line-height: 1.6; }
        .project-notes textarea:focus { outline: none; border-color: var(--purple-500); }
        .add-project-task { display: flex; gap: 4px; margin-top: 4px; }
        .add-project-task input { flex: 1; padding: 3px 6px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 10px; font-family: inherit; }
        .add-project-task input:focus { outline: none; border-color: var(--purple-500); }
        .add-project-task button { padding: 3px 8px; background: var(--purple-500); border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 10px; font-weight: 600; }
        .drive-link-btn { display: block; margin: 4px 0; padding: 4px 8px; background: linear-gradient(135deg, #4285f4, #34a853); color: white; text-decoration: none; border-radius: 6px; font-weight: 600; text-align: center; font-size: 9px; }
        .drive-link-btn:hover { opacity: 0.9; }
        .project-docs { margin-top: 4px; padding-top: 4px; border-top: 1px solid var(--border); }
        .project-docs-label { font-size: 10px; color: var(--purple-400); margin-bottom: 6px; margin-top: 14px; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }
        .project-doc-link { display: flex; align-items: center; gap: 4px; padding: 2px 6px; background: rgba(255,255,255,0.03); border-radius: 4px; color: var(--purple-300); text-decoration: none; font-size: 9px; margin-bottom: 2px; }
        .project-doc-link:hover { background: rgba(124,58,237,0.1); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APPS + DOCS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-apps { grid-column: span 3; grid-row: span 2; display: flex; flex-direction: column; }
        .tile-docs { grid-column: span 5; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TILE HIDE/STASH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-close-btn {
            position: absolute; top: 6px; right: 24px; z-index: 10;
            width: 16px; height: 16px; border-radius: 50%;
            background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.25); font-size: 9px; cursor: pointer;
            display: none; align-items: center; justify-content: center; line-height: 1;
        }
        .stash-mode .tile:hover .tile-close-btn { display: flex; }
        .tile-close-btn:hover { background: rgba(239,68,68,0.2); color: var(--red); border-color: rgba(239,68,68,0.3); }
        .tile.hidden-tile { display: none !important; }
        .tile-stash { grid-column: span 6; display: flex; flex-direction: column; }
        .stash-chips { display: flex; gap: 6px; flex-wrap: wrap; padding: 4px 0; }
        .stash-chip {
            font-size: 9px; padding: 3px 8px; border-radius: 6px; cursor: pointer;
            background: rgba(124,58,237,0.15); color: var(--purple-300); border: 1px solid rgba(124,58,237,0.2);
            transition: all 0.2s;
        }
        .stash-chip:hover { background: rgba(124,58,237,0.3); color: #fff; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EDI LOG TILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-edilog { grid-column: span 6; grid-row: span 3; display: flex; flex-direction: column; max-height: 400px; }
        .edilog-scroll { flex: 1; overflow-y: auto; padding-right: 4px; }
        .edilog-scroll::-webkit-scrollbar { width: 4px; }
        .edilog-scroll::-webkit-scrollbar-thumb { background: rgba(124,58,237,0.3); border-radius: 2px; }
        .edilog-day { margin-bottom: 8px; }
        .edilog-day-header { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--purple-300); padding: 4px 0; border-bottom: 1px solid rgba(124,58,237,0.2); margin-bottom: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .edilog-day-header:hover { color: var(--purple-400); }
        .edilog-day-header .arrow { font-size: 8px; transition: transform 0.2s; }
        .edilog-day-header .arrow.collapsed { transform: rotate(-90deg); }
        .edilog-day-summary { font-size: 8px; color: var(--text-secondary); font-weight: 400; margin-left: 8px; }
        .edilog-entry { display: flex; gap: 8px; padding: 3px 0; align-items: flex-start; font-size: 10px; }
        .edilog-time { color: var(--text-secondary); font-size: 9px; min-width: 36px; font-family: monospace; }
        .edilog-icon { font-size: 10px; min-width: 14px; }
        .edilog-text { color: var(--text-primary); flex: 1; }
        .edilog-text .detail { color: var(--text-secondary); font-size: 9px; }
        .edilog-tag { font-size: 7px; padding: 1px 4px; border-radius: 3px; font-weight: 600; background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .edilog-entries.collapsed { display: none; }

        .apps-inline { display: flex; flex-wrap: wrap; gap: 4px; }
        .app-pill { display: flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; font-size: 9px; cursor: pointer; transition: all 0.15s; }
        .app-pill:hover { border-color: var(--border-hover); }
        .app-pill.high { border-left: 2px solid var(--red); }
        .app-pill.medium { border-left: 2px solid var(--yellow); }
        .app-pill.low { border-left: 2px solid var(--green); }
        .app-stage { font-size: 7px; padding: 1px 4px; border-radius: 3px; font-weight: 600; }
        .app-stage.idea { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .app-stage.planned { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .app-stage.progress { background: rgba(59,130,246,0.15); color: var(--blue); }
        .app-stage.done { background: rgba(16,185,129,0.15); color: var(--green); }

        .add-app-inline { padding: 4px 8px; background: rgba(124,58,237,0.06); border: 1px dashed rgba(124,58,237,0.2); border-radius: 6px; color: var(--purple-400); font-size: 9px; cursor: pointer; }
        .add-app-inline:hover { border-color: var(--purple-500); }

        .docs-pills { display: flex; flex-wrap: wrap; gap: 4px; }
        .doc-pill { display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 6px; color: var(--purple-300); text-decoration: none; font-size: 9px; transition: all 0.15s; }
        .doc-pill:hover { border-color: var(--border-hover); }
        .doc-type { font-size: 7px; padding: 1px 4px; border-radius: 3px; font-weight: 600; }
        .doc-type.research { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .doc-type.raport { background: rgba(124,58,237,0.15); color: var(--purple-300); }
        .doc-type.plan { background: rgba(16,185,129,0.15); color: var(--green); }

        .tile-section-title { font-size: 10px; font-weight: 700; margin-bottom: 2px; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.04em; }
        .tile-section-subtitle { font-size: 8px; color: var(--purple-400); margin-bottom: 6px; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10,8,20,0.8); backdrop-filter: blur(8px); z-index: 1000; justify-content: center; align-items: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: rgba(26,26,36,0.95); backdrop-filter: blur(24px); border: 1px solid rgba(124,58,237,0.15); border-radius: 10px; padding: 16px; width: 90%; max-width: 420px; box-shadow: 0 32px 80px rgba(0,0,0,0.6); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .modal-title { font-size: 13px; font-weight: 700; }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 16px; cursor: pointer; }
        .modal-close:hover { color: var(--red); }
        .form-group { margin-bottom: 8px; }
        .form-group label { display: block; margin-bottom: 3px; font-size: 10px; color: var(--text-secondary); font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 6px 8px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 10px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--purple-500); }
        .form-group textarea { resize: vertical; min-height: 50px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .modal-actions { display: flex; gap: 8px; margin-top: 12px; }
        .btn { flex: 1; padding: 7px 10px; border: none; border-radius: 6px; font-size: 10px; font-weight: 600; cursor: pointer; font-family: inherit; }
        .btn-primary { background: linear-gradient(135deg, var(--purple-500), var(--purple-400)); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-secondary { background: var(--bg-input); color: var(--text-primary); border: 1px solid var(--border); }
        .btn-danger { background: var(--red); color: white; }
        .btn-small { padding: 4px 8px; font-size: 10px; }
        .attachment-input { display: flex; gap: 4px; margin-top: 4px; }
        .attachment-input input { flex: 1; padding: 4px 6px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-input); color: var(--text-primary); font-size: 10px; font-family: inherit; }
        .attachment-input input:focus { outline: none; border-color: var(--purple-500); }
        .attachment-item { display: flex; align-items: center; gap: 4px; padding: 4px 6px; background: rgba(255,255,255,0.03); border-radius: 6px; margin-bottom: 3px; }
        .attachment-item a { color: var(--purple-300); text-decoration: none; flex: 1; font-size: 10px; }
        .attachment-item a:hover { text-decoration: underline; }
        .attachment-remove { color: var(--red); cursor: pointer; padding: 1px 4px; font-size: 10px; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESPONSIVE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        @media (max-width: 900px) {
            .bento-grid { grid-template-columns: repeat(6, 1fr); }
            .bento-grid.free-layout { display: grid !important; }
            .bento-grid.free-layout > .tile { position: relative !important; top: auto !important; left: auto !important; width: auto !important; height: auto !important; }
            .tile-logo { grid-column: span 6; }
            .tile-stat { grid-column: span 3; }
            .tile-stat-wide { grid-column: span 3; }
            .tile-kanban, .tile-kanban-sm { grid-column: span 3; grid-row: span 2; }
            .tile-calendar { grid-column: span 6; }
            .tile-progress { grid-column: span 3; }
            .tile-notes { grid-column: span 3; }
            .tile-project { grid-column: span 6; grid-row: span 1; }
            .tile-apps, .tile-docs { grid-column: span 6; }
            .tile-clock, .tile-weather, .tile-tokens { grid-column: span 2; }
            .tile-edilog { grid-column: span 6; }
        }
        @media (max-width: 600px) {
            .bento-grid { 
                grid-template-columns: 1fr !important; 
                gap: 6px; 
                padding: 6px; 
                display: grid !important;
                position: relative !important;
            }
            .bento-grid > .tile {
                grid-column: span 1 !important;
                grid-row: span 1 !important;
                position: relative !important;
                top: auto !important;
                left: auto !important;
                width: auto !important;
                height: auto !important;
                min-height: auto;
            }
            .tile-logo { order: -10; }
            .tile-stat, .tile-stat-wide { min-height: 50px; }
            .tile-kanban, .tile-kanban-sm { min-height: 80px; }
            .tile-calendar { min-height: 200px; }
            .tile-progress { min-height: 120px; }
            .tile-notes { min-height: 80px; }
            .tile-project { min-height: 60px; }
            .tile-apps, .tile-docs { min-height: 60px; }
            .tile-settings { min-height: 60px; }
            .tile-edilog { min-height: 100px; }
            .tile-clock, .tile-weather, .tile-tokens { min-height: 80px; }
            .clock-time { font-size: 2rem; }
            .weather-temp { font-size: 1.8rem; }
            .tile { padding: 10px 12px !important; }
            .bento-grid.free-layout { display: grid !important; }
            .bento-grid.free-layout > .tile { position: relative !important; }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NEW PANELS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-clock { grid-column: span 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0; padding: 6px; }
        .clock-time { font-size: 1.4rem; font-weight: 800; letter-spacing: 0.05em; background: linear-gradient(135deg, var(--purple-300), var(--pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1; }
        .clock-date { font-size: 7px; color: var(--text-secondary); margin-top: 2px; }

        .tile-weather { grid-column: span 2; display: flex; flex-direction: column; gap: 4px; }
        .weather-temp { font-size: 1.8rem; font-weight: 800; line-height: 1; }
        .weather-desc { font-size: 9px; color: var(--text-secondary); }
        .weather-details { display: flex; gap: 8px; font-size: 8px; color: var(--text-muted); margin-top: 4px; }

        .tile-tokens { grid-column: span 2; display: flex; flex-direction: column; gap: 4px; }
        .token-row { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; border-bottom: 1px solid var(--border); }
        .token-row:last-child { border-bottom: none; }
        .token-label { font-size: 10px; color: var(--text-secondary); }
        .token-value { font-size: 12px; font-weight: 700; color: var(--purple-300); }
        .token-total { font-size: 1.5rem; font-weight: 800; color: var(--text-primary); }

        /* Editable kanban title */
        .kanban-title-text { cursor: pointer; border-bottom: 1px dashed transparent; transition: border-color 0.2s; }
        .kanban-title-text:hover { border-bottom-color: var(--purple-400); color: var(--purple-300); }
        .kanban-title-input { background: transparent; border: 1px solid var(--purple-500); border-radius: 4px; color: var(--text-primary); font-weight: 700; font-size: 9px; text-transform: uppercase; letter-spacing: 0.05em; padding: 1px 4px; width: 100px; outline: none; }

        /* Profile controls */
        .profile-section { margin-top: 6px; padding-top: 6px; border-top: 1px solid var(--border); }
        .profile-controls { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 4px; }
        .profile-chip { font-size: 8px; padding: 2px 6px; border-radius: 4px; cursor: pointer; background: rgba(124,58,237,0.12); color: var(--purple-300); border: 1px solid rgba(124,58,237,0.2); transition: all 0.2s; }
        .profile-chip:hover { background: rgba(124,58,237,0.3); }
        .profile-chip .del { margin-left: 3px; opacity: 0.5; }
        .profile-chip .del:hover { opacity: 1; color: var(--red); }

        /* Task time display */
        .task-time-badge { font-size: 7px; color: var(--purple-400); background: rgba(124,58,237,0.1); padding: 1px 4px; border-radius: 3px; margin-left: 4px; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BETTER RESPONSIVE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        @media (max-width: 1100px) {
            .bento-grid.free-layout { display: grid !important; }
            .bento-grid.free-layout > .tile { position: relative !important; top: auto !important; left: auto !important; width: auto !important; height: auto !important; }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ANIMATIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        @keyframes ringAnim {
            from { stroke-dashoffset: 282.7; }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TILE DRAG & DROP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-grip {
            position: absolute; top: 6px; left: 6px; z-index: 10;
            font-size: 12px; color: rgba(255,255,255,0.2); cursor: grab;
            opacity: 0; transition: opacity 0.2s; user-select: none;
            line-height: 1; padding: 2px;
        }
        .tile:hover .tile-grip { opacity: 1; }
        .tile-grip:active { cursor: grabbing; }
        /* tile-drag-over and tile-dragging handled by enhanced CSS below */

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TILE COLOR PICKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-color-btn {
            position: absolute; bottom: 6px; right: 6px; z-index: 10;
            font-size: 11px; cursor: pointer; opacity: 0; transition: opacity 0.2s;
            background: none; border: none; padding: 2px; line-height: 1;
        }
        .tile:hover .tile-color-btn { opacity: 1; }
        .tile-color-picker {
            position: absolute; bottom: 24px; right: 6px; z-index: 100;
            background: rgba(20,19,31,0.95); border: 1px solid rgba(124,58,237,0.3);
            border-radius: 8px; padding: 6px; display: grid; grid-template-columns: repeat(4,1fr);
            gap: 4px; box-shadow: 0 8px 24px rgba(0,0,0,0.6);
        }
        .tile-color-swatch {
            width: 22px; height: 22px; border-radius: 50%; cursor: pointer;
            border: 2px solid transparent; transition: all 0.15s;
        }
        .tile-color-swatch:hover { border-color: var(--purple-400); transform: scale(1.15); }
        .tile-color-swatch.active { border-color: white; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS TILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-settings { grid-column: span 2; display: flex; flex-direction: column; justify-content: center; gap: 6px; padding: 8px 10px; }
        .tile-profiles { grid-column: span 2; display: flex; flex-direction: column; gap: 6px; padding: 8px 10px; }
        .tile-settings .settings-title { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-secondary); margin-bottom: 2px; }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; cursor: pointer; padding: 2px 0; }
        .toggle-label { font-size: 10px; font-weight: 500; color: var(--text-primary); }
        .toggle-switch { position: relative; display: inline-block; width: 36px; height: 20px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #4a4a5a; border-radius: 10px; transition: background 0.3s; cursor: pointer; }
        .toggle-slider::before { content: ''; position: absolute; width: 16px; height: 16px; left: 2px; top: 2px; background: white; border-radius: 50%; transition: transform 0.3s; }
        .toggle-switch input:checked + .toggle-slider { background: var(--purple-500); }
        .toggle-switch input:checked + .toggle-slider::before { transform: translateX(16px); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DRAG & DROP ENHANCED ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile { transition: all 0.3s ease; }
        .tile.tile-dragging { opacity: 0.5 !important; }
        .tile.tile-drag-over { animation: dragPulse 0.8s ease infinite; }
        @keyframes dragPulse {
            0%, 100% { border-color: var(--purple-500); box-shadow: 0 0 8px rgba(124,58,237,0.3); }
            50% { border-color: var(--purple-300); box-shadow: 0 0 16px rgba(124,58,237,0.5); }
        }
        .tile.tile-drop-anim { animation: dropBounce 0.3s ease; }
        @keyframes dropBounce {
            0% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* Hide grip/color by default (controlled by toggles) */
        .tile-grip.hidden, .tile-color-btn.hidden { display: none !important; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TILE RESIZE HANDLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .tile-resize-handle {
            position: absolute;
            bottom: 0; right: 0;
            width: 20px; height: 20px;
            cursor: nwse-resize;
            z-index: 3;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px;
            color: var(--text-muted);
            opacity: 0;
            transition: opacity 0.2s;
            background: linear-gradient(135deg, transparent 50%, rgba(124,58,237,0.3) 50%);
            border-radius: 0 0 14px 0;
        }
        .tile:hover .tile-resize-handle { opacity: 1; }
        .tile-resize-handle.hidden { display: none !important; }
        .tile.tile-resizing { transition: none !important; z-index: 50; }
        .tile.tile-resize-settle { transition: all 0.3s ease !important; }
        body.resize-dragging { user-select: none !important; cursor: nwse-resize !important; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FREE LAYOUT MODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .bento-grid.free-layout {
            display: block !important;
            position: relative;
            min-height: 900px;
        }
        .bento-grid.free-layout.free-editing {
            background-image: radial-gradient(circle, rgba(255,255,255,0.06) 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .bento-grid.free-layout > .tile {
            position: absolute;
        }
        .bento-grid.free-layout.free-editing > .tile {
            cursor: move;
        }
        .bento-grid.free-layout > .tile:hover {
            transform: none;
        }
        .bento-grid.free-layout > .tile.free-dragging {
            z-index: 1000 !important;
            box-shadow: 0 16px 48px rgba(0,0,0,0.6), inset 0 1px 1px rgba(255,255,255,0.08);
            transition: none !important;
        }
    </style>
</head>
<body>
    <!-- SVG Defs for gradient -->
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#7C3AED"/>
                <stop offset="100%" stop-color="#EC4899"/>
            </linearGradient>
        </defs>
    </svg>

    <div class="bento-grid">
        <!-- ROW 1: Stats + Logo -->
        <div class="tile tile-statsbar" id="tile-statsbar">
            <div class="statsbar-item"><span class="statsbar-dot red"></span><span class="statsbar-num" id="statUrgent">0</span><span class="statsbar-label">Pilne</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot purple"></span><span class="statsbar-num" id="statTodo">0</span><span class="statsbar-label">Do zrobienia</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot yellow"></span><span class="statsbar-num" id="statWaiting">0</span><span class="statsbar-label">Czekam</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot green"></span><span class="statsbar-num" id="statDone">0</span><span class="statsbar-label">Zrobione</span></div>
            <div class="statsbar-sep"></div>
            <div class="statsbar-item"><span class="statsbar-dot" style="background:#6b7280;"></span><span class="statsbar-num" id="statOnhold">0</span><span class="statsbar-label">On Hold</span></div>
        </div>
        <div class="tile tile-logo" id="tile-logo">
            <span style="font-size:16px">üéØ</span>
            <span class="logo-text">COMMAND CENTER</span>
            <span class="online-badge"><span class="online-dot"></span> Online</span>
            <span id="syncStatus" style="font-size:10px;margin-left:6px;opacity:0.6;cursor:pointer;" onclick="loadFromCloud().then(()=>location.reload())" title="Kliknij by pobraƒá z chmury">‚òÅÔ∏è</span>
        </div>

        <!-- ROW 2-3: 4 Kanban columns -->
        <div class="tile tile-kanban" id="tile-kanban-urgent" data-column="urgent" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'urgent')">
            <div class="kanban-header urgent">
                <div><span class="kanban-title">üî¥ PILNE <span class="kanban-count urgent" id="countUrgent">0</span></span><div class="kanban-subtitle">WymagajƒÖ uwagi</div></div>
                <button class="add-task-btn" onclick="openModal('urgent')">+</button>
            </div>
            <div class="task-list" id="urgentTasks"></div>
        </div>
        <div class="tile tile-kanban" id="tile-kanban-todo" data-column="todo" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'todo')">
            <div class="kanban-header todo">
                <div><span class="kanban-title">üìã TODO <span class="kanban-count todo" id="countTodo">0</span></span><div class="kanban-subtitle">Zadania do wykonania</div></div>
                <button class="add-task-btn" onclick="openModal('todo')">+</button>
            </div>
            <div class="task-list" id="todoTasks"></div>
        </div>
        <div class="tile tile-kanban" id="tile-kanban-waiting" data-column="waiting" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'waiting')">
            <div class="kanban-header waiting">
                <div><span class="kanban-title">‚è≥ CZEKAM <span class="kanban-count waiting" id="countWaiting">0</span></span><div class="kanban-subtitle">OczekujƒÖce</div></div>
                <button class="add-task-btn" onclick="openModal('waiting')">+</button>
            </div>
            <div class="task-list" id="waitingTasks"></div>
        </div>
        <div class="tile tile-kanban" id="tile-kanban-done" data-column="done" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'done')">
            <div class="kanban-header done">
                <div><span class="kanban-title">‚úÖ DONE <span class="kanban-count done" id="countDone">0</span></span><div class="kanban-subtitle">Uko≈Ñczone</div></div>
                <button class="add-task-btn" onclick="openModal('done')">+</button>
            </div>
            <div class="task-list" id="doneTasks"></div>
        </div>

        <div class="tile tile-kanban" id="tile-kanban-backup" data-column="backup" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'backup')">
            <div class="kanban-header waiting">
                <div><span class="kanban-title">üíæ Backup <span class="kanban-count" id="countBackup">0</span></span><div class="kanban-subtitle">Zapasowe</div></div>
                <button class="add-task-btn" onclick="openModal('backup')">+</button>
            </div>
            <div class="task-list" id="backupTasks"></div>
        </div>

        <!-- ROW 4-5: Projects (4 columns) -->
        <div class="tile tile-project" id="tile-proj-1three">
            <div class="project-tile-title" style="display:flex;justify-content:space-between;align-items:center;">üé¨ 1three.studio <button class="add-task-btn" onclick="openAddProjectModal('onethree')" title="Dodaj projekt">+</button></div>
            <div class="project-tile-subtitle">Produkcja & szkolenia</div>
            <div id="projectsOnethree"></div>
        </div>
        <div class="tile tile-project" id="tile-proj-firmy">
            <div class="project-tile-title" style="display:flex;justify-content:space-between;align-items:center;">üè¢ Firmy <button class="add-task-btn" onclick="openAddProjectModal('firmy')" title="Dodaj projekt">+</button></div>
            <div class="project-tile-subtitle">W≈Çasne biznesy</div>
            <div id="projectsFirmy"></div>
        </div>
        <div class="tile tile-apps" id="tile-apps">
            <div class="tile-section-title">üöÄ Aplikacje</div>
            <div class="tile-section-subtitle">Pomys≈Çy & projekty dev</div>
            <div class="apps-inline" id="appsInline"></div>
        </div>
        <div class="tile tile-project" id="tile-proj-own">
            <div class="project-tile-title" style="display:flex;justify-content:space-between;align-items:center;">üè† W≈Çasne <button class="add-task-btn" onclick="openAddProjectModal('own')" title="Dodaj projekt">+</button></div>
            <div class="project-tile-subtitle">Projekty prywatne</div>
            <div id="projectsOwn"></div>
        </div>

        <!-- ROW 6-7: ON HOLD + Settings + Calendar -->
        <div class="tile tile-kanban" id="tile-kanban-onhold" data-column="onhold" style="grid-column: span 6;" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event, 'onhold')">
            <div class="kanban-header onhold">
                <div><span class="kanban-title">‚è∏Ô∏è ON HOLD <span class="kanban-count onhold" id="countOnhold">0</span></span><div class="kanban-subtitle">Wstrzymane</div></div>
                <button class="add-task-btn" onclick="openModal('onhold')">+</button>
            </div>
            <div class="task-list" id="onholdTasks"></div>
        </div>
        <div class="tile tile-settings" id="tile-settings">
            <div class="settings-title">‚öôÔ∏è Ustawienia</div>
            <input type="checkbox" id="toggleDrag" style="display:none">
            <label class="toggle-row">
                <span class="toggle-label">‚úèÔ∏è Edycja uk≈Çadu</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleFreeLayout">
                    <span class="toggle-slider"></span>
                </div>
                <input type="checkbox" id="toggleResize" style="display:none">
            </label>
            <label class="toggle-row">
                <span class="toggle-label">üé® Kolory</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleColors">
                    <span class="toggle-slider"></span>
                </div>
            </label>
            <label class="toggle-row">
                <span class="toggle-label">üóÇÔ∏è Schowaj elementy</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="toggleStash">
                    <span class="toggle-slider"></span>
                </div>
            </label>
        </div>
        <div class="tile tile-profiles" id="tile-profiles">
            <div class="settings-title">üíæ Profile widoku</div>
            <div class="profile-controls" id="profileControls"></div>
            <div style="display:flex;gap:4px;margin-top:4px;">
                <input type="text" id="profileNameInput" placeholder="Nazwa profilu..." style="flex:1;padding:3px 6px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;color:var(--text-primary);font-size:9px;outline:none;">
                <button onclick="saveProfile()" style="padding:3px 8px;background:var(--purple-500);border:none;border-radius:4px;color:white;font-size:8px;font-weight:600;cursor:pointer;">Zapisz</button>
            </div>
        </div>
        <div class="tile tile-calendar" id="tile-calendar">
            <div class="cal-header">
                <div class="cal-nav"><button onclick="changeMonth(-1)">&lt;</button></div>
                <div class="cal-title" id="calTitle">Luty 2026</div>
                <div class="cal-nav"><button onclick="changeMonth(1)">&gt;</button></div>
            </div>
            <div class="cal-grid" id="calGrid"></div>
        </div>

        <!-- ROW 8: Docs + Progress + Notes -->
        <div class="tile tile-docs" id="tile-docs">
            <div class="tile-section-title">üìÑ Dokumenty</div>
            <div class="tile-section-subtitle">Raporty & research</div>
            <div class="docs-pills" id="ediDocs"></div>
        </div>
        <div class="tile tile-progress" id="tile-progress">
            <div class="progress-ring-wrap">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <circle class="progress-ring-bg" cx="50" cy="50" r="45"/>
                    <circle class="progress-ring-fg" id="progressRing" cx="50" cy="50" r="45" stroke-dasharray="282.7" stroke-dashoffset="282.7"/>
                </svg>
                <div class="progress-ring-text" id="progressPct">0%</div>
            </div>
            <div class="progress-ring-label">Uko≈Ñczone taski</div>
        </div>
        <div class="tile tile-notes" id="tile-notes">
            <div class="notes-title">üìù Quick Notes</div>
            <textarea class="notes-textarea" id="quickNotes" placeholder="Szybkie notatki..." oninput="saveQuickNotes()"></textarea>
            <div class="notes-saved" id="notesSaved">‚úì Zapisano</div>
        </div>

        <!-- EDI LOG TILE -->
        <div class="tile tile-edilog" id="tile-edilog">
            <div class="tile-section-title">üìã Edi Log</div>
            <div class="tile-section-subtitle">Co robi≈Çem i kiedy</div>
            <div class="edilog-scroll" id="edilogContent"></div>
        </div>

        <!-- CLOCK TILE -->
        <div class="tile tile-clock" id="tile-clock">
            <div class="clock-time" id="clockTime">00:00</div>
            <div class="clock-date" id="clockDate"></div>
        </div>

        <!-- WEATHER TILE -->
        <div class="tile tile-weather" id="tile-weather">
            <div class="tile-section-title">üå§Ô∏è Pogoda ‚Äî Krak√≥w</div>
            <div style="display:flex;align-items:center;gap:8px;">
                <span id="weatherIcon" style="font-size:2rem;">‚è≥</span>
                <div>
                    <div class="weather-temp" id="weatherTemp">--¬∞C</div>
                    <div class="weather-desc" id="weatherDesc">≈Åadowanie...</div>
                </div>
            </div>
            <div class="weather-details">
                <span id="weatherWind">üí® --</span>
                <span id="weatherHumidity">üíß --</span>
                <span id="weatherFeels">üå°Ô∏è --</span>
            </div>
        </div>

        <!-- TOKENS TILE -->
        <div class="tile tile-tokens" id="tile-tokens">
            <div class="tile-section-title">üî• Tokeny</div>
            <div class="tile-section-subtitle">Dzisiejsze zu≈ºycie</div>
            <div id="tokenRows">
                <div class="token-row"><span class="token-label">Claude Opus</span><span class="token-value" id="tokenOpus">‚Äî</span></div>
                <div class="token-row"><span class="token-label">Claude Sonnet</span><span class="token-value" id="tokenSonnet">‚Äî</span></div>
                <div class="token-row"><span class="token-label">Inne</span><span class="token-value" id="tokenOther">‚Äî</span></div>
                <div class="token-row" style="border-top:1px solid var(--border);margin-top:4px;padding-top:4px;"><span class="token-label" style="font-weight:700;">SUMA</span><span class="token-value" id="tokenTotal" style="font-weight:800;">‚Äî</span></div>
                <div class="token-row"><span class="token-label" style="font-weight:700;">üí∞ Koszt</span><span class="token-value" id="tokenCost" style="color:var(--purple-300);">‚Äî</span></div>
            </div>
        </div>

        <!-- STASH TILE (always visible) -->
        <div class="tile tile-stash" id="tile-stash">
            <div class="tile-section-title">üì¶ Schowek</div>
            <div class="tile-section-subtitle">Schowane kafelki</div>
            <div class="stash-chips" id="stashChips">
                <div class="empty-state">Pusto ‚Äî schowaj kafelki prze≈ÇƒÖcznikiem üóÇÔ∏è</div>
            </div>
        </div>
    </div>

    <!-- Edi Log data (legacy hidden) -->
    <div style="display:none" id="ediLog"></div>

    <!-- App Modal -->
    <div class="modal-overlay" id="appModalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="appModalTitle">Nowa aplikacja</h3>
                <button class="modal-close" onclick="closeAppModal()">&times;</button>
            </div>
            <form id="appForm">
                <input type="hidden" id="appId">
                <div class="form-group"><label for="appName">Nazwa aplikacji *</label><input type="text" id="appName" required placeholder="np. SafeSenior Monitor"></div>
                <div class="form-group"><label for="appDesc">Opis</label><textarea id="appDesc" placeholder="Co ta aplikacja ma robiƒá?"></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label for="appStage">Etap</label><select id="appStage"><option value="idea">üí° Pomys≈Ç</option><option value="planned">üìã W planach</option><option value="progress">üî® W realizacji</option><option value="done">‚úÖ Zrobione</option></select></div>
                    <div class="form-group"><label for="appPriority">Priorytet</label><select id="appPriority"><option value="high">üî¥ Wysoki</option><option value="medium">üü° ≈öredni</option><option value="low">üü¢ Niski</option></select></div>
                </div>
                <div class="form-group"><label for="appNotes">Notatki</label><textarea id="appNotes" placeholder="Kroki, technologie..."></textarea></div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAppModal()">Anuluj</button>
                    <button type="button" class="btn btn-danger" id="deleteAppBtn" onclick="deleteApp()" style="display:none;">Usu≈Ñ</button>
                    <button type="submit" class="btn btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Nowy task</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <input type="hidden" id="taskColumn">
                <div class="form-group"><label for="taskTitle">Tytu≈Ç *</label><input type="text" id="taskTitle" required placeholder="Co trzeba zrobiƒá?"></div>
                <div class="form-row">
                    <div class="form-group"><label for="taskProject">Projekt</label><select id="taskProject"><option value="onethree">üé¨ 1THREE</option><option value="system">‚öôÔ∏è SYSTEM</option><option value="dom">üè† DOM</option><option value="osobiste">üë§ OSOBISTE</option><option value="pomysl">üí° POMYS≈Å</option><option value="research">üîç RESEARCH</option></select></div>
                    <div class="form-group"><label for="taskDeadline">Deadline</label><select id="taskDeadline"><option value="now">Teraz!</option><option value="today">Dzi≈õ</option><option value="week">Ten tydzie≈Ñ</option><option value="later">P√≥≈∫niej</option></select></div>
                </div>
                <div class="form-group"><label for="taskNotes">Notatki</label><textarea id="taskNotes" placeholder="Dodatkowe informacje..."></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label for="taskTime">‚è±Ô∏è Czas (est.)</label><input type="text" id="taskTime" placeholder="np. 2h, 30min"></div>
                    <div class="form-group"><label for="taskCalendar">üìÖ Zaplanuj w kalendarzu</label><select id="taskCalendar"><option value="">Nie planuj</option><option value="today">Dzi≈õ</option><option value="tomorrow">Jutro</option><option value="thisweek">Ten tydzie≈Ñ</option></select></div>
                </div>
                <div class="form-group">
                    <label for="taskAttachments">üìé Za≈ÇƒÖczniki / Rezultaty</label>
                    <div id="attachmentsList"></div>
                    <div class="attachment-input">
                        <input type="text" id="newAttachmentName" placeholder="Nazwa">
                        <input type="text" id="newAttachmentPath" placeholder="≈öcie≈ºka pliku">
                        <button type="button" class="btn btn-small" onclick="addAttachment()">+</button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Anuluj</button>
                    <button type="button" class="btn btn-danger" id="deleteBtn" onclick="deleteTask()" style="display:none;">Usu≈Ñ</button>
                    <button type="submit" class="btn btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLOUD SYNC (GitHub Gist) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const GIST_ID = '5ea142fdafd9f73cafd36ecd69cec9d2';
        const GIST_FILE = 'dashboard-data.json';
        const ENC_TOKEN = {"iv":"733B6NLzzJmFZcOp","data":"eLbt3qyPpEiTc+a1n286Oeul4/3SQ3N0CIoE0BFpWOAVUVim3WpEwA==","tag":"SiRwLGUWYvSURm16hgR5Rw=="};
        let _syncTimer = null;
        let _cloudLoaded = false;
        const _pageLoadTime = Date.now();
        let _ghToken = null;

        async function getToken() {
            if (_ghToken) return _ghToken;
            const pin = localStorage.getItem('ediDashAuth') ? '2452' : null;
            if (!pin) return null;
            try {
                const keyData = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(pin));
                const key = await crypto.subtle.importKey('raw', keyData, 'AES-GCM', false, ['decrypt']);
                const iv = Uint8Array.from(atob(ENC_TOKEN.iv), c => c.charCodeAt(0));
                const data = Uint8Array.from(atob(ENC_TOKEN.data), c => c.charCodeAt(0));
                const tag = Uint8Array.from(atob(ENC_TOKEN.tag), c => c.charCodeAt(0));
                const combined = new Uint8Array(data.length + tag.length);
                combined.set(data); combined.set(tag, data.length);
                const dec = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, combined);
                _ghToken = new TextDecoder().decode(dec);
                return _ghToken;
            } catch(e) { console.warn('Token decrypt failed:', e); return null; }
        }

        let _lastSaveTime = 0;
        function saveToCloud() {
            if (!_cloudLoaded && Date.now() - _pageLoadTime < 5000) { console.warn('Skip save ‚Äî cloud not loaded yet'); return; }
            _lastSaveTime = Date.now();
            if (_syncTimer) clearTimeout(_syncTimer);
            _syncTimer = setTimeout(async () => {
                const token = await getToken();
                if (!token) { console.warn('No token'); return; }
                const data = {
                    version: 2,
                    lastSync: new Date().toISOString(),
                    tasks: JSON.parse(localStorage.getItem('ediTasks') || '[]'),
                    projectsOnethree: JSON.parse(localStorage.getItem('ediProjectsOnethree') || '[]'),
                    projectsFirmy: JSON.parse(localStorage.getItem('ediProjectsFirmy') || '[]'),
                    projectsOwn: JSON.parse(localStorage.getItem('ediProjectsOwn') || '[]'),
                    apps: JSON.parse(localStorage.getItem('ediApps') || '[]'),
                    docs: JSON.parse(localStorage.getItem('ediDocs') || '[]'),
                    quickNotes: localStorage.getItem('ediQuickNotes') || '',
                    hiddenTiles: JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]'),
                    tileColors: JSON.parse(localStorage.getItem('dashboardTileColors') || '{}'),
                    tileOrder: JSON.parse(localStorage.getItem('dashboardTileOrder') || '[]'),
                    editMode: JSON.parse(localStorage.getItem('dashboardEditMode') || '{}'),
                    kanbanNames: JSON.parse(localStorage.getItem('dashboardKanbanNames') || '{}'),
                };
                const indicator = document.getElementById('syncStatus');
                if (indicator) { indicator.textContent = '‚è≥'; indicator.style.color = 'orange'; }
                fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: 'PATCH',
                    headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ files: { [GIST_FILE]: { content: JSON.stringify(data) } } })
                }).then(r => { if (!r.ok) throw new Error('HTTP ' + r.status); return r; }).then(() => {
                    localStorage.setItem('_lastLocalSave', '0');
                    const indicator = document.getElementById('syncStatus');
                    if (indicator) { indicator.textContent = '‚òÅÔ∏è Zapisano'; indicator.style.color = 'var(--green)'; setTimeout(() => { indicator.textContent = '‚òÅÔ∏è'; indicator.style.color = ''; }, 2000); }
                }).catch(err => {
                    console.warn('Cloud save failed:', err);
                    const indicator = document.getElementById('syncStatus');
                    if (indicator) { indicator.textContent = '‚ö†Ô∏è Offline'; indicator.style.color = 'var(--red)'; }
                });
            }, 300);
        }

        // Auto-refresh from cloud every 30s (skip if recently saved locally)
        setInterval(() => {
            if (document.hidden) return;
            if (Date.now() - _lastSaveTime < 10000) return; // skip refresh for 10s after local save
            loadFromCloud().then(loaded => {
                if (!loaded) return;
                tasks = JSON.parse(localStorage.getItem('ediTasks') || '[]');
                const s1 = localStorage.getItem('ediProjectsOnethree'); if (s1) projectsOnethree = JSON.parse(s1);
                const s2 = localStorage.getItem('ediProjectsFirmy'); if (s2) projectsFirmy = JSON.parse(s2);
                const s3 = localStorage.getItem('ediProjectsOwn'); if (s3) projectsOwn = JSON.parse(s3);
                const sa = localStorage.getItem('ediApps'); if (sa) apps = JSON.parse(sa);
                renderTasks(); renderProjects(); renderApps();
            });
        }, 30000);

        async function loadFromCloud() {
            const token = await getToken();
            const headers = { 'Accept': 'application/vnd.github+json' };
            if (token) headers['Authorization'] = `token ${token}`;
            return fetch(`https://api.github.com/gists/${GIST_ID}`, { headers })
                .then(r => r.json())
                .then(gist => {
                    const content = gist.files && gist.files[GIST_FILE] && gist.files[GIST_FILE].content;
                    if (!content) return false;
                    const data = JSON.parse(content);
                    if (!data || !data.version) return false;
                    // Skip cloud load if we have unsaved local changes
                    const cloudTime = data.lastSync ? new Date(data.lastSync).getTime() : 0;
                    const localSaveTime = parseInt(localStorage.getItem('_lastLocalSave') || '0');
                    if (localSaveTime > cloudTime) { console.log('Skip cloud load ‚Äî local is newer'); return false; }
                    function setIfHasData(key, val) {
                        if (val === undefined || val === null) return;
                        const str = typeof val === 'string' ? val : JSON.stringify(val);
                        localStorage.setItem(key, str);
                    }
                    setIfHasData('ediTasks', data.tasks);
                    setIfHasData('ediProjectsOnethree', data.projectsOnethree);
                    setIfHasData('ediProjectsFirmy', data.projectsFirmy);
                    setIfHasData('ediProjectsOwn', data.projectsOwn);
                    setIfHasData('ediApps', data.apps);
                    setIfHasData('ediDocs', data.docs);
                    if (data.quickNotes) localStorage.setItem('ediQuickNotes', data.quickNotes);
                    setIfHasData('dashboardHiddenTiles', data.hiddenTiles);
                    if (data.tileColors && Object.keys(data.tileColors).length > 0) localStorage.setItem('dashboardTileColors', JSON.stringify(data.tileColors));
                    if (data.tileOrder && data.tileOrder.length > 0) localStorage.setItem('dashboardTileOrder', JSON.stringify(data.tileOrder));
                    if (data.kanbanNames) localStorage.setItem('dashboardKanbanNames', JSON.stringify(data.kanbanNames));
                    _cloudLoaded = true;
                    const indicator = document.getElementById('syncStatus');
                    if (indicator) { indicator.textContent = '‚òÅÔ∏è'; indicator.style.color = 'var(--green)'; setTimeout(() => { indicator.style.color = ''; }, 2000); }
                    return true;
                })
                .catch(err => { console.warn('Cloud load failed, using localStorage:', err); return false; });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA STORAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        let tasks = JSON.parse(localStorage.getItem('ediTasks')) || [];
        let projectsOnethree = [
            { id: 'onethree', driveLink: 'https://drive.google.com/open?id=1xejwSec3QdJ84kqj7uRHW2eDvLQdEsXF', docs: [{name:'1three-studio-kalendarz-luty-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/1three-studio-kalendarz-luty-2026.md'},{name:'1three-studio-programy-szkoleniowe.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/1three-studio-programy-szkoleniowe.md'},{name:'RESEARCH-1THREE-02-02.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-1THREE-02-02.md'},{name:'RESEARCH-DOFINANSOWANIA-1THREE.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-DOFINANSOWANIA-1THREE.md'},{name:'RESEARCH-SZKOLENIA-AI-POLSKA-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-SZKOLENIA-AI-POLSKA-2026.md'},{name:'RESEARCH-ZAROBKI-1THREE-2026-02.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-ZAROBKI-1THREE-2026-02.md'}], name: 'üé¨ 1three.studio', desc: 'Produkcja, szkolenia, klienci', progress: 65, status: 'active',
              tasks: [{text: 'HubSpot email sync fix', done: false}, {text: 'Szkolenia BUR - nowe programy', done: false}], notes: '' },
            { id: 'kubus', driveLink: 'https://drive.google.com/open?id=1TBMMNr8d8ykIQ-vmQWF7Fu7myPr-6P8n', docs: [{name:'maspex-kubus-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/KUBUS/maspex-kubus-2026.md'},{name:'maspex-kubus-harmonogram.md',path:'/Users/t8/.openclaw/workspace/projekty/KUBUS/maspex-kubus-harmonogram.md'}], name: 'üß∏ Kubu≈õ (Maspex)', desc: 'Spot reklamowy', progress: 40, status: 'urgent',
              tasks: [{text: 'Prawa ElevenLabs - mail wys≈Çany', done: true}, {text: 'Finalny render', done: false}], notes: '' },
            { id: 'especto', driveLink: 'https://drive.google.com/open?id=1yr_og1wvrhg8J050nAfuT10KZxjic4mY', docs: [{name:'BIBLIOTEKA-PROMPTOW-GOOGLE-AI-ESPECTO.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/BIBLIOTEKA-PROMPTOW-GOOGLE-AI-ESPECTO.md'},{name:'PROCEDURY-OPERACYJNE-AI-ESPECTO.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/PROCEDURY-OPERACYJNE-AI-ESPECTO.md'},{name:'RAPORT-ESPECTO-DRAFT.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-DRAFT.md'},{name:'RAPORT-ESPECTO-FINAL.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-FINAL.md'},{name:'RAPORT-ESPECTO-v2.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-v2.md'},{name:'RAPORT_ESPECTO_GOOGLE_AI.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT_ESPECTO_GOOGLE_AI.md'},{name:'RESEARCH-GOOGLE-AI-STACK-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RESEARCH-GOOGLE-AI-STACK-2026.md'},{name:'WORKFLOW-AI-ESPECTO-MAIN.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/WORKFLOW-AI-ESPECTO-MAIN.md'},{name:'WORKFLOW-AI-GOOGLE-ESPECTO.md',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/WORKFLOW-AI-GOOGLE-ESPECTO.md'}], name: 'üé™ Especto', desc: 'Audyt AI dla firmy eventowej', progress: 95, status: 'active',
              tasks: [{text: 'Dokumenty na Drive', done: true}, {text: 'Protok√≥≈Ç odbioru', done: false}], notes: 'Deadline: 04.02.2026' },
        ];
        let projectsFirmy = [
            { id: 'virface', docs: [], name: 'üë§ Virface.com', desc: 'AI avatary', progress: 80, status: 'warning', tasks: [], notes: '' },
            { id: 'aiartists', docs: [], name: 'üé® AI Artists Agency', desc: 'Agencja artyst√≥w AI', progress: 30, status: 'warning', tasks: [{text: 'Strona www - prompt', done: false}], notes: '' },
            { id: 'safesenior', docs: [], name: 'üë¥ SafeSenior.ai', desc: 'AI dla senior√≥w', progress: 20, status: 'active', tasks: [], notes: '' },
        ];
        let projectsOwn = [
            { id: 'dom', driveLink: 'https://drive.google.com/open?id=1ehGwMnZhpFzLY3mY3DLaWGWpwhxA--ZQ', docs: [{name:'MPZP-INFO.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/MPZP-INFO.md'},{name:'PODSUMOWANIE-RESEARCH-03-02.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/PODSUMOWANIE-RESEARCH-03-02.md'},{name:'README.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/README.md'},{name:'RESEARCH-CENY-DZIALEK.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-CENY-DZIALEK.md'},{name:'RESEARCH-GEODECI.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-GEODECI.md'}], name: 'üè† DOM Czarnochowice', desc: 'Darowizna dzia≈Çki od Taty', progress: 15, status: 'active',
              tasks: [{text: 'Research geodet√≥w', done: true}, {text: 'Research cen dzia≈Çek', done: true}, {text: 'Dane od Taty (KW, PESEL)', done: false}], notes: 'Czekam na spotkanie z TatƒÖ' },
        ];
        let apps = JSON.parse(localStorage.getItem('ediApps')) || [
            { id: 1, name: 'üé¨ Operator Kamery', desc: 'Aplikacja do pisania prompt√≥w z integracjƒÖ Nano Banana', stage: 'idea', priority: 'medium', notes: 'Pomys≈Ç z 03.02.2026' },
            { id: 2, name: 'üë¥ SafeSenior Monitor', desc: 'Panel zdalnego monitorowania zdrowia senior√≥w - integracja Apple Health', stage: 'idea', priority: 'high', notes: 'Integracja z VITRO, Apple Health Sharing, alerty' },
            { id: 3, name: 'üéØ Edi Dashboard', desc: 'Panel zarzƒÖdzania taskami i projektami', stage: 'progress', priority: 'high', notes: 'Aktualnie rozwijany!' },
        ];
        let ediLog = [
            { time: '20:38', icon: 'üìÅ', title: 'Dokumenty Especto wrzucone na Google Drive', detail: '4 pliki w gdrive:1three/ESPECTO-AI-WORKFLOW/', tag: 'ESPECTO' },
            { time: '20:25', icon: 'üîß', title: 'Zainstalowa≈Çem yt-dlp + stworzy≈Ç skill', detail: 'Teraz mogƒô pobieraƒá transkrypcje z YouTube', tag: 'SYSTEM' },
            { time: '20:19', icon: 'üì∫', title: 'Pobra≈Çem transkrypcjƒô z YouTube', detail: 'Research Google AI tools - zaktualizowa≈Çem dokumenty', tag: 'ESPECTO' },
            { time: '19:07', icon: 'üìù', title: 'Research Google AI Stack', detail: 'Imagen 4, Veo 3.1, Gemini 3, NotebookLM - pe≈Çny research', tag: 'ESPECTO' },
            { time: '19:00', icon: 'üìÑ', title: 'Stworzy≈Ç dokumenty dla Especto', detail: 'Workflow, Biblioteka prompt√≥w, Procedury operacyjne', tag: 'ESPECTO' },
            { time: '18:40', icon: 'üîç', title: 'Research geodet√≥w Wieliczka', detail: 'Lista firm z cenami i opiniami', tag: 'DOM' },
            { time: '13:52', icon: 'üé®', title: 'Dashboard v2', detail: 'Edi Command Center - pierwsza wersja', tag: 'SYSTEM' },
        ];
        let ediDocs = JSON.parse(localStorage.getItem('ediDocs')) || [
            { id: 1, name: 'RAPORT-ESPECTO-FINAL.md', type: 'raport', date: '02.02.2026', preview: 'Raport AI Video dla Especto', path: '/Users/t8/.openclaw/workspace/RAPORT-ESPECTO-FINAL.md' },
            { id: 2, name: 'RESEARCH-SZKOLENIA-AI-POLSKA-2026.md', type: 'research', date: '02.02.2026', preview: 'Analiza rynku szkole≈Ñ AI w Polsce', path: '/Users/t8/.openclaw/workspace/RESEARCH-SZKOLENIA-AI-POLSKA-2026.md' },
            { id: 3, name: 'PLAN-LUTY-2026.md', type: 'plan', date: '02.02.2026', preview: 'Plan dzia≈Ça≈Ñ na luty', path: '/Users/t8/.openclaw/workspace/PLAN-LUTY-2026.md' },
            { id: 4, name: 'RESEARCH-DOFINANSOWANIA-1THREE.md', type: 'research', date: '02.02.2026', preview: 'Mo≈ºliwo≈õci dofinansowania EU', path: '/Users/t8/.openclaw/workspace/RESEARCH-DOFINANSOWANIA-1THREE.md' },
            { id: 5, name: 'RESEARCH-MEMORY-UPGRADE.md', type: 'research', date: '04.02.2026', preview: 'RozwiƒÖzania dla pamiƒôci agenta', path: '/Users/t8/.openclaw/workspace/RESEARCH-MEMORY-UPGRADE.md' },
        ];

        if (tasks.length === 0) {
            tasks = [
                { id: 1, title: 'Research geodet√≥w Wieliczka', project: 'dom', column: 'done', deadline: 'today', notes: '', createdAt: Date.now() },
                { id: 2, title: 'Dokumenty Especto na Drive', project: 'especto', column: 'done', deadline: 'today', notes: '', createdAt: Date.now() },
                { id: 3, title: 'HubSpot email sync fix', project: 'onethree', column: 'todo', deadline: 'week', notes: 'Emaile nie synchronizujƒÖ siƒô od 04.12', createdAt: Date.now() },
                { id: 4, title: 'Dane od Taty (KW, PESEL)', project: 'dom', column: 'waiting', deadline: 'week', notes: 'Po spotkaniu z TatƒÖ', createdAt: Date.now() },
                { id: 5, title: 'üé¨ OPERATOR KAMERY - aplikacja do prompt√≥w + Nano Banana', project: 'onethree', column: 'todo', deadline: 'later', notes: 'Nowy pomys≈Ç na aplikacjƒô!', createdAt: Date.now() },
            ];
            saveTasks();
        }

        function renderTasks() {
            const columns = ['urgent', 'todo', 'waiting', 'done', 'onhold', 'backup'];
            const stats = { urgent: 0, todo: 0, waiting: 0, done: 0, onhold: 0, backup: 0 };
            columns.forEach(col => {
                const container = document.getElementById(col + 'Tasks');
                const columnTasks = tasks.filter(t => t.column === col);
                stats[col] = columnTasks.length;
                if (columnTasks.length === 0) {
                    container.innerHTML = '<div class="empty-state">Brak task√≥w</div>';
                } else {
                    container.innerHTML = columnTasks.map((task, idx) => `
                        <div class="task-card" draggable="true" ondragstart="dragStart(event, ${task.id})" ondragover="taskDragOver(event)" ondrop="taskDrop(event, ${task.id}, '${col}')" onclick="openModal('${col}', ${task.id})">
                            <span class="task-num">${String(idx + 1).padStart(2, '0')}</span>
                            <div class="task-card-content">
                                <div class="task-row">
                                    <span class="task-title">${task.title}${task.estimatedTime ? '<span class="task-time-badge">‚è±Ô∏è '+task.estimatedTime+'</span>' : ''}${task.calendarSlot ? '<span class="task-time-badge">üìÖ</span>' : ''}</span>
                                    <span class="task-project ${task.project}">${getProjectLabel(task.project)}</span>
                                </div>
                                ${task.attachments && task.attachments.length > 0 ? `<div class="task-attachments">${task.attachments.map(att => `<a class="task-attachment-link" href="file://${att.path}" target="_blank" onclick="event.stopPropagation()">üìé ${att.name}</a>`).join('')}</div>` : ''}
                            </div>
                            <span class="task-status-circle ${col}"></span>
                        </div>
                    `).join('');
                }
            });
            document.getElementById('statUrgent').textContent = stats.urgent;
            document.getElementById('statTodo').textContent = stats.todo;
            document.getElementById('statWaiting').textContent = stats.waiting;
            document.getElementById('statDone').textContent = stats.done;
            document.getElementById('countUrgent').textContent = stats.urgent;
            document.getElementById('countTodo').textContent = stats.todo;
            document.getElementById('countWaiting').textContent = stats.waiting;
            document.getElementById('countDone').textContent = stats.done;
            document.getElementById('countOnhold').textContent = stats.onhold;
            document.getElementById('statOnhold').textContent = stats.onhold;
            const backupEl = document.getElementById('countBackup'); if (backupEl) backupEl.textContent = stats.backup;
            renderProgressRing();
        }

        let draggedTaskId = null;
        function dragStart(event, taskId) { draggedTaskId = taskId; event.dataTransfer.effectAllowed = 'move'; event.target.style.opacity = '0.5'; }
        function dragOver(event) { event.preventDefault(); event.dataTransfer.dropEffect = 'move'; event.currentTarget.classList.add('drag-over'); }
        function dragLeave(event) { event.currentTarget.classList.remove('drag-over'); }
        function taskDragOver(event) { event.preventDefault(); event.stopPropagation(); event.dataTransfer.dropEffect = 'move'; }
        function taskDrop(event, targetTaskId, column) {
            event.preventDefault(); event.stopPropagation();
            if (draggedTaskId === null || draggedTaskId === targetTaskId) return;
            const draggedTask = tasks.find(t => t.id === draggedTaskId);
            if (!draggedTask) return;
            draggedTask.column = column;
            const colTasks = tasks.filter(t => t.column === column && t.id !== draggedTaskId);
            const targetIdx = colTasks.findIndex(t => t.id === targetTaskId);
            const otherTasks = tasks.filter(t => t.column !== column && t.id !== draggedTaskId);
            colTasks.splice(targetIdx, 0, draggedTask);
            tasks = [...otherTasks, ...colTasks];
            saveTasks(); renderTasks(); draggedTaskId = null;
        }
        function drop(event, newColumn) {
            event.preventDefault(); event.currentTarget.classList.remove('drag-over');
            if (draggedTaskId !== null) { const task = tasks.find(t => t.id === draggedTaskId); if (task) { task.column = newColumn; saveTasks(); renderTasks(); } draggedTaskId = null; }
        }
        document.addEventListener('dragend', function(e) { if (e.target.classList.contains('task-card')) e.target.style.opacity = '1'; document.querySelectorAll('[data-column]').forEach(col => col.classList.remove('drag-over')); });

        function renderProjects() {
            const renderCards = (projects, category) => projects.map(p => {
                const totalTasks = (p.tasks || []).length;
                const doneTasks = (p.tasks || []).filter(t => t.done).length;
                const autoProgress = totalTasks > 0 ? Math.round((doneTasks / totalTasks) * 100) : 0;
                return `
                <div class="project-card" data-project="${p.id}" data-category="${category}" onclick="toggleProject(this)">
                    <div class="project-item">
                        <span class="project-status ${p.status}"></span>
                        <span class="project-name" ondblclick="editProjectName('${p.id}', '${category}', event)" title="Dwuklik = edycja nazwy">${p.name}</span>
                        <div class="project-progress-wrap">
                            <div class="progress-bar"><div class="progress-fill" style="width:${autoProgress}%"></div></div>
                            <span class="progress-pct">${doneTasks}/${totalTasks}</span>
                        </div>
                        <span onclick="deleteProject('${p.id}', '${category}', event)" style="cursor:pointer;opacity:0.3;font-size:9px;margin-left:2px;" title="Usu≈Ñ projekt">‚úï</span>
                        <span class="expand-icon">‚ñº</span>
                    </div>
                    <div class="project-details">
                        <button class="project-close-btn" onclick="event.stopPropagation(); this.closest('.project-card').classList.remove('expanded'); var o=document.getElementById('projectOverlay'); if(o) o.classList.remove('active');">‚úï Zamknij</button>
                        <div style="margin-bottom:8px;display:flex;align-items:center;gap:6px;">
                            <span style="font-size:9px;color:var(--text-secondary);font-weight:600;">STATUS:</span>
                            <select onchange="changeProjectStatus('${p.id}', '${category}', this.value)" onclick="event.stopPropagation()" style="background:var(--bg-body);color:var(--text-primary);border:1px solid var(--border);border-radius:6px;padding:3px 8px;font-size:10px;cursor:pointer;">
                                <option value="active" ${p.status==='active'?'selected':''}>üü° W trakcie</option>
                                <option value="done" ${p.status==='done'?'selected':''}>‚úÖ Zako≈Ñczony</option>
                                <option value="hold" ${p.status==='hold'?'selected':''}>‚è∏Ô∏è Wstrzymany</option>
                                <option value="idea" ${p.status==='idea'?'selected':''}>üí° Pomys≈Ç</option>
                            </select>
                        </div>
                        <div class="project-tasks-title">‚úÖ Zadania</div>
                        <div class="project-tasks-list" id="tasks-${p.id}">
                            ${p.tasks.map((t, i) => `<div class="project-task-item ${t.done ? 'done' : ''}" style="display:flex;align-items:center;gap:4px;"><input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleProjectTask('${p.id}', ${i}, '${category}', event)"><span onclick="editProjectTask('${p.id}', ${i}, '${category}', event)" style="cursor:pointer;flex:1;" title="Kliknij by edytowaƒá">${t.text}</span><span onclick="deleteProjectTask('${p.id}', ${i}, '${category}', event)" style="cursor:pointer;opacity:0.4;font-size:9px;flex-shrink:0;" title="Usu≈Ñ">‚úï</span></div>`).join('') || '<div style="color:var(--text-secondary);font-size:9px">Brak zada≈Ñ</div>'}
                        </div>
                        <div class="add-project-task">
                            <input type="text" placeholder="Nowe zadanie..." id="newTask-${p.id}" onkeypress="if(event.key==='Enter') addProjectTask('${p.id}', '${category}', event)">
                            <button onclick="addProjectTask('${p.id}', '${category}', event)">+</button>
                        </div>
                        <div class="project-notes"><div class="project-notes-label">üìù Notatki:</div><textarea placeholder="Dodaj notatki..." onchange="updateProjectNotes('${p.id}', '${category}', this.value)" onclick="event.stopPropagation()">${p.notes || ''}</textarea></div>
                        <div style="margin-top:8px;display:flex;gap:4px;align-items:center;">
                            <input type="text" placeholder="Link do Google Drive..." value="${p.driveLink||''}" onchange="updateProjectDrive('${p.id}','${category}',this.value)" onclick="event.stopPropagation()" style="flex:1;background:var(--bg-body);color:var(--text-primary);border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-size:10px;">
                            ${p.driveLink ? `<a href="${p.driveLink}" target="_blank" onclick="event.stopPropagation()" style="background:linear-gradient(135deg,#3b82f6,#10b981);color:white;border:none;border-radius:6px;padding:6px 12px;font-size:10px;font-weight:600;text-decoration:none;white-space:nowrap;">üìÅ Drive</a>` : ''}
                        </div>
                        <!-- docs list removed - Drive link is enough -->
                    </div>
                </div>
            `}).join('');
            document.getElementById('projectsOnethree').innerHTML = renderCards(projectsOnethree, 'onethree');
            document.getElementById('projectsFirmy').innerHTML = renderCards(projectsFirmy, 'firmy');
            document.getElementById('projectsOwn').innerHTML = renderCards(projectsOwn, 'own');
        }

        function toggleProject(card) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.tagName === 'BUTTON') return;
            closeProjectPopup();
            const details = card.querySelector('.project-details');
            if (!details) return;
            
            // Clone details into a fixed popup outside grid
            let overlay = document.getElementById('projectOverlay');
            let popup = document.getElementById('projectPopup');
            if (!overlay) {
                overlay = document.createElement('div'); overlay.id = 'projectOverlay'; overlay.className = 'project-overlay';
                overlay.onclick = closeProjectPopup;
                document.body.appendChild(overlay);
            }
            if (!popup) {
                popup = document.createElement('div'); popup.id = 'projectPopup';
                popup.style.cssText = 'display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:99999;background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:24px 28px;width:60%;max-width:360px;max-height:85vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.8);line-height:1.8;';
                document.body.appendChild(popup);
            }
            const projName = card.querySelector('.project-name')?.textContent || '';
            const projId = card.dataset.project;
            const projCat = card.dataset.category;
            popup.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:1px solid var(--border);margin-bottom:10px;"><input type="text" value="' + projName.replace(/"/g,'&quot;') + '" style="font-weight:700;font-size:13px;color:var(--text-primary);background:transparent;border:1px solid transparent;border-radius:6px;padding:2px 6px;flex:1;outline:none;" onfocus="this.style.borderColor=\'var(--border)\'" onblur="this.style.borderColor=\'transparent\'; renameProjectFromPopup(\'' + projId + '\',\'' + projCat + '\',this.value)" onkeypress="if(event.key===\'Enter\'){this.blur()}"><button onclick="closeProjectPopup()" style="color:var(--purple-300);font-size:12px;font-weight:700;cursor:pointer;background:none;border:none;margin-left:8px;">‚úï</button></div>' + details.innerHTML;
            popup.style.display = 'block';
            overlay.classList.add('active');
        }
        function closeProjectPopup() {
            const overlay = document.getElementById('projectOverlay');
            const popup = document.getElementById('projectPopup');
            if (overlay) overlay.classList.remove('active');
            if (popup) popup.style.display = 'none';
            document.querySelectorAll('.project-card.expanded').forEach(c => c.classList.remove('expanded'));
        }
        function getProjectArray(category) { if (category === 'onethree') return projectsOnethree; if (category === 'firmy') return projectsFirmy; if (category === 'own') return projectsOwn; }

        function toggleProjectTask(projectId, taskIndex, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (project && project.tasks[taskIndex]) { project.tasks[taskIndex].done = !project.tasks[taskIndex].done; saveProjectData(); renderProjects(); reopenProjectPopup(projectId); }
        }

        function addProjectTask(projectId, category, event) {
            event.stopPropagation();
            // Try popup input first, then fall back to card input
            const popup = document.getElementById('projectPopup');
            let input = popup && popup.style.display !== 'none' ? popup.querySelector(`#newTask-${projectId}`) : null;
            if (!input) input = document.getElementById(`newTask-${projectId}`);
            const text = input.value.trim(); if (!text) return;
            input.value = '';
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (project) { project.tasks.push({ text, done: false }); saveProjectData(); renderProjects(); reopenProjectPopup(projectId); }
        }

        function reopenProjectPopup(projectId) {
            setTimeout(() => {
                const popup = document.getElementById('projectPopup');
                if (!popup || popup.style.display === 'none') return;
                // Find project in data (not DOM)
                let project, category;
                for (const [cat, arr] of [['onethree', projectsOnethree], ['firmy', projectsFirmy], ['own', projectsOwn]]) {
                    const found = arr.find(p => p.id === projectId);
                    if (found) { project = found; category = cat; break; }
                }
                if (!project) return;
                const tasksHtml = (project.tasks || []).map((t, i) => 
                    `<div class="project-task-item ${t.done ? 'done' : ''}" style="display:flex;align-items:center;gap:4px;"><input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleProjectTask('${projectId}', ${i}, '${category}', event)"><span onclick="editProjectTask('${projectId}', ${i}, '${category}', event)" style="cursor:pointer;flex:1;" title="Kliknij by edytowaƒá">${t.text}</span><span onclick="deleteProjectTask('${projectId}', ${i}, '${category}', event)" style="cursor:pointer;opacity:0.4;font-size:9px;flex-shrink:0;" title="Usu≈Ñ">‚úï</span></div>`
                ).join('') || '<div style="color:var(--text-secondary);font-size:9px">Brak zada≈Ñ</div>';
                const statusOpts = ['active','paused','done'].map(s => `<option value="${s}" ${project.status===s?'selected':''}>${s==='active'?'üü° W trakcie':s==='paused'?'‚è∏Ô∏è Wstrzymany':'‚úÖ Gotowy'}</option>`).join('');
                popup.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:1px solid var(--border);margin-bottom:10px;"><input type="text" value="${(project.name||'').replace(/"/g,'&quot;')}" style="font-weight:700;font-size:13px;color:var(--text-primary);background:transparent;border:1px solid transparent;border-radius:6px;padding:2px 6px;flex:1;outline:none;" onfocus="this.style.borderColor='var(--border)'" onblur="this.style.borderColor='transparent'; renameProjectFromPopup('${projectId}','${category}',this.value)" onkeypress="if(event.key==='Enter'){this.blur()}"><button onclick="closeProjectPopup()" style="color:var(--purple-300);font-size:12px;font-weight:700;cursor:pointer;background:none;border:none;margin-left:8px;">‚úï</button></div>
                <div style="margin-bottom:8px;display:flex;align-items:center;gap:6px;"><b style="font-size:10px;color:var(--text-secondary)">STATUS:</b><select onchange="updateProjectStatus('${projectId}','${category}',this.value)" style="background:var(--bg-body);color:var(--text-primary);border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-size:10px;">${statusOpts}</select></div>
                <div style="font-weight:700;font-size:10px;color:var(--green);margin:8px 0 4px;">‚úÖ ZADANIA</div>
                ${tasksHtml}
                <div style="display:flex;gap:4px;margin-top:6px;"><input type="text" placeholder="Nowe zadanie..." id="newTask-${projectId}" onkeypress="if(event.key==='Enter') addProjectTask('${projectId}', '${category}', event)" style="flex:1;padding:6px 8px;background:var(--bg-body);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-size:10px;outline:none;"><button onclick="addProjectTask('${projectId}', '${category}', event)" style="background:var(--purple-500);color:white;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;font-weight:700;">+</button></div>
                <div style="font-weight:700;font-size:10px;color:var(--purple-300);margin:10px 0 4px;">üìù NOTATKI:</div>
                <textarea onchange="updateProjectNotes('${projectId}','${category}',this.value)" style="width:100%;min-height:60px;background:var(--bg-body);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);padding:8px;font-size:10px;resize:vertical;outline:none;" placeholder="Dodaj notatki...">${(project.notes||'').replace(/</g,'&lt;')}</textarea>
                <div style="margin-top:8px;display:flex;gap:4px;"><input type="text" value="${project.driveLink||''}" placeholder="Link do Google Drive..." onchange="updateDriveLink('${projectId}','${category}',this.value)" style="flex:1;padding:6px 8px;background:var(--bg-body);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-size:9px;outline:none;">${project.driveLink ? `<a href="${project.driveLink}" target="_blank" style="background:var(--purple-500);color:white;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;font-weight:700;font-size:9px;text-decoration:none;display:flex;align-items:center;gap:2px;white-space:nowrap;">üìÅ Drive</a>`:''}</div>`;
            }, 50);
        }

        function updateProjectNotes(projectId, category, notes) { const projects = getProjectArray(category); const project = projects.find(p => p.id === projectId); if (project) { project.notes = notes; saveProjectData(); } }

        function editProjectTask(projectId, taskIndex, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (!project || !project.tasks[taskIndex]) return;
            const newText = prompt('Edytuj zadanie:', project.tasks[taskIndex].text);
            if (newText === null) return;
            if (newText.trim() === '') { deleteProjectTask(projectId, taskIndex, category, event); return; }
            project.tasks[taskIndex].text = newText.trim();
            saveProjectData(); renderProjects();
            setTimeout(() => { const card = document.querySelector(`[data-project="${projectId}"]`); if (card) card.classList.add('expanded'); }, 10);
        }

        function deleteProjectTask(projectId, taskIndex, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            project.tasks.splice(taskIndex, 1);
            saveProjectData(); renderProjects(); reopenProjectPopup(projectId);
        }

        function updateProjectDrive(projectId, category, link) {
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (project) { project.driveLink = link.trim(); saveProjectData(); renderProjects(); reopenProjectPopup(projectId); }
        }

        function renameProjectFromPopup(projectId, category, newName) {
            if (!newName || !newName.trim()) return;
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (project && project.name !== newName.trim()) { project.name = newName.trim(); saveProjectData(); renderProjects(); }
        }

        function changeProjectStatus(projectId, category, newStatus) {
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            project.status = newStatus;
            if (newStatus === 'done') { project.progress = 100; }
            saveProjectData(); renderProjects(); closeProjectPopup();
        }

        function openAddProjectModal(category) {
            const name = prompt('Nazwa projektu:');
            if (!name || !name.trim()) return;
            const desc = prompt('Opis (opcjonalnie):') || '';
            const projects = getProjectArray(category);
            const id = name.toLowerCase().replace(/[^a-z0-9]/g, '') + '_' + Date.now();
            projects.push({ id, name: name.trim(), desc: desc.trim(), progress: 0, status: 'active', tasks: [], notes: '', docs: [] });
            saveProjectData();
            renderProjects();
        }

        function deleteProject(projectId, category, event) {
            event.stopPropagation();
            if (!confirm('UsunƒÖƒá ten projekt?')) return;
            const projects = getProjectArray(category);
            const idx = projects.findIndex(p => p.id === projectId);
            if (idx > -1) { projects.splice(idx, 1); saveProjectData(); renderProjects(); }
        }

        function editProjectName(projectId, category, event) {
            event.stopPropagation();
            const projects = getProjectArray(category);
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            const newName = prompt('Nazwa projektu:', project.name);
            if (newName === null || !newName.trim()) return;
            project.name = newName.trim();
            const newDesc = prompt('Opis (obecny: ' + (project.desc || 'brak') + '):', project.desc || '');
            if (newDesc !== null) project.desc = newDesc.trim();
            saveProjectData(); renderProjects();
        }
        function saveProjectData() { localStorage.setItem('ediProjectsOnethree', JSON.stringify(projectsOnethree)); localStorage.setItem('ediProjectsFirmy', JSON.stringify(projectsFirmy)); localStorage.setItem('ediProjectsOwn', JSON.stringify(projectsOwn)); localStorage.setItem('_lastLocalSave', Date.now().toString()); saveToCloud(); }

        const defaultDocs = {
            onethree: { driveLink: 'https://drive.google.com/open?id=1xejwSec3QdJ84kqj7uRHW2eDvLQdEsXF', docs: [{name:'1three-studio-kalendarz-luty-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/1three-studio-kalendarz-luty-2026.md'},{name:'RESEARCH-SZKOLENIA-AI-POLSKA-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/1THREE/RESEARCH-SZKOLENIA-AI-POLSKA-2026.md'}] },
            kubus: { driveLink: 'https://drive.google.com/open?id=1TBMMNr8d8ykIQ-vmQWF7Fu7myPr-6P8n', docs: [{name:'maspex-kubus-2026.md',path:'/Users/t8/.openclaw/workspace/projekty/KUBUS/maspex-kubus-2026.md'}] },
            especto: { driveLink: 'https://drive.google.com/open?id=1yr_og1wvrhg8J050nAfuT10KZxjic4mY', docs: [{name:'üìä Raport AI Video',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RAPORT-ESPECTO-FINAL.md'},{name:'‚öôÔ∏è Workflow Google AI',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/WORKFLOW-AI-GOOGLE-ESPECTO.md'},{name:'üìù Biblioteka prompt√≥w',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/BIBLIOTEKA-PROMPTOW-GOOGLE-AI-ESPECTO.md'},{name:'üìã Procedury operacyjne',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/PROCEDURY-OPERACYJNE-AI-ESPECTO.md'},{name:'üîç Research Google AI',path:'/Users/t8/.openclaw/workspace/projekty/ESPECTO/RESEARCH-GOOGLE-AI-STACK-2026.md'}] },
            dom: { driveLink: 'https://drive.google.com/open?id=1ehGwMnZhpFzLY3mY3DLaWGWpwhxA--ZQ', docs: [{name:'RESEARCH-GEODECI.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-GEODECI.md'},{name:'RESEARCH-CENY-DZIALEK.md',path:'/Users/t8/.openclaw/workspace/projekty/DOM/RESEARCH-CENY-DZIALEK.md'}] },
            virface: { driveLink: '', docs: [] }, aiartists: { driveLink: '', docs: [] }, safesenior: { driveLink: '', docs: [] },
        };

        function loadProjectData() {
            const saved1 = localStorage.getItem('ediProjectsOnethree');
            const saved2 = localStorage.getItem('ediProjectsFirmy');
            const saved3 = localStorage.getItem('ediProjectsOwn');
            if (saved1) projectsOnethree = JSON.parse(saved1);
            if (saved2) projectsFirmy = JSON.parse(saved2);
            if (saved3) projectsOwn = JSON.parse(saved3);
            [projectsOnethree, projectsFirmy, projectsOwn].flat().forEach(p => { if (defaultDocs[p.id]) { p.docs = defaultDocs[p.id].docs; p.driveLink = defaultDocs[p.id].driveLink; } });
            saveProjectData();
        }

        function getProjectLabel(project) { const labels = { onethree: '1THREE', system: 'SYSTEM', dom: 'DOM', osobiste: 'OSOBISTE', pomysl: 'POMYS≈Å', research: 'RESEARCH' }; return labels[project] || project.toUpperCase(); }
        function getDeadlineLabel(deadline) { const labels = { now: 'üî• Teraz!', today: 'Dzi≈õ', week: 'Ten tydzie≈Ñ', later: 'P√≥≈∫niej' }; return labels[deadline] || deadline; }

        let currentAttachments = [];
        function renderAttachments() {
            const container = document.getElementById('attachmentsList');
            if (currentAttachments.length === 0) { container.innerHTML = '<div style="color:var(--text-secondary);font-size:9px;padding:4px 0">Brak za≈ÇƒÖcznik√≥w</div>'; return; }
            container.innerHTML = currentAttachments.map((att, idx) => `<div class="attachment-item"><span>üìé</span><a href="file://${att.path}" target="_blank">${att.name}</a><span class="attachment-remove" onclick="removeAttachment(${idx})">‚úï</span></div>`).join('');
        }
        function addAttachment() { const name = document.getElementById('newAttachmentName').value.trim(); const path = document.getElementById('newAttachmentPath').value.trim(); if (!name || !path) return; currentAttachments.push({ name, path }); document.getElementById('newAttachmentName').value = ''; document.getElementById('newAttachmentPath').value = ''; renderAttachments(); }
        function removeAttachment(idx) { currentAttachments.splice(idx, 1); renderAttachments(); }

        function openModal(column, taskId = null) {
            const modal = document.getElementById('modalOverlay'); const form = document.getElementById('taskForm'); const title = document.getElementById('modalTitle'); const deleteBtn = document.getElementById('deleteBtn');
            form.reset(); document.getElementById('taskColumn').value = column;
            if (taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (task) { title.textContent = 'Edytuj task'; document.getElementById('taskId').value = task.id; document.getElementById('taskTitle').value = task.title; document.getElementById('taskProject').value = task.project; document.getElementById('taskDeadline').value = task.deadline; document.getElementById('taskNotes').value = task.notes || ''; document.getElementById('taskColumn').value = task.column; document.getElementById('taskTime').value = task.estimatedTime || ''; document.getElementById('taskCalendar').value = task.calendarSlot || ''; currentAttachments = task.attachments || []; renderAttachments(); deleteBtn.style.display = 'block'; }
            } else { title.textContent = 'Nowy task'; document.getElementById('taskId').value = ''; document.getElementById('taskTime').value = ''; document.getElementById('taskCalendar').value = ''; currentAttachments = []; renderAttachments(); deleteBtn.style.display = 'none'; }
            modal.classList.add('active'); document.getElementById('taskTitle').focus();
        }
        function closeModal() { document.getElementById('modalOverlay').classList.remove('active'); }

        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('taskId').value;
            const taskData = { title: document.getElementById('taskTitle').value, project: document.getElementById('taskProject').value, column: document.getElementById('taskColumn').value, deadline: document.getElementById('taskDeadline').value, notes: document.getElementById('taskNotes').value, attachments: currentAttachments, estimatedTime: document.getElementById('taskTime').value.trim(), calendarSlot: document.getElementById('taskCalendar').value };
            if (id) { const index = tasks.findIndex(t => t.id === parseInt(id)); if (index !== -1) tasks[index] = { ...tasks[index], ...taskData }; }
            else { taskData.id = Date.now(); taskData.createdAt = Date.now(); tasks.push(taskData); }
            saveTasks(); closeModal();
            // Force immediate re-render (bugfix: task not appearing after add)
            setTimeout(() => renderTasks(), 0);
        });

        function deleteTask() { const id = document.getElementById('taskId').value; if (id && confirm('Na pewno usunƒÖƒá ten task?')) { tasks = tasks.filter(t => t.id !== parseInt(id)); saveTasks(); renderTasks(); closeModal(); } }
        function saveTasks() { localStorage.setItem('ediTasks', JSON.stringify(tasks)); localStorage.setItem('_lastLocalSave', Date.now().toString()); saveToCloud(); }
        document.getElementById('modalOverlay').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { closeModal(); closeAppModal(); } });

        async function loadEdiLog() { try { const response = await fetch('edi-log.json'); if (response.ok) { const data = await response.json(); ediLog = data.log || ediLog; } } catch (e) {} }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EDI LOG TILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        let edilogData = null;
        async function loadEdiLogTile() {
            try {
                const token = await getToken();
                const headers = { 'Accept': 'application/vnd.github+json' };
                if (token) headers['Authorization'] = `token ${token}`;
                const gistResp = await fetch('https://api.github.com/gists/5ea142fdafd9f73cafd36ecd69cec9d2', { headers });
                if (gistResp.ok) {
                    const gist = await gistResp.json();
                    const file = gist.files['edilog-data.json'];
                    if (file) edilogData = JSON.parse(file.content);
                }
            } catch(e) {
                try { const resp = await fetch('edilog-data.json'); if (resp.ok) edilogData = await resp.json(); } catch(e2) {}
            }
            renderEdiLogTile();
        }
        function renderEdiLogTile() {
            const container = document.getElementById('edilogContent');
            if (!edilogData || !edilogData.days || edilogData.days.length === 0) {
                container.innerHTML = '<div class="empty-state">Brak log√≥w</div>';
                return;
            }
            const today = new Date().toISOString().slice(0,10);
            container.innerHTML = edilogData.days.map((day, i) => {
                const isToday = day.date === today;
                const collapsed = !isToday;
                const label = isToday ? 'üìç Dzisiaj' : day.date === getYesterday() ? 'üïê Wczoraj' : day.date;
                return `<div class="edilog-day">
                    <div class="edilog-day-header" onclick="toggleLogDay(${i})">
                        <span>${label}${day.summary && !isToday ? '<span class=edilog-day-summary>' + day.summary + '</span>' : ''}</span>
                        <span class="arrow ${collapsed ? 'collapsed' : ''}" id="logArrow${i}">‚ñº</span>
                    </div>
                    <div class="edilog-entries ${collapsed ? 'collapsed' : ''}" id="logEntries${i}">
                        ${day.entries.map(e => `<div class="edilog-entry">
                            <span class="edilog-time">${e.time}</span>
                            <span class="edilog-icon">${e.icon || 'üìå'}</span>
                            <span class="edilog-text">${e.title}${e.detail ? '<br><span class=detail>' + e.detail + '</span>' : ''}</span>
                            ${e.tag ? '<span class=edilog-tag>' + e.tag + '</span>' : ''}
                        </div>`).join('')}
                    </div>
                </div>`;
            }).join('');
        }
        function toggleLogDay(i) {
            const entries = document.getElementById('logEntries' + i);
            const arrow = document.getElementById('logArrow' + i);
            entries.classList.toggle('collapsed');
            arrow.classList.toggle('collapsed');
        }
        function getYesterday() {
            const d = new Date(); d.setDate(d.getDate() - 1);
            return d.toISOString().slice(0,10);
        }

        function renderDocuments() {
            const container = document.getElementById('ediDocs');
            if (ediDocs.length === 0) { container.innerHTML = '<div class="empty-state">Brak dokument√≥w</div>'; return; }
            container.innerHTML = ediDocs.map(doc => `<a class="doc-pill" href="file://${doc.path}" target="_blank">üìÑ ${doc.name} <span class="doc-type ${doc.type}">${doc.type.toUpperCase()}</span></a>`).join('');
        }
        function addDocument(name, type, preview, path) { ediDocs.unshift({ id: Date.now(), name, type, date: new Date().toLocaleDateString('pl-PL'), preview, path }); localStorage.setItem('ediDocs', JSON.stringify(ediDocs)); renderDocuments(); saveToCloud(); }

        function renderApps() {
            const container = document.getElementById('appsInline');
            const stageLabels = { idea: 'POMYS≈Å', planned: 'PLAN', progress: 'WIP', done: 'DONE' };
            container.innerHTML = apps.map(app => `<div class="app-pill ${app.priority}" onclick="openAppModal(${app.id})"><span style="font-size:10px;font-weight:600">${app.name}</span><span class="app-stage ${app.stage}">${stageLabels[app.stage]}</span></div>`).join('') + `<div class="add-app-inline" onclick="openAppModal()">+ Dodaj</div>`;
        }

        function openAppModal(appId = null) {
            const modal = document.getElementById('appModalOverlay'); const form = document.getElementById('appForm'); const title = document.getElementById('appModalTitle'); const deleteBtn = document.getElementById('deleteAppBtn');
            form.reset();
            if (appId) { const app = apps.find(a => a.id === appId); if (app) { title.textContent = 'Edytuj aplikacjƒô'; document.getElementById('appId').value = app.id; document.getElementById('appName').value = app.name; document.getElementById('appDesc').value = app.desc; document.getElementById('appStage').value = app.stage; document.getElementById('appPriority').value = app.priority; document.getElementById('appNotes').value = app.notes || ''; deleteBtn.style.display = 'block'; } }
            else { title.textContent = 'Nowa aplikacja'; document.getElementById('appId').value = ''; deleteBtn.style.display = 'none'; }
            modal.classList.add('active'); document.getElementById('appName').focus();
        }
        function closeAppModal() { document.getElementById('appModalOverlay').classList.remove('active'); }

        document.getElementById('appForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('appId').value;
            const appData = { name: document.getElementById('appName').value, desc: document.getElementById('appDesc').value, stage: document.getElementById('appStage').value, priority: document.getElementById('appPriority').value, notes: document.getElementById('appNotes').value };
            if (id) { const index = apps.findIndex(a => a.id === parseInt(id)); if (index !== -1) apps[index] = { ...apps[index], ...appData }; }
            else { appData.id = Date.now(); apps.push(appData); }
            saveApps(); renderApps(); closeAppModal();
        });
        function deleteApp() { const id = document.getElementById('appId').value; if (id && confirm('Na pewno usunƒÖƒá tƒô aplikacjƒô?')) { apps = apps.filter(a => a.id !== parseInt(id)); saveApps(); renderApps(); closeAppModal(); } }
        function saveApps() { localStorage.setItem('ediApps', JSON.stringify(apps)); localStorage.setItem('_lastLocalSave', Date.now().toString()); saveToCloud(); }
        document.getElementById('appModalOverlay').addEventListener('click', function(e) { if (e.target === this) closeAppModal(); });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CALENDAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        let calYear = 2026, calMonth = 1; // 0-indexed: 1 = February
        const monthNames = ['Stycze≈Ñ','Luty','Marzec','Kwiecie≈Ñ','Maj','Czerwiec','Lipiec','Sierpie≈Ñ','Wrzesie≈Ñ','Pa≈∫dziernik','Listopad','Grudzie≈Ñ'];
        const dayNames = ['Pn','Wt','≈ör','Cz','Pt','So','Nd'];

        function renderCalendar() {
            document.getElementById('calTitle').textContent = `${monthNames[calMonth]} ${calYear}`;
            const grid = document.getElementById('calGrid');
            const today = new Date();
            const firstDay = new Date(calYear, calMonth, 1);
            const lastDay = new Date(calYear, calMonth + 1, 0);
            let startDay = firstDay.getDay(); // 0=Sun
            startDay = startDay === 0 ? 6 : startDay - 1; // Convert to Mon=0

            let html = dayNames.map(d => `<div class="cal-day-name">${d}</div>`).join('');

            // Previous month days
            const prevLastDay = new Date(calYear, calMonth, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="cal-day other-month">${prevLastDay - i}</div>`;
            }

            // Current month days
            for (let d = 1; d <= lastDay.getDate(); d++) {
                const isToday = today.getFullYear() === calYear && today.getMonth() === calMonth && today.getDate() === d;
                html += `<div class="cal-day${isToday ? ' today' : ''}">${d}</div>`;
            }

            // Next month days
            const totalCells = startDay + lastDay.getDate();
            const remaining = (7 - (totalCells % 7)) % 7;
            for (let i = 1; i <= remaining; i++) {
                html += `<div class="cal-day other-month">${i}</div>`;
            }

            grid.innerHTML = html;
        }

        function changeMonth(delta) {
            calMonth += delta;
            if (calMonth > 11) { calMonth = 0; calYear++; }
            if (calMonth < 0) { calMonth = 11; calYear--; }
            renderCalendar();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRESS RING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function renderProgressRing() {
            const total = tasks.length;
            const done = tasks.filter(t => t.column === 'done').length;
            const pct = total > 0 ? Math.round((done / total) * 100) : 0;
            const circumference = 2 * Math.PI * 45; // ~282.7
            const offset = circumference - (pct / 100) * circumference;

            const ring = document.getElementById('progressRing');
            ring.style.strokeDashoffset = offset;

            document.getElementById('progressPct').textContent = pct + '%';
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUICK NOTES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        let notesSaveTimeout;
        function saveQuickNotes() {
            clearTimeout(notesSaveTimeout);
            notesSaveTimeout = setTimeout(() => {
                localStorage.setItem('ediQuickNotes', document.getElementById('quickNotes').value);
                saveToCloud();
                const saved = document.getElementById('notesSaved');
                saved.classList.add('show');
                setTimeout(() => saved.classList.remove('show'), 1500);
            }, 500);
        }
        function loadQuickNotes() {
            const saved = localStorage.getItem('ediQuickNotes');
            if (saved) document.getElementById('quickNotes').value = saved;
        }

        // Load from cloud first, then render
        (async function initDashboard() {
            try {
                await loadFromCloud();
                // Reload variables from localStorage (which cloud just updated)
                tasks = JSON.parse(localStorage.getItem('ediTasks') || '[]');
                const s1 = localStorage.getItem('ediProjectsOnethree'); if (s1) projectsOnethree = JSON.parse(s1);
                const s2 = localStorage.getItem('ediProjectsFirmy'); if (s2) projectsFirmy = JSON.parse(s2);
                const s3 = localStorage.getItem('ediProjectsOwn'); if (s3) projectsOwn = JSON.parse(s3);
                const sa = localStorage.getItem('ediApps'); if (sa) apps = JSON.parse(sa);
                const sd = localStorage.getItem('ediDocs'); if (sd) ediDocs = JSON.parse(sd);
            } catch(e) { console.warn('Cloud init failed, using local:', e); }

            loadProjectData();
            renderTasks();
            renderProjects();
            renderApps();
            loadEdiLog();
            loadEdiLogTile();
            initTileStash();
            renderDocuments();
            renderCalendar();
            loadQuickNotes();
        })();

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TILE STASH (HIDE/SHOW) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function initTileStash() {
            const tiles = document.querySelectorAll('.bento-grid > .tile');
            const hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');

            // Add close button to each tile
            tiles.forEach(tile => {
                if (tile.id === 'tile-settings' || tile.id === 'tile-stash') return; // don't hide settings or stash
                const btn = document.createElement('div');
                btn.className = 'tile-close-btn';
                btn.innerHTML = '‚úï';
                btn.title = 'Schowaj';
                btn.onclick = (e) => { e.stopPropagation(); hideTile(tile.id); };
                tile.appendChild(btn);
            });

            // Restore hidden state
            hidden.forEach(id => {
                const tile = document.getElementById(id);
                if (tile) tile.classList.add('hidden-tile');
            });
            renderStash();
        }

        function hideTile(id) {
            const tile = document.getElementById(id);
            if (!tile) return;
            tile.classList.add('hidden-tile');
            const hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');
            if (!hidden.includes(id)) hidden.push(id);
            localStorage.setItem('dashboardHiddenTiles', JSON.stringify(hidden));
            renderStash();
            saveToCloud();
        }

        function showTile(id) {
            const tile = document.getElementById(id);
            if (!tile) return;
            tile.classList.remove('hidden-tile');
            let hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');
            hidden = hidden.filter(h => h !== id);
            localStorage.setItem('dashboardHiddenTiles', JSON.stringify(hidden));
            renderStash();
            saveToCloud();
        }

        function getTileName(id) {
            const names = {
                'tile-logo': 'üéØ Command Center',
                'tile-statsbar': 'üìä Stats',
                'tile-kanban-urgent': 'üî¥ Pilne',
                'tile-kanban-todo': 'üìã TODO',
                'tile-kanban-waiting': '‚è≥ Czekam',
                'tile-kanban-done': '‚úÖ Done',
                'tile-kanban-onhold': '‚è∏Ô∏è On Hold',
                'tile-proj-1three': 'üé¨ 1three',
                'tile-proj-firmy': 'üè¢ Firmy',
                'tile-proj-own': 'üè† W≈Çasne',
                'tile-apps': 'üöÄ Aplikacje',
                'tile-docs': 'üìÑ Dokumenty',
                'tile-calendar': 'üìÖ Kalendarz',
                'tile-progress': 'üìà Progress',
                'tile-notes': 'üìù Notes',
                'tile-edilog': 'üìã Edi Log',
                'tile-clock': 'üïê Zegar',
                'tile-weather': 'üå§Ô∏è Pogoda',
                'tile-tokens': 'üî• Tokeny',
                'tile-profiles': 'üíæ Profile',
                'tile-kanban-backup': 'üíæ Backup',
            };
            return names[id] || id;
        }

        const toggleStashEl = document.getElementById('toggleStash');
        toggleStashEl.addEventListener('change', () => {
            document.body.classList.toggle('stash-mode', toggleStashEl.checked);
        });

        function renderStash() {
            const container = document.getElementById('stashChips');
            const hidden = JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]');
            if (hidden.length === 0) {
                container.innerHTML = '<div class="empty-state">Pusto ‚Äî schowaj kafelki prze≈ÇƒÖcznikiem üóÇÔ∏è</div>';
                return;
            }
            container.innerHTML = hidden.map(id => `<span class="stash-chip" onclick="showTile('${id}')">${getTileName(id)}</span>`).join('');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS TOGGLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const toggleDragEl = document.getElementById('toggleDrag');
        const toggleColorsEl = document.getElementById('toggleColors');
        const toggleResizeEl = document.getElementById('toggleResize');

        function loadEditMode() {
            const saved = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
            toggleDragEl.checked = !!saved.drag;
            toggleColorsEl.checked = !!saved.colors;
            toggleResizeEl.checked = !!saved.resize;
        }
        function saveEditMode() {
            const freeLayoutEl = document.getElementById('toggleFreeLayout');
            localStorage.setItem('dashboardEditMode', JSON.stringify({ drag: toggleDragEl.checked, colors: toggleColorsEl.checked, resize: toggleResizeEl.checked, freeLayout: freeLayoutEl ? freeLayoutEl.checked : false }));
        }
        function applyToggleStates() {
            const dragOn = toggleDragEl.checked;
            const colorsOn = toggleColorsEl.checked;
            const resizeOn = toggleResizeEl.checked;
            document.querySelectorAll('.tile-grip').forEach(g => { g.classList.toggle('hidden', !dragOn); g.draggable = dragOn; });
            document.querySelectorAll('.tile-color-btn').forEach(b => b.classList.toggle('hidden', !colorsOn));
            document.querySelectorAll('.tile-resize-handle').forEach(c => c.classList.toggle('hidden', !resizeOn));
        }
        toggleDragEl.addEventListener('change', () => { saveEditMode(); applyToggleStates(); });
        toggleColorsEl.addEventListener('change', () => { saveEditMode(); applyToggleStates(); });
        toggleResizeEl.addEventListener('change', () => { saveEditMode(); applyToggleStates(); });
        loadEditMode();

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TILE DRAG & DROP + COLOR PICKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        (function() {
            const grid = document.querySelector('.bento-grid');
            const tileColorPresets = [
                { name: 'Default', value: '' },
                { name: 'Fioletowy', value: 'rgba(124,58,237,0.15)' },
                { name: 'Zielony', value: 'rgba(16,185,129,0.15)' },
                { name: 'Niebieski', value: 'rgba(59,130,246,0.15)' },
                { name: 'Czerwony', value: 'rgba(239,68,68,0.15)' },
                { name: '≈ª√≥≈Çty', value: 'rgba(245,158,11,0.15)' },
                { name: 'R√≥≈ºowy', value: 'rgba(236,72,153,0.15)' },
                { name: 'Ciemny', value: 'rgba(0,0,0,0.3)' },
            ];
            const swatchColors = ['rgba(255,255,255,0.08)','#7C3AED','#10b981','#3b82f6','#ef4444','#f59e0b','#EC4899','#1a1a2e'];

            let tileDragId = null;
            let activeColorPicker = null;
            let freeLayoutOn = false;

            function getAllTiles() { return Array.from(grid.querySelectorAll(':scope > .tile')); }

            // Add grip + color btn to each tile
            function initTileUI() {
                getAllTiles().forEach(tile => {
                    if (tile.querySelector('.tile-grip')) return;
                    // Grip handle
                    const grip = document.createElement('span');
                    grip.className = 'tile-grip';
                    grip.textContent = '‚†ø';
                    grip.draggable = true;
                    grip.addEventListener('dragstart', onTileDragStart);
                    tile.prepend(grip);

                    // Color button
                    const colorBtn = document.createElement('span');
                    colorBtn.className = 'tile-color-btn';
                    colorBtn.textContent = 'üé®';
                    colorBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        if (!toggleColorsEl.checked) return;
                        toggleColorPicker(tile);
                    });
                    tile.appendChild(colorBtn);

                    // Tile drag events (on the tile itself for dragover/drop)
                    tile.addEventListener('dragover', onTileDragOver);
                    tile.addEventListener('dragleave', onTileDragLeave);
                    tile.addEventListener('drop', onTileDrop);
                });
            }

            function onTileDragStart(e) {
                if (!toggleDragEl.checked || freeLayoutOn) { e.preventDefault(); return; }
                const tile = e.target.closest('.tile');
                tileDragId = tile.id;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/tile-id', tile.id);
                requestAnimationFrame(() => tile.classList.add('tile-dragging'));
            }

            function onTileDragOver(e) {
                if (!tileDragId) return;
                // Don't interfere with task card drag (check if dataTransfer has tile-id)
                const tile = e.currentTarget.closest('.tile');
                if (!tile || tile.id === tileDragId) return;
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                tile.classList.add('tile-drag-over');
            }

            function onTileDragLeave(e) {
                const tile = e.currentTarget.closest('.tile');
                if (tile) tile.classList.remove('tile-drag-over');
            }

            function onTileDrop(e) {
                const targetTile = e.currentTarget.closest('.tile');
                if (!targetTile || !tileDragId || targetTile.id === tileDragId) return;
                // Only handle tile drops (not task card drops)
                const droppedTileId = e.dataTransfer.getData('text/tile-id');
                if (!droppedTileId) return;
                e.preventDefault();
                e.stopPropagation();
                targetTile.classList.remove('tile-drag-over');

                const sourceTile = document.getElementById(droppedTileId);
                if (!sourceTile) return;

                // Swap in DOM
                const sourceNext = sourceTile.nextElementSibling;
                const targetNext = targetTile.nextElementSibling;
                const parent = grid;

                if (sourceNext === targetTile) {
                    parent.insertBefore(targetTile, sourceTile);
                } else if (targetNext === sourceTile) {
                    parent.insertBefore(sourceTile, targetTile);
                } else {
                    const placeholder = document.createComment('swap');
                    parent.insertBefore(placeholder, sourceTile);
                    parent.insertBefore(sourceTile, targetNext);
                    parent.insertBefore(targetTile, placeholder);
                    placeholder.remove();
                }

                // Bounce animation
                [sourceTile, targetTile].forEach(t => {
                    t.classList.add('tile-drop-anim');
                    t.addEventListener('animationend', () => t.classList.remove('tile-drop-anim'), { once: true });
                });

                saveTileOrder();
            }

            document.addEventListener('dragend', function(e) {
                if (tileDragId) {
                    const tile = document.getElementById(tileDragId);
                    if (tile) tile.classList.remove('tile-dragging');
                    tileDragId = null;
                    getAllTiles().forEach(t => t.classList.remove('tile-drag-over'));
                }
            });

            function saveTileOrder() {
                const order = getAllTiles().map(t => t.id);
                localStorage.setItem('dashboardTileOrder', JSON.stringify(order));
            }

            function restoreTileOrder() {
                const saved = localStorage.getItem('dashboardTileOrder');
                if (!saved) return;
                try {
                    const order = JSON.parse(saved);
                    order.forEach(id => {
                        const tile = document.getElementById(id);
                        if (tile) grid.appendChild(tile);
                    });
                } catch(e) {}
            }

            // Color picker
            function toggleColorPicker(tile) {
                closeColorPicker();
                const picker = document.createElement('div');
                picker.className = 'tile-color-picker';
                const savedColors = JSON.parse(localStorage.getItem('dashboardTileColors') || '{}');
                const currentColor = savedColors[tile.id] || '';

                tileColorPresets.forEach((preset, i) => {
                    const swatch = document.createElement('div');
                    swatch.className = 'tile-color-swatch' + (currentColor === preset.value ? ' active' : '');
                    swatch.style.background = swatchColors[i];
                    swatch.title = preset.name;
                    swatch.addEventListener('click', function(e) {
                        e.stopPropagation();
                        applyTileColor(tile, preset.value);
                        closeColorPicker();
                    });
                    picker.appendChild(swatch);
                });

                tile.appendChild(picker);
                activeColorPicker = picker;
            }

            function closeColorPicker() {
                if (activeColorPicker) {
                    activeColorPicker.remove();
                    activeColorPicker = null;
                }
            }

            function colorToRgba(hex, alpha) {
                // Convert hex or color name to rgba
                const ctx = document.createElement('canvas').getContext('2d');
                ctx.fillStyle = hex;
                const computed = ctx.fillStyle; // always returns hex
                const r = parseInt(computed.slice(1,3),16);
                const g = parseInt(computed.slice(3,5),16);
                const b = parseInt(computed.slice(5,7),16);
                return `rgba(${r},${g},${b},${alpha})`;
            }

            function applyTileColor(tile, colorValue) {
                const savedColors = JSON.parse(localStorage.getItem('dashboardTileColors') || '{}');
                if (colorValue) {
                    tile.style.background = `linear-gradient(145deg, ${colorValue}, rgba(255,255,255,0.04) 50%, ${colorValue})`;
                    savedColors[tile.id] = colorValue;
                } else {
                    tile.style.background = '';
                    delete savedColors[tile.id];
                }
                localStorage.setItem('dashboardTileColors', JSON.stringify(savedColors));
            }

            function restoreTileColors() {
                const saved = JSON.parse(localStorage.getItem('dashboardTileColors') || '{}');
                Object.entries(saved).forEach(([id, color]) => {
                    const tile = document.getElementById(id);
                    if (tile && color) {
                        tile.style.background = `linear-gradient(145deg, ${color}, rgba(255,255,255,0.04) 50%, ${color})`;
                    }
                });
            }

            // Close color picker on outside click
            document.addEventListener('click', function(e) {
                if (activeColorPicker && !e.target.closest('.tile-color-picker') && !e.target.closest('.tile-color-btn')) {
                    closeColorPicker();
                }
            });

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TILE RESIZE (DRAG) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            function getTileSizes() {
                return JSON.parse(localStorage.getItem('dashboardTileSizes') || '{}');
            }
            function saveTileSizes(sizes) {
                localStorage.setItem('dashboardTileSizes', JSON.stringify(sizes));
            }

            function getDefaultSpan(tile) {
                const cs = window.getComputedStyle(tile);
                const colMatch = cs.gridColumnEnd.match(/span\s+(\d+)/);
                const rowMatch = cs.gridRowEnd.match(/span\s+(\d+)/);
                let cols = colMatch ? parseInt(colMatch[1]) : 2;
                let rows = rowMatch ? parseInt(rowMatch[1]) : 1;
                const inlineCol = tile.style.gridColumn.match(/span\s+(\d+)/);
                const inlineRow = tile.style.gridRow.match(/span\s+(\d+)/);
                if (inlineCol) cols = parseInt(inlineCol[1]);
                if (inlineRow) rows = parseInt(inlineRow[1]);
                return { cols, rows };
            }

            function applyTileSize(tile, cols, rows) {
                tile.style.gridColumn = 'span ' + cols;
                tile.style.gridRow = 'span ' + rows;
            }

            function initResizeControls() {
                const sizes = getTileSizes();
                getAllTiles().forEach(tile => {
                    if (tile.querySelector('.tile-resize-handle')) return;
                    const saved = sizes[tile.id];
                    const def = getDefaultSpan(tile);
                    const cols = saved ? saved.cols : def.cols;
                    const rows = saved ? saved.rows : def.rows;
                    if (saved) applyTileSize(tile, cols, rows);

                    const handle = document.createElement('div');
                    handle.className = 'tile-resize-handle';
                    tile.appendChild(handle);

                    handle.addEventListener('mousedown', function(e) {
                        if (!toggleResizeEl.checked) return;
                        e.preventDefault();
                        e.stopPropagation();

                        const gridRect = grid.getBoundingClientRect();
                        const colWidth = gridRect.width / 12;
                        const gap = 6;
                        // Compute row height from tile's current rendered height per row
                        const curSpan = getDefaultSpan(tile);
                        const tileRect = tile.getBoundingClientRect();
                        const rowHeight = tileRect.height / curSpan.rows;

                        const startX = e.clientX;
                        const startY = e.clientY;
                        const startCols = curSpan.cols;
                        const startRows = curSpan.rows;

                        tile.classList.add('tile-resizing');
                        document.body.classList.add('resize-dragging');

                        function onMouseMove(ev) {
                            const deltaX = ev.clientX - startX;
                            const deltaY = ev.clientY - startY;
                            let newCols = startCols + Math.round(deltaX / colWidth);
                            let newRows = startRows + Math.round(deltaY / rowHeight);
                            newCols = Math.max(1, Math.min(12, newCols));
                            newRows = Math.max(1, Math.min(6, newRows));
                            applyTileSize(tile, newCols, newRows);
                        }

                        function onMouseUp(ev) {
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                            tile.classList.remove('tile-resizing');
                            document.body.classList.remove('resize-dragging');

                            // Read final size and save
                            const finalSpan = getDefaultSpan(tile);
                            const allSizes = getTileSizes();
                            allSizes[tile.id] = { cols: finalSpan.cols, rows: finalSpan.rows };
                            saveTileSizes(allSizes);

                            // Settle animation
                            tile.classList.add('tile-resize-settle');
                            setTimeout(() => tile.classList.remove('tile-resize-settle'), 300);
                        }

                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                    });
                });
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FREE LAYOUT MODE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const toggleFreeLayoutEl = document.getElementById('toggleFreeLayout');
            let freeDragTile = null, freeDragOffsetX = 0, freeDragOffsetY = 0;

            function loadFreeLayoutState() {
                const saved = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
                toggleFreeLayoutEl.checked = !!saved.freeLayout;
                const savedPos = JSON.parse(localStorage.getItem('dashboardFreePositions') || '{}');
                if (Object.keys(savedPos).length > 0) {
                    enableFreeLayout(false);
                    if (!saved.freeLayout) {
                        freeLayoutOn = false;
                        grid.classList.remove('free-editing');
                    }
                }
            }

            function saveFreePositions() {
                const positions = {};
                getAllTiles().forEach(tile => {
                    positions[tile.id] = {
                        top: tile.style.top,
                        left: tile.style.left,
                        width: tile.style.width,
                        height: tile.style.height
                    };
                });
                localStorage.setItem('dashboardFreePositions', JSON.stringify(positions));
            }

            function enableFreeLayout(animate) {
                const tiles = getAllTiles();
                // Capture current positions BEFORE switching to absolute
                const rects = new Map();
                tiles.forEach(t => {
                    const r = t.getBoundingClientRect();
                    // Only capture if tile is visible and has dimensions
                    if (r.width > 0 && r.height > 0) {
                        rects.set(t.id, r);
                    }
                });
                const gridRect = grid.getBoundingClientRect();

                // Load saved positions
                const savedPositions = JSON.parse(localStorage.getItem('dashboardFreePositions') || '{}');

                // Switch to free layout
                grid.classList.add('free-layout');
                // Set grid height to encompass all tiles
                let maxBottom = 900;
                let fallbackY = 20;

                tiles.forEach(tile => {
                    // Skip hidden tiles
                    if (tile.style.display === 'none') return;

                    const saved = savedPositions[tile.id];
                    const rect = rects.get(tile.id);
                    if (saved && saved.top) {
                        tile.style.top = saved.top;
                        tile.style.left = saved.left;
                        tile.style.width = saved.width;
                        tile.style.height = saved.height;
                    } else if (rect) {
                        tile.style.top = (rect.top - gridRect.top) + 'px';
                        tile.style.left = (rect.left - gridRect.left) + 'px';
                        tile.style.width = rect.width + 'px';
                        tile.style.height = rect.height + 'px';
                    } else {
                        // Fallback for tiles with no captured rect ‚Äî stack them vertically
                        tile.style.top = fallbackY + 'px';
                        tile.style.left = '20px';
                        tile.style.width = '300px';
                        tile.style.height = '200px';
                        fallbackY += 220;
                    }
                    const bottom = parseFloat(tile.style.top) + parseFloat(tile.style.height);
                    if (bottom > maxBottom) maxBottom = bottom;
                });

                grid.style.minHeight = (maxBottom + 40) + 'px';
                grid.classList.add('free-editing');
                freeLayoutOn = true;
            }

            function disableFreeLayout() {
                freeLayoutOn = false;
                // Pozycje i free-layout zostajƒÖ ‚Äî tylko wy≈ÇƒÖczamy edycjƒô (drag + dot grid)
                grid.classList.remove('free-editing');
            }

            function resetToGrid() {
                // Hard reset ‚Äî wr√≥ƒá do CSS grid
                freeLayoutOn = false;
                grid.classList.remove('free-layout', 'free-editing');
                grid.style.minHeight = '';
                getAllTiles().forEach(tile => {
                    tile.style.top = '';
                    tile.style.left = '';
                    tile.style.width = '';
                    tile.style.height = '';
                });
                localStorage.removeItem('dashboardFreePositions');
            }

            toggleFreeLayoutEl.addEventListener('change', () => {
                const on = toggleFreeLayoutEl.checked;
                toggleResizeEl.checked = on;
                const mode = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
                mode.freeLayout = on;
                mode.resize = on;
                localStorage.setItem('dashboardEditMode', JSON.stringify(mode));
                applyToggleStates();

                if (on) {
                    enableFreeLayout(true);
                } else {
                    disableFreeLayout();
                }
            });

            // Free layout drag
            document.addEventListener('mousedown', function(e) {
                if (!freeLayoutOn) return;
                const tile = e.target.closest('.bento-grid > .tile');
                if (!tile) return;
                if (['INPUT','TEXTAREA','BUTTON','SELECT','A'].includes(e.target.tagName)) return;
                // Don't interfere with resize handle
                if (e.target.closest('.tile-resize-handle')) return;

                e.preventDefault();
                freeDragTile = tile;
                freeDragOffsetX = e.clientX - tile.offsetLeft;
                freeDragOffsetY = e.clientY - tile.offsetTop;
                tile.classList.add('free-dragging');
                tile.style.transition = 'none';
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', function(e) {
                if (!freeDragTile) return;
                freeDragTile.style.left = (e.clientX - freeDragOffsetX) + 'px';
                freeDragTile.style.top = (e.clientY - freeDragOffsetY) + 'px';
            });

            document.addEventListener('mouseup', function() {
                if (!freeDragTile) return;
                freeDragTile.classList.remove('free-dragging');
                freeDragTile.style.transition = '';
                saveFreePositions();
                // Update grid min-height
                let maxBottom = 900;
                getAllTiles().forEach(t => {
                    const bottom = parseFloat(t.style.top || 0) + parseFloat(t.style.height || 0);
                    if (bottom > maxBottom) maxBottom = bottom;
                });
                grid.style.minHeight = (maxBottom + 40) + 'px';
                freeDragTile = null;
                document.body.style.userSelect = '';
            });

            // Free layout resize (override default resize in free mode)
            function initFreeResizeOverride() {
                getAllTiles().forEach(tile => {
                    const handle = tile.querySelector('.tile-resize-handle');
                    if (!handle || handle.dataset.freeResizeBound) return;
                    handle.dataset.freeResizeBound = '1';

                    handle.addEventListener('mousedown', function(e) {
                        if (!freeLayoutOn || !toggleResizeEl.checked) return;
                        e.preventDefault();
                        e.stopPropagation();

                        const startX = e.clientX;
                        const startY = e.clientY;
                        const startW = tile.offsetWidth;
                        const startH = tile.offsetHeight;

                        tile.classList.add('tile-resizing');
                        document.body.classList.add('resize-dragging');

                        function onMove(ev) {
                            tile.style.width = Math.max(80, startW + (ev.clientX - startX)) + 'px';
                            tile.style.height = Math.max(40, startH + (ev.clientY - startY)) + 'px';
                        }
                        function onUp() {
                            document.removeEventListener('mousemove', onMove);
                            document.removeEventListener('mouseup', onUp);
                            tile.classList.remove('tile-resizing');
                            document.body.classList.remove('resize-dragging');
                            saveFreePositions();
                        }
                        document.addEventListener('mousemove', onMove);
                        document.addEventListener('mouseup', onUp);
                    }, true); // capture phase to override grid resize
                });
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EDITABLE KANBAN LIST NAMES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            function initEditableKanbanNames() {
                const customNames = JSON.parse(localStorage.getItem('dashboardKanbanNames') || '{}');
                document.querySelectorAll('.kanban-title').forEach(titleEl => {
                    const column = titleEl.closest('[data-column]');
                    if (!column) return;
                    const colName = column.dataset.column;
                    // Find the text node / first text content (skip emoji + count)
                    const originalText = titleEl.childNodes[0];
                    if (!originalText) return;
                    const defaultText = originalText.textContent.trim();
                    const span = document.createElement('span');
                    span.className = 'kanban-title-text';
                    span.textContent = customNames[colName] || defaultText;
                    span.title = 'Kliknij by edytowaƒá nazwƒô';
                    span.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const input = document.createElement('input');
                        input.className = 'kanban-title-input';
                        input.value = span.textContent;
                        span.replaceWith(input);
                        input.focus();
                        input.select();
                        function save() {
                            const val = input.value.trim() || defaultText;
                            span.textContent = val;
                            input.replaceWith(span);
                            const names = JSON.parse(localStorage.getItem('dashboardKanbanNames') || '{}');
                            if (val === defaultText) delete names[colName]; else names[colName] = val;
                            localStorage.setItem('dashboardKanbanNames', JSON.stringify(names));
                            saveToCloud();
                        }
                        input.addEventListener('blur', save);
                        input.addEventListener('keypress', function(ev) { if (ev.key === 'Enter') input.blur(); });
                        input.addEventListener('keydown', function(ev) { if (ev.key === 'Escape') { input.value = customNames[colName] || defaultText; input.blur(); } });
                    });
                    originalText.textContent = '';
                    titleEl.insertBefore(span, titleEl.firstChild);
                });
            }
            initEditableKanbanNames();

            // Initialize
            restoreTileOrder();
            initTileUI();
            initResizeControls();
            // One-time reset v2: clear broken free layout positions
            if (!localStorage.getItem('dashboardResetV2')) {
                localStorage.removeItem('dashboardFreePositions');
                const mode = JSON.parse(localStorage.getItem('dashboardEditMode') || '{}');
                mode.freeLayout = false;
                localStorage.setItem('dashboardEditMode', JSON.stringify(mode));
                localStorage.setItem('dashboardResetV2', '1');
            }
            restoreTileColors();
            applyToggleStates();
            loadFreeLayoutState();
            initFreeResizeOverride();
        })();

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LIVE CLOCK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clockTime').textContent = h + ':' + m;
            const days = ['Niedziela','Poniedzia≈Çek','Wtorek','≈öroda','Czwartek','PiƒÖtek','Sobota'];
            const months = ['stycznia','lutego','marca','kwietnia','maja','czerwca','lipca','sierpnia','wrze≈õnia','pa≈∫dziernika','listopada','grudnia'];
            document.getElementById('clockDate').textContent = days[now.getDay()] + ', ' + now.getDate() + ' ' + months[now.getMonth()] + ' ' + now.getFullYear();
        }
        updateClock();
        setInterval(updateClock, 1000);

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WEATHER (wttr.in) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        async function loadWeather() {
            try {
                const resp = await fetch('https://wttr.in/Krak%C3%B3w?format=j1');
                const data = await resp.json();
                const cur = data.current_condition[0];
                const temp = cur.temp_C;
                const feels = cur.FeelsLikeC;
                const desc = cur.lang_pl && cur.lang_pl[0] ? cur.lang_pl[0].value : cur.weatherDesc[0].value;
                const humidity = cur.humidity;
                const wind = cur.windspeedKmph;
                const code = parseInt(cur.weatherCode);
                const icons = { 113: '‚òÄÔ∏è', 116: '‚õÖ', 119: '‚òÅÔ∏è', 122: '‚òÅÔ∏è', 143: 'üå´Ô∏è', 176: 'üå¶Ô∏è', 179: 'üå®Ô∏è', 182: 'üåßÔ∏è', 185: 'üåßÔ∏è', 200: '‚õàÔ∏è', 227: 'üå®Ô∏è', 230: '‚ùÑÔ∏è', 248: 'üå´Ô∏è', 260: 'üå´Ô∏è', 263: 'üå¶Ô∏è', 266: 'üåßÔ∏è', 281: 'üåßÔ∏è', 284: 'üåßÔ∏è', 293: 'üåßÔ∏è', 296: 'üåßÔ∏è', 299: 'üåßÔ∏è', 302: 'üåßÔ∏è', 305: 'üåßÔ∏è', 308: 'üåßÔ∏è', 311: 'üåßÔ∏è', 314: 'üåßÔ∏è', 317: 'üå®Ô∏è', 320: 'üå®Ô∏è', 323: 'üå®Ô∏è', 326: 'üå®Ô∏è', 329: '‚ùÑÔ∏è', 332: '‚ùÑÔ∏è', 335: '‚ùÑÔ∏è', 338: '‚ùÑÔ∏è', 350: 'üåßÔ∏è', 353: 'üå¶Ô∏è', 356: 'üåßÔ∏è', 359: 'üåßÔ∏è', 362: 'üå®Ô∏è', 365: 'üå®Ô∏è', 368: 'üå®Ô∏è', 371: '‚ùÑÔ∏è', 374: 'üå®Ô∏è', 377: 'üå®Ô∏è', 386: '‚õàÔ∏è', 389: '‚õàÔ∏è', 392: '‚õàÔ∏è', 395: '‚ùÑÔ∏è' };
                document.getElementById('weatherIcon').textContent = icons[code] || 'üå§Ô∏è';
                document.getElementById('weatherTemp').textContent = temp + '¬∞C';
                document.getElementById('weatherDesc').textContent = desc;
                document.getElementById('weatherWind').textContent = 'üí® ' + wind + ' km/h';
                document.getElementById('weatherHumidity').textContent = 'üíß ' + humidity + '%';
                document.getElementById('weatherFeels').textContent = 'üå°Ô∏è Odczuw. ' + feels + '¬∞C';
            } catch(e) {
                document.getElementById('weatherDesc').textContent = 'B≈ÇƒÖd ≈Çadowania';
                document.getElementById('weatherIcon').textContent = '‚ö†Ô∏è';
            }
        }
        loadWeather();
        setInterval(loadWeather, 600000); // refresh every 10min

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOKENS (REAL) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        async function loadTokenStats() {
            try {
                const token = await getToken();
                const headers = { 'Accept': 'application/vnd.github+json' };
                if (token) headers['Authorization'] = `token ${token}`;
                const resp = await fetch('https://api.github.com/gists/5ea142fdafd9f73cafd36ecd69cec9d2', { headers });
                if (!resp.ok) return;
                const gist = await resp.json();
                const file = gist.files['token-stats.json'];
                if (!file) return;
                const stats = JSON.parse(file.content);
                const fmt = n => Number(n).toLocaleString('pl-PL');
                document.getElementById('tokenTotal').textContent = fmt(stats.total);
                document.getElementById('tokenOpus').textContent = fmt(stats.opus);
                document.getElementById('tokenSonnet').textContent = fmt(stats.sonnet);
                document.getElementById('tokenOther').textContent = fmt(stats.other);
                document.getElementById('tokenCost').textContent = '$' + stats.cost_usd.toFixed(2);
            } catch(e) { console.warn('Token stats load failed:', e); }
        }
        loadTokenStats();
        setInterval(loadTokenStats, 300000); // refresh co 5 min

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function getProfiles() { return JSON.parse(localStorage.getItem('dashboardProfiles') || '{}'); }
        function saveProfile() {
            const name = document.getElementById('profileNameInput').value.trim();
            if (!name) return;
            const profiles = getProfiles();
            profiles[name] = {
                hiddenTiles: JSON.parse(localStorage.getItem('dashboardHiddenTiles') || '[]'),
                tileColors: JSON.parse(localStorage.getItem('dashboardTileColors') || '{}'),
                tileOrder: JSON.parse(localStorage.getItem('dashboardTileOrder') || '[]'),
                freePositions: JSON.parse(localStorage.getItem('dashboardFreePositions') || '{}'),
                tileSizes: JSON.parse(localStorage.getItem('dashboardTileSizes') || '{}'),
                editMode: JSON.parse(localStorage.getItem('dashboardEditMode') || '{}'),
                kanbanNames: JSON.parse(localStorage.getItem('dashboardKanbanNames') || '{}'),
            };
            localStorage.setItem('dashboardProfiles', JSON.stringify(profiles));
            document.getElementById('profileNameInput').value = '';
            renderProfiles();
        }
        function loadProfile(name) {
            const profiles = getProfiles();
            const p = profiles[name];
            if (!p) return;
            if (p.hiddenTiles) localStorage.setItem('dashboardHiddenTiles', JSON.stringify(p.hiddenTiles));
            if (p.tileColors) localStorage.setItem('dashboardTileColors', JSON.stringify(p.tileColors));
            if (p.tileOrder) localStorage.setItem('dashboardTileOrder', JSON.stringify(p.tileOrder));
            if (p.freePositions) localStorage.setItem('dashboardFreePositions', JSON.stringify(p.freePositions));
            if (p.tileSizes) localStorage.setItem('dashboardTileSizes', JSON.stringify(p.tileSizes));
            if (p.editMode) localStorage.setItem('dashboardEditMode', JSON.stringify(p.editMode));
            if (p.kanbanNames) localStorage.setItem('dashboardKanbanNames', JSON.stringify(p.kanbanNames));
            location.reload();
        }
        function deleteProfile(name, e) {
            e.stopPropagation();
            const profiles = getProfiles();
            delete profiles[name];
            localStorage.setItem('dashboardProfiles', JSON.stringify(profiles));
            renderProfiles();
        }
        function renderProfiles() {
            const container = document.getElementById('profileControls');
            const profiles = getProfiles();
            const names = Object.keys(profiles);
            if (names.length === 0) { container.innerHTML = '<span style="font-size:8px;color:var(--text-muted);">Brak zapisanych profili</span>'; return; }
            container.innerHTML = names.map(n => `<span class="profile-chip" onclick="loadProfile('${n.replace(/'/g,"\\'")}')">${n}<span class="del" onclick="deleteProfile('${n.replace(/'/g,"\\'")}', event)">‚úï</span></span>`).join('');
        }
        renderProfiles();

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLOUD SYNC: include new data ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // Patch saveToCloud to include kanbanNames and profiles
        const _origSaveToCloud = saveToCloud;
        // (kanbanNames are already saved to localStorage, and saveToCloud reads from localStorage)

    </script>
</body>
</html>
